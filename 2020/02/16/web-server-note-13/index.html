<!DOCTYPE html>

<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">

  <meta name="description" content="后台管理系统登录JSP凡是action src href都要写绝对路径，需要加上工程名称获取当前项目名
1$&amp;#123;pageContext.request.contextPath &amp;#125;

Web层 AdminServlet类
123456789101112package com.myxq">


<link rel="alternate" href="/atom.xml" title="Aaron Lin" type="application/atom+xml">
<meta name="theme-color" content="#a1d0f6">
<title>Web服务器笔记-三层架构实践 - Aaron Lin</title>
<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->


<!-- <link rel="shortcut icon" href="/favicon.png"> -->

<link rel="shortcut icon" href="/favicon.ico">
<link rel="stylesheet" href="/css/style.css">
<!-- 谷歌 Analytics -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-153099566-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-153099566-1');
</script>


<nav class="main-nav">
	
	    <a href="/">← 主页</a>
	
	
	    <a href="/about/">关于</a>
	
	    <a href="/archives/">归档</a>
	
	<a class="cta" href="/rss2.xml" data-no-instant>订阅</a>
</nav>

<section id="wrapper">
    <article class="post">
    <header>
        
            <h1>Web服务器笔记-三层架构实践</h1>
        
        <h2 class="headline">Feb 16 2020
        
            
            <a href="/categories/Web服务器笔记/#Web服务器笔记">Web服务器笔记</a>
        
        </h2>
    </header>
</article>
<section id="post-body"><h2 id="后台管理系统登录"><a href="#后台管理系统登录" class="headerlink" title="后台管理系统登录"></a>后台管理系统登录</h2><p>JSP凡是action src href都要写绝对路径，需要加上工程名称<br>获取当前项目名</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;pageContext.request.contextPath &#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/02/16/web-server-note-13/1.png" alt="三层架构实践"></p>
<p>Web层 AdminServlet类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.web;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/AdminServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		String name = request.getParameter(<span class="string">"username"</span>);</span><br><span class="line">		String pwd = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line">		System.out.println(<span class="string">"name:"</span>+name+<span class="string">" pwd:"</span>+pwd);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>新建一个Service层 AdminService类<br>在AdminServlet中调用登录业务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用 登录业务</span></span><br><span class="line">AdminService adminService = <span class="keyword">new</span> AdminService();</span><br><span class="line">adminService.login(name,pwd);</span><br></pre></td></tr></table></figure>
<p>自动创建login方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminService</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String name, String pwd)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 调用Dao层到数据库查询</span></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>新建一个DAO层 AdminService类<br>在AdminService中调用Dao层到数据库查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用Dao层到数据库查询</span></span><br><span class="line">AdminDao adminDao = <span class="keyword">new</span> AdminDao();</span><br><span class="line">adminDao.checkAdmin(name,pwd);</span><br></pre></td></tr></table></figure>
<p>自动创建checkAdmin方法<br>导入数据库相关Jar包，创建util包，写JdbcUtil，创建db.properties</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Admin <span class="title">checkAdmin</span><span class="params">(String name, String pwd)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		<span class="comment">// 到数据库中查询 返回查询结果</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// 1.连接数据库</span></span><br><span class="line">		QueryRunner qr = <span class="keyword">new</span> QueryRunner(JDBCUtil.getDataSource());</span><br><span class="line">		String sql = <span class="string">"select * from admin where username= ?and password = ?"</span>;</span><br><span class="line">		<span class="comment">// 2.获取数据</span></span><br><span class="line">		Admin admin = <span class="keyword">null</span>;</span><br><span class="line">		admin = qr.query(sql, <span class="keyword">new</span> BeanHandler&lt;Admin&gt;(Admin.class), name, pwd);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> admin;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">抛出异常</span><br><span class="line"></span><br><span class="line">修改AdminService，继续抛出SQLException</span><br><span class="line">```java</span><br><span class="line"><span class="keyword">package</span> com.myxq.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Admin <span class="title">login</span><span class="params">(String name, String pwd)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">// 调用Dao层到数据库查询</span></span><br><span class="line">		AdminDao adminDao = <span class="keyword">new</span> AdminDao();</span><br><span class="line">		Admin admin = adminDao.checkAdmin(name,pwd);</span><br><span class="line">		<span class="keyword">if</span> (admin != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> admin;</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"用户名或密码错误"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改AdminServlet，最终调用者，必须处理异常<br>如果项目修改了重启服务器还是报错，可以尝试Project-Clean 清除缓存</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.web;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/AdminServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		String name = request.getParameter(<span class="string">"username"</span>);</span><br><span class="line">		String pwd = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line">		System.out.println(<span class="string">"name:"</span>+name+<span class="string">" pwd:"</span>+pwd);</span><br><span class="line">		<span class="comment">// 调用 登录业务</span></span><br><span class="line">		AdminService adminService = <span class="keyword">new</span> AdminService();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			adminService.login(name,pwd);</span><br><span class="line">			System.out.println(<span class="string">"登录成功"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			System.out.println(<span class="string">"登录失败"</span>);</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>服务器跳转时，路径相对的是服务器WebContent<br>浏览器请求跳转时，路径相对的当前的JSP<br>这两个是冲突的，所以JSP凡是action src href都要写绝对路径</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"$&#123;pageContext.request.contextPath &#125;/admin/css/style.css"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>对网页进行测试</p>
<p>登录成功重定向后台首页</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	String name = request.getParameter(<span class="string">"username"</span>);</span><br><span class="line">	String pwd = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line">	System.out.println(<span class="string">"name:"</span>+name+<span class="string">" pwd:"</span>+pwd);</span><br><span class="line">	<span class="comment">// 调用 登录业务</span></span><br><span class="line">	AdminService adminService = <span class="keyword">new</span> AdminService();</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		Admin admin = adminService.login(name,pwd);</span><br><span class="line">		System.out.println(<span class="string">"登录成功"</span>);</span><br><span class="line">		<span class="comment">// 把用户保存到Session</span></span><br><span class="line">		HttpSession session = request.getSession();</span><br><span class="line">		session.setAttribute(<span class="string">"admin"</span>, admin);</span><br><span class="line">		<span class="comment">// 跳转到后台首页</span></span><br><span class="line">		<span class="comment">// 使用重定向，地址栏需要变化</span></span><br><span class="line">		response.sendRedirect(request.getContextPath()+<span class="string">"/admin/admin_index.jsp"</span>);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		<span class="keyword">if</span> (e.getMessage().equals(<span class="string">"用户名或密码错误"</span>))&#123;</span><br><span class="line">			System.out.println(<span class="string">"登录失败"</span>);</span><br><span class="line">			<span class="comment">// 跳转回登录页面，回显错误信息</span></span><br><span class="line">			request.setAttribute(<span class="string">"err"</span>, e.getMessage());</span><br><span class="line">			<span class="comment">// 转发</span></span><br><span class="line">			request.getRequestDispatcher(<span class="string">"admin/admin_login.jsp"</span>).forward(request,response);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为是重定向，所以需要修改admin_index的src为绝对路径<br>重定向：浏览器的跳转，相对JSP路径</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">frameset</span> <span class="attr">rows</span>=<span class="string">"70,*"</span> <span class="attr">frameborder</span>=<span class="string">0</span> <span class="attr">border</span>=<span class="string">"0"</span> <span class="attr">framespacing</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">frame</span> <span class="attr">src</span>=<span class="string">"$&#123;pageContext.request.contextPath &#125;/admin/top.jsp"</span> <span class="attr">name</span>=<span class="string">"topFrame"</span> <span class="attr">scrolling</span>=<span class="string">"NO"</span> <span class="attr">noresize</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">frameset</span> <span class="attr">cols</span>=<span class="string">"250,*"</span> <span class="attr">frameborder</span>=<span class="string">"0"</span> <span class="attr">border</span>=<span class="string">"0"</span>  <span class="attr">framespacing</span>=<span class="string">"10"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">frame</span> <span class="attr">src</span>=<span class="string">"$&#123;pageContext.request.contextPath &#125;/admin/left.jsp"</span> <span class="attr">name</span>=<span class="string">"leftFrame"</span>  <span class="attr">scrolling</span>=<span class="string">"NO"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">frame</span> <span class="attr">src</span>=<span class="string">"$&#123;pageContext.request.contextPath &#125;/admin/main.jsp"</span> <span class="attr">name</span>=<span class="string">"mainFrame"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">frameset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">frameset</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>修改后天显示的用户名</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"admin_top"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"top_left"</span>&gt;</span></span><br><span class="line">        码蚁商城</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"h_top_right"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/user_icon.png"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 从Session域中取数据 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>$&#123;admin.username &#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="商品管理业务"><a href="#商品管理业务" class="headerlink" title="商品管理业务"></a>商品管理业务</h2><p><img src="/2020/02/16/web-server-note-13/2.png" alt="商品管理业务"></p>
<h4 id="商品显示"><a href="#商品显示" class="headerlink" title="商品显示"></a>商品显示</h4><p>DAO层 GoodsDao类<br>暂时不用面向接口，面向接口编程，需求变更，用其他数据库，就只需要变更实现类<br>新建domain</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.domain;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Setter</span><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Goods</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> Double price;</span><br><span class="line">	<span class="keyword">private</span> String image;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Goods [id="</span> + id + <span class="string">", name="</span> + name + <span class="string">", price="</span> + price + <span class="string">", image="</span> + image + <span class="string">", getClass()="</span></span><br><span class="line">				+ getClass() + <span class="string">", hashCode()="</span> + hashCode() + <span class="string">", toString()="</span> + <span class="keyword">super</span>.toString() + <span class="string">"]"</span>;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>jar包，db.properties,Util包JdbcUtil<br>单元测试initialization Error，无代码无关，单元测试初始化错误，Clean工程就好了<br>写一个方法，就马上测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsDao</span> </span>&#123;</span><br><span class="line">	QueryRunner qr = <span class="keyword">new</span> QueryRunner(JDBCUtil.getDataSource());</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 增删改查</span></span><br><span class="line">	<span class="comment">// 1.从数据库中获取所有商品</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Goods&gt; <span class="title">getAllGoods</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		String sql = <span class="string">"select * from goods"</span>;</span><br><span class="line">		List&lt;Goods&gt; allGoods = qr.query(sql, <span class="keyword">new</span> BeanListHandler&lt;Goods&gt;(Goods.class));</span><br><span class="line">		<span class="keyword">return</span> allGoods;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2.添加商品到数据</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addGoods</span><span class="params">(Goods goods)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		String sql = <span class="string">"insert into goods (name,price,image)value(?,?,?)"</span>;</span><br><span class="line">		qr.update(sql, goods.getName(), goods.getPrice(), goods.getImage());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3.根据id删除商品</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delGoods</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		String sql = <span class="string">"delete from goods where id = ?"</span>;</span><br><span class="line">		qr.update(sql, id);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 4.修改指定商品</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateGoods</span><span class="params">(Goods goods)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		String sql = <span class="string">"update goods set name=?,price=?,image=? where id = ?"</span>;</span><br><span class="line">		qr.update(sql,goods.getName(),goods.getPrice(),goods.getImage(),goods.getId());</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsDaoTest</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetAllGoods</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		GoodsDao goodsDao = <span class="keyword">new</span> GoodsDao();</span><br><span class="line">		List&lt;Goods&gt; allGoods = goodsDao.getAllGoods();</span><br><span class="line">		System.out.println(allGoods);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAddGoods</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		GoodsDao goodsDao = <span class="keyword">new</span> GoodsDao();</span><br><span class="line">		Goods goods = <span class="keyword">new</span> Goods();</span><br><span class="line">		goods.setName(<span class="string">"测试"</span>);</span><br><span class="line">		goods.setPrice(<span class="number">200.0</span>);</span><br><span class="line">		goods.setImage(<span class="string">"goods_10.png"</span>);</span><br><span class="line">		goodsDao.addGoods(goods);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelGoods</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		GoodsDao goodsDao = <span class="keyword">new</span> GoodsDao();</span><br><span class="line">		goodsDao.delGoods(<span class="number">17</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Test</span> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdateGoods</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		Goods goods = <span class="keyword">new</span> Goods();</span><br><span class="line">		goods.setId(<span class="number">17</span>);</span><br><span class="line">		goods.setName(<span class="string">"update"</span>);</span><br><span class="line">		goods.setPrice(<span class="number">17.0</span>);</span><br><span class="line">		goods.setImage(<span class="string">"goods_11.png"</span>);</span><br><span class="line">		</span><br><span class="line">		GoodsDao goodsDao = <span class="keyword">new</span> GoodsDao();</span><br><span class="line">		goodsDao.updateGoods(goods);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Web层 GoodsListServlet类</p>
<p>创建GoodsListServlet类，写一句输出语句<br>修改admin_index.jsp的mainFrame</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;frame src=<span class="string">"$&#123;pageContext.request.contextPath &#125;/GoodsListServlet"</span> name=<span class="string">"mainFrame"</span> &gt;</span><br></pre></td></tr></table></figure>
<p>测试是否跳转到Servlet</p>
<p>创建Service层 GoodsService类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsService</span> </span>&#123;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在GoodsListServlet中调用服务层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"GoodsListServlet"</span>);</span><br><span class="line">		<span class="comment">// 调用服务层</span></span><br><span class="line">		GoodsService goodsService = <span class="keyword">new</span> GoodsService();</span><br><span class="line">		goodsService.getAllGoods();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>自动生成getAllGoods方法，抛出异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsService</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Goods&gt; <span class="title">getAllGoods</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		GoodsDao goodsDao = <span class="keyword">new</span> GoodsDao();</span><br><span class="line">		List&lt;Goods&gt; allGoods = goodsDao.getAllGoods();</span><br><span class="line">		<span class="keyword">return</span> allGoods;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继续写Servlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"GoodsListServlet"</span>);</span><br><span class="line">		<span class="comment">// 调用服务层</span></span><br><span class="line">		GoodsService goodsService = <span class="keyword">new</span> GoodsService();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			List&lt;Goods&gt; allGoods = goodsService.getAllGoods();</span><br><span class="line">			<span class="comment">// System.out.println(allGoods);</span></span><br><span class="line">			<span class="comment">// 把数据写到request域</span></span><br><span class="line">			request.setAttribute(<span class="string">"allGoods"</span>, allGoods);</span><br><span class="line">			<span class="comment">// 转发</span></span><br><span class="line">			request.getRequestDispatcher(<span class="string">"admin/main.jsp"</span>).forward(request, response);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>修改main.jsp的css路径</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">	String ctx = request.getContextPath();</span><br><span class="line">	pageContext.setAttribute(<span class="string">"ctx"</span>, ctx);</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">    &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"$&#123;ctx&#125;/admin/css/style.css"</span> type=<span class="string">"text/css"</span> /&gt;</span><br><span class="line">    &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"$&#123;ctx&#125;/admin/css/amazeui.min.css"</span> /&gt;</span><br><span class="line">    &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"$&#123;ctx&#125;/admin/css/pageStyle.css"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br></pre></td></tr></table></figure>
<p>测试网页</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;c:forEach items=<span class="string">"$&#123;allGoods &#125;"</span> <span class="keyword">var</span>=<span class="string">"goods"</span> varStatus=<span class="string">"status"</span>&gt;</span><br><span class="line">			&lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"list_goods_ul"</span>&gt;</span><br><span class="line">				&lt;!-- status是一个对象<span class="keyword">for</span>循环状态 index就是取当前<span class="keyword">for</span>循环角标 --&gt;</span><br><span class="line">				&lt;li&gt;$&#123;status.index+1 &#125;&lt;/li&gt;</span><br><span class="line">				&lt;li&gt;&lt;img src="$&#123;ctx &#125;/admin/images/pimages/$&#123;goods.image&#125;"&gt;&lt;/li&gt;</span><br><span class="line">				&lt;li&gt;$&#123;goods.name &#125;&lt;/li&gt;</span><br><span class="line">				&lt;li&gt;$&#123;goods.price &#125;&lt;/li&gt;</span><br><span class="line">				&lt;li&gt;&lt;a href=<span class="string">"#"</span>&gt;&lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">"img_icon"</span></span><br><span class="line">						src="$&#123;ctx &#125;/admin/images/edit_icon.png" alt=""&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">				&lt;li&gt;&lt;a href=<span class="string">"#"</span>&gt;&lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">"img_icon"</span></span><br><span class="line">						src="$&#123;ctx &#125;/admin/images/delete_icon.png" alt=""&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">			&lt;/ul&gt;</span><br><span class="line">		&lt;/c:forEach&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&lt;script src="$&#123;ctx &#125;/admin/js/jquery.min.js"&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script type="text/javascript" src="$&#123;ctx &#125;/admin/js/paging.js"&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/16/web-server-note-13/3.png" alt></p>
<h2 id="删除商品"><a href="#删除商品" class="headerlink" title="删除商品"></a>删除商品</h2><p>步骤同上</p>
<p>创建GoodsDelServlet类，测试连通<br>修改jsp的删除按钮的href，修改后可以用Chrome浏览器鼠标悬停，查看连接地址是否正确<br>在Servlet中接受参数，调用服务，服务中调用DAO，删除数据<br>Servlet中转发</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">"$&#123;allGoods &#125;"</span> <span class="keyword">var</span>=<span class="string">"goods"</span> varStatus=<span class="string">"status"</span>&gt;</span><br><span class="line">	&lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">"list_goods_ul"</span>&gt;</span><br><span class="line">		&lt;!-- status是一个对象<span class="keyword">for</span>循环状态 index就是取当前<span class="keyword">for</span>循环角标 --&gt;</span><br><span class="line">		&lt;li&gt;$&#123;status.index+1 &#125;&lt;/li&gt;</span><br><span class="line">		&lt;li&gt;&lt;img src="$&#123;ctx &#125;/admin/images/pimages/$&#123;goods.image&#125;"&gt;&lt;/li&gt;</span><br><span class="line">		&lt;li&gt;$&#123;goods.name &#125;&lt;/li&gt;</span><br><span class="line">		&lt;li&gt;$&#123;goods.price &#125;&lt;/li&gt;</span><br><span class="line">		&lt;li&gt;&lt;a href=<span class="string">""</span>&gt;&lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">"img_icon"</span></span><br><span class="line">				src="$&#123;ctx &#125;/admin/images/edit_icon.png" alt=""&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">		&lt;li&gt;&lt;a href=<span class="string">"$&#123;ctx &#125;/GoodsDelServlet?id=$&#123;goods.id&#125;"</span>&gt;&lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">"img_icon"</span></span><br><span class="line">				src="$&#123;ctx &#125;/admin/images/delete_icon.png" alt=""&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">	&lt;/ul&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

<p>GoodsDelServlet类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.web;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/GoodsDelServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsDelServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		<span class="comment">// System.out.println("GoodsDelServlet");</span></span><br><span class="line">		<span class="comment">// 1. 接收参数</span></span><br><span class="line">		String id = request.getParameter(<span class="string">"id"</span>);</span><br><span class="line">		<span class="comment">// System.out.println(id);</span></span><br><span class="line">		<span class="comment">// 2. 调用服务层</span></span><br><span class="line">		GoodsService goodsService = <span class="keyword">new</span> GoodsService();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			goodsService.deleteGoods(id);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		request.getRequestDispatcher(<span class="string">"GoodsListServlet"</span>).forward(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GoodsService类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	GoodsDao goodsDao = <span class="keyword">new</span> GoodsDao();</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Goods&gt; <span class="title">getAllGoods</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		List&lt;Goods&gt; allGoods = goodsDao.getAllGoods();</span><br><span class="line">		<span class="keyword">return</span> allGoods;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteGoods</span><span class="params">(String id)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		goodsDao.delGoods(Integer.parseInt(id));</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="添加商品"><a href="#添加商品" class="headerlink" title="添加商品"></a>添加商品</h2><p>修改goods表，增加描述、是否热门、cid<br><img src="/2020/02/16/web-server-note-13/4.png" alt="数据库"><br>增加分类表catogory<br><img src="/2020/02/16/web-server-note-13/5.png" alt="数据库"><br>添加数据<br>为goods表的cid做外键约束<br><strong>修改了表JavaBean也要修改</strong>，数据库需要对应<br><strong>对应的插入数据库操作也要更新</strong></p>
<p><img src="/2020/02/16/web-server-note-13/5.png" alt="添加商品"></p>
<p>创建GoodsAddUIServlet类<br>创建CategoryService类<br>GoodsAddUIServlet调用CategoryService中的findCategory方法<br>创建CategoryDao类 </p>
<p>GoodsAddUIServlet类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.web;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/GoodsAddUIServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsAddUIServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		<span class="comment">// 1.取出所有分类</span></span><br><span class="line">		List&lt;Category&gt; allCategory = <span class="keyword">null</span>;</span><br><span class="line">		CategoryService categoryService = <span class="keyword">new</span> CategoryService();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			allCategory = categoryService.findCategory();</span><br><span class="line">			System.out.println(allCategory);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 2.把分类存到域中</span></span><br><span class="line">		request.setAttribute(<span class="string">"allCategory"</span>, allCategory);</span><br><span class="line">		<span class="comment">// 3.转发edit.jsp</span></span><br><span class="line">		request.getRequestDispatcher(<span class="string">"admin/add.jsp"</span>).forward(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CategoryService类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">findCategory</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		CategoryDao categoryDao = <span class="keyword">new</span> CategoryDao();</span><br><span class="line">		List&lt;Category&gt; allCategory = categoryDao.getAllCategory();</span><br><span class="line">		<span class="keyword">return</span> allCategory;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CategoryDao类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getAllCategory</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		QueryRunner qr = <span class="keyword">new</span> QueryRunner(JDBCUtil.getDataSource());</span><br><span class="line">		String sql = <span class="string">"select * from category"</span>;</span><br><span class="line">		List&lt;Category&gt; allCategory  = qr.query(sql, <span class="keyword">new</span> BeanListHandler&lt;Category&gt;(Category.class));</span><br><span class="line">		<span class="keyword">return</span> allCategory;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改add.jsp<br>添加foreach，转发所以需要修改一些路径为绝对路径</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	String ctx = request.getContextPath();</span><br><span class="line">	pageContext.setAttribute(<span class="string">"ctx"</span>, ctx);</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">    &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"$&#123;ctx &#125;/admin/css/style.css"</span> type=<span class="string">"text/css"</span> /&gt;</span><br><span class="line">    &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"$&#123;ctx &#125;/admin/css/amazeui.min.css"</span> /&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"item1"</span>&gt;</span><br><span class="line">                &lt;span&gt;所属分类：&lt;/span&gt;</span><br><span class="line">                 &lt;select id=<span class="string">"category_select"</span>&gt;&amp;nbsp;&amp;nbsp;</span><br><span class="line">                 </span><br><span class="line">                 &lt;c:forEach items=<span class="string">"$&#123;allCategory &#125;"</span> <span class="keyword">var</span>=<span class="string">"category"</span>&gt;</span><br><span class="line">                 	&lt;option value="$&#123;category.cid &#125;"&gt;$&#123;category.cname &#125;&lt;/option&gt;</span><br><span class="line">                 &lt;/c:forEach&gt;</span><br><span class="line">                    </span><br><span class="line">                     </span><br><span class="line">                 &lt;/select&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">&lt;script src="$&#123;ctx &#125;/admin/js/jquery.min.js"&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    $(<span class="string">"#add"</span>).click(function () &#123;</span><br><span class="line">        $(window).attr(<span class="string">'location'</span>,<span class="string">'main.jsp'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    $(<span class="string">"#reset"</span>).click(function () &#123;</span><br><span class="line">       $(window).attr(<span class="string">'location'</span>,<span class="string">'add.jsp'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>修改main.jsp链接为GoodsAddUIServlet</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;script src="$&#123;ctx &#125;/admin/js/jquery.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type="text/javascript" src="$&#123;ctx &#125;/admin/js/paging.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">	<span class="comment">//分页</span></span><br><span class="line">	$(<span class="string">"#page"</span>).paging(&#123;</span><br><span class="line">		pageNo : <span class="number">5</span>,</span><br><span class="line">		totalPage : <span class="number">10</span>,</span><br><span class="line">		totalSize : <span class="number">300</span>,</span><br><span class="line">		callback : function(num) &#123;</span><br><span class="line">			alert(num);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	$(<span class="string">"#add"</span>).click(function() &#123;</span><br><span class="line">		$(window).attr(<span class="string">'location'</span>, <span class="string">'$&#123;ctx&#125;/GoodsAddUIServlet'</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>添加商品接收参数<br>创建GoodsAddServlet类<br>修改add.jsp的form表达的各个name属性和表单地址等<br>测试在Servlet获取所有参数的Map，使用BeanUtils封装，测试封装结果<br>调用服务层方法<br>服务处调用DAO<br><strong>字段介绍用desc，desc是数据库关键字，所以开发一般是gdesc</strong><br>修改类名为gdesc修改对应映射</p>
<p>GoodsAddServlet类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.web;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/GoodsAddServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsAddServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		<span class="comment">// System.out.println("GoodsAddServlet");</span></span><br><span class="line">		<span class="comment">// 1.获取所有参数</span></span><br><span class="line">		request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">		Map&lt;String, String[]&gt; map = request.getParameterMap();</span><br><span class="line">		<span class="comment">// System.out.println(map);</span></span><br><span class="line">		Goods goods = <span class="keyword">new</span> Goods();</span><br><span class="line">		BeanUtils beanUtils = <span class="keyword">new</span> BeanUtils();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			BeanUtils.populate(goods, map);</span><br><span class="line">			goods.setImage(<span class="string">"goods_11.png"</span>);</span><br><span class="line">			System.out.println(goods);</span><br><span class="line">			<span class="comment">// 调用服务层</span></span><br><span class="line">			GoodsService goodsService = <span class="keyword">new</span> GoodsService();</span><br><span class="line">			goodsService.addGoods(goods);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 跳转列表 取最新数据</span></span><br><span class="line">			request.getRequestDispatcher(<span class="string">"GoodsListServlet"</span>).forward(request, response);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GoodsService类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsService</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 保护DAO</span></span><br><span class="line">	<span class="keyword">private</span> GoodsDao goodsDao = <span class="keyword">new</span> GoodsDao();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Goods&gt; <span class="title">getAllGoods</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		List&lt;Goods&gt; allGoods = goodsDao.getAllGoods();</span><br><span class="line">		<span class="keyword">return</span> allGoods;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteGoods</span><span class="params">(String id)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		goodsDao.delGoods(Integer.parseInt(id));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addGoods</span><span class="params">(Goods goods)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		<span class="comment">// 调用DAO</span></span><br><span class="line">		goodsDao.addGoods(goods);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GoodsDao类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsDao</span> </span>&#123;</span><br><span class="line">	QueryRunner qr = <span class="keyword">new</span> QueryRunner(JDBCUtil.getDataSource());</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 增删改查</span></span><br><span class="line">	<span class="comment">// 1.从数据库中获取所有商品</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Goods&gt; <span class="title">getAllGoods</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		String sql = <span class="string">"select * from goods"</span>;</span><br><span class="line">		List&lt;Goods&gt; allGoods = qr.query(sql, <span class="keyword">new</span> BeanListHandler&lt;Goods&gt;(Goods.class));</span><br><span class="line">		<span class="keyword">return</span> allGoods;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2.添加商品到数据</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addGoods</span><span class="params">(Goods goods)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		String sql = <span class="string">"insert into goods (name,price,image,gdesc,is_hot,cid) value (?,?,?,?,?,?)"</span>;</span><br><span class="line">		qr.update(sql, goods.getName(), goods.getPrice(), goods.getImage(),goods.getGdesc(),goods.getIs_hot(),goods.getCid());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3.根据id删除商品</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delGoods</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		String sql = <span class="string">"delete from goods where id = ?"</span>;</span><br><span class="line">		qr.update(sql, id);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 4.修改指定商品</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateGoods</span><span class="params">(Goods goods)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">		String sql = <span class="string">"update goods set name=?,price=?,image=? where id = ?"</span>;</span><br><span class="line">		qr.update(sql,goods.getName(),goods.getPrice(),goods.getImage(),goods.getId());</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>add.jsp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">	&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"edit_content"</span>&gt;</span><br><span class="line">		&lt;form action=<span class="string">"$&#123;ctx &#125;/GoodsAddServlet"</span> method=<span class="string">"post"</span> id=<span class="string">"add_form"</span></span><br><span class="line">			style=<span class="string">"background: none; width: 700px"</span>&gt;</span><br><span class="line">			&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"item1"</span>&gt;</span><br><span class="line">				&lt;div&gt;</span><br><span class="line">					&lt;span&gt;商品名称：&lt;/span&gt; &lt;input type="text" class="am-form-field"</span><br><span class="line">						name=<span class="string">"name"</span>&gt;&amp;nbsp;&amp;nbsp;</span><br><span class="line">				&lt;/div&gt;</span><br><span class="line">				&lt;div&gt;</span><br><span class="line">					&lt;span&gt;商品价格：&lt;/span&gt; &lt;input type="text" class="am-form-field" name="price"&gt;</span><br><span class="line">				&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">			&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">			&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"item1"</span>&gt;</span><br><span class="line">				&lt;span&gt;所属分类：&lt;/span&gt; &lt;select id="category_select" name="cid"&gt;</span><br><span class="line"></span><br><span class="line">					&lt;c:forEach items=<span class="string">"$&#123;allCategory &#125;"</span> <span class="keyword">var</span>=<span class="string">"category"</span>&gt;</span><br><span class="line">						&lt;option value="$&#123;category.cid &#125;"&gt;$&#123;category.cname &#125;&lt;/option&gt;</span><br><span class="line">					&lt;/c:forEach&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				&lt;/select&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">			</span><br><span class="line">			&lt;div&gt;</span><br><span class="line">				&lt;span&gt;是否热门&lt;/span&gt;</span><br><span class="line">				&lt;select id=<span class="string">"category_select"</span> name=<span class="string">"is_hot"</span>&gt;</span><br><span class="line">					&lt;option value="0"&gt;否&lt;/option&gt;</span><br><span class="line">					&lt;option value="1"&gt;是&lt;/option&gt;</span><br><span class="line">				&lt;/select&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">			&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"item1"</span>&gt;</span><br><span class="line">				&lt;span&gt;商品图片：&lt;/span&gt; &lt;input type="file" name="image" id="upload" /&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">			&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"item1 item_desc"</span> &gt;</span><br><span class="line">				&lt;span&gt;商品描述：&lt;/span&gt;</span><br><span class="line">				&lt;textarea id="desc" name="gdesc" rows="4" cols="50"&gt;&lt;/textarea&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">			&lt;button class="am-btn am-btn-default" type="button" id="add"&gt;添加&lt;/button&gt;</span><br><span class="line">			&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;</span><br><span class="line">			&lt;button class="am-btn am-btn-default" type="button" id="reset"&gt;重置&lt;/button&gt;</span><br><span class="line">		&lt;/form&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script src="$&#123;ctx &#125;/admin/js/jquery.min.js"&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	$(<span class="string">"#add"</span>).click(function() &#123;</span><br><span class="line">		$(<span class="string">"#add_form"</span>).submit();</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	$(<span class="string">"#reset"</span>).click(function() &#123;</span><br><span class="line">		$(window).attr(<span class="string">'location'</span>, <span class="string">'add.jsp'</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h2><p>解决写入数据库乱码问题，编辑db.properties文件</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/mystore?useUnicode=true&amp;characterEncoding=utf-8</span></span><br></pre></td></tr></table></figure>
<p>反转集合（使得最后添加的显示到最开头）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.web;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/GoodsListServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsListServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"GoodsListServlet"</span>);</span><br><span class="line">		<span class="comment">// 调用服务层</span></span><br><span class="line">		GoodsService goodsService = <span class="keyword">new</span> GoodsService();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			List&lt;Goods&gt; allGoods = goodsService.getAllGoods();</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 反转集合</span></span><br><span class="line">			Collections.reverse(allGoods);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// System.out.println(allGoods);</span></span><br><span class="line">			<span class="comment">// 把数据写到request域</span></span><br><span class="line">			request.setAttribute(<span class="string">"allGoods"</span>, allGoods);</span><br><span class="line">			<span class="comment">// 转发</span></span><br><span class="line">			request.getRequestDispatcher(<span class="string">"admin/main.jsp"</span>).forward(request, response);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="编辑商品"><a href="#编辑商品" class="headerlink" title="编辑商品"></a>编辑商品</h2><p><img src="/2020/02/16/web-server-note-13/7.png" alt></p>
<p>创建GoodsEditUIServlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.web;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/GoodsEditUIServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsEditUIServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"GoodsEditUIServlet"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改main.jsp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;li&gt;&lt;a href=<span class="string">"$&#123;ctx &#125;/GoodsEditUIServlet?id=$&#123;goods.id&#125;"</span>&gt;&lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">"img_icon"</span></span><br><span class="line">						src="$&#123;ctx &#125;/admin/images/edit_icon.png" alt=""&gt;&lt;/a&gt;&lt;/li&gt;</span><br></pre></td></tr></table></figure>
<p>用Chrome查看地址是否包含了id参数</p>
<p>GoodsEditUIServlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.web;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/GoodsEditUIServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsEditUIServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		<span class="comment">// 接收id</span></span><br><span class="line">		String id = request.getParameter(<span class="string">"id"</span>);</span><br><span class="line">		<span class="comment">// System.out.println("GoodsEditUIServlet"+id);</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 1.获取当前商品</span></span><br><span class="line">			GoodsService goodsService = <span class="keyword">new</span> GoodsService();</span><br><span class="line">			Goods goods = goodsService.getGoodsWithId(id);</span><br><span class="line">			System.out.println(goods);</span><br><span class="line">			<span class="comment">// 把商品写入request域中</span></span><br><span class="line">			request.setAttribute(<span class="string">"goods"</span>, goods);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 2.获取所有分类</span></span><br><span class="line">			CategoryService categoryService = <span class="keyword">new</span> CategoryService();</span><br><span class="line">			List&lt;Category&gt; allCategory = categoryService.findCategory();</span><br><span class="line">			request.setAttribute(<span class="string">"allCategory"</span>, allCategory);</span><br><span class="line">			<span class="comment">// 3.转发到JSP页面</span></span><br><span class="line">			request.getRequestDispatcher(<span class="string">"/admin/edit.jsp"</span>).forward(request, response);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改edit.jsp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"item1"</span>&gt;</span><br><span class="line">        	&lt;div&gt;</span><br><span class="line">        		&lt;span&gt;所属分类：&lt;/span&gt;</span><br><span class="line">                 &lt;select id=<span class="string">"categorySel"</span> name=<span class="string">"cid"</span>&gt;</span><br><span class="line">                 	&lt;c:forEach items=<span class="string">"$&#123;allCategory &#125;"</span> <span class="keyword">var</span>=<span class="string">"category"</span>&gt;</span><br><span class="line">                 	 &lt;option value="$&#123;category.cid &#125;"&gt;$&#123;category.cname &#125;&lt;/option&gt;</span><br><span class="line">                 	&lt;/c:forEach&gt;</span><br><span class="line">                 &lt;/select&gt;</span><br><span class="line">                 &amp;nbsp;</span><br><span class="line">        	&lt;/div&gt;</span><br><span class="line">        	</span><br><span class="line">        	&lt;div&gt;</span><br><span class="line">        		&lt;span&gt;是否热门：&lt;/span&gt;</span><br><span class="line">                 &lt;select id=<span class="string">"isHotSel"</span> name=<span class="string">"is_hot"</span>&gt;</span><br><span class="line">                    &lt;!-- 让value的值等于商品is_hot的option成为选中状态 --&gt;</span><br><span class="line">                    &lt;option value="0"&gt;否&lt;/option&gt;</span><br><span class="line">                    &lt;option value="1"&gt;是&lt;/option&gt;</span><br><span class="line">                 &lt;/select&gt;</span><br><span class="line">        	&lt;/div&gt;        </span><br><span class="line">                 </span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"item1"</span>&gt;</span><br><span class="line">                &lt;span&gt;商品图片：&lt;/span&gt;</span><br><span class="line">                &lt;input type=<span class="string">"file"</span> name=<span class="string">"image"</span> /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"item1 item_desc"</span>&gt;</span><br><span class="line">            &lt;span&gt;商品描述：&lt;/span&gt;</span><br><span class="line">         &lt;textarea  id="desc" name="gdesc" rows="4" cols="50"&gt;$&#123;goods.gdesc &#125;&lt;/textarea&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;button class="am-btn am-btn-default" type="button" id="edit"&gt;更新&lt;/button&gt;</span><br><span class="line">        &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;</span><br><span class="line">        &lt;button class="am-btn am-btn-default" type="button" id="reset"&gt;重置&lt;/button&gt;</span><br><span class="line">		&lt;/form&gt;</span><br><span class="line">   &lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>创建GoodsEditServlet<br>修改edit.jsp 关联提交表单</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">"$&#123;ctx &#125;/GoodsEditServlet"</span> method=<span class="string">"post"</span> id=<span class="string">"edit_form"</span> style=<span class="string">"background: none; width: 700px;"</span>&gt;</span><br></pre></td></tr></table></figure>

<p>edit.jsp的form表单时提交获取id的技巧</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">"text"</span>  name=<span class="string">"id"</span> value=<span class="string">"$&#123;goods.id &#125;"</span> style=<span class="string">"display:none"</span>&gt;</span><br></pre></td></tr></table></figure>

<p>GoodsEditServlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myxq.web;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/GoodsEditServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsEditServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		<span class="comment">// 设置字符集 post</span></span><br><span class="line">		request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">		<span class="comment">// System.out.println("GoodsEditServlet");</span></span><br><span class="line">		<span class="comment">// 1.获取所有参数</span></span><br><span class="line">		Map&lt;String, String[]&gt; parameterMap = request.getParameterMap();</span><br><span class="line">		<span class="comment">// 2.封装成Goods对象</span></span><br><span class="line">		Goods goods = <span class="keyword">new</span> Goods();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			BeanUtils.populate(goods, parameterMap);</span><br><span class="line">			System.out.println(goods);</span><br><span class="line">			<span class="comment">// 3.根据id更新数据</span></span><br><span class="line">			<span class="comment">// 4.调用服务层 更新数据</span></span><br><span class="line">			GoodsService goodsService = <span class="keyword">new</span> GoodsService();</span><br><span class="line">			goods.setImage(<span class="string">"goods_10.png"</span>);</span><br><span class="line">			goodsService.updateGoods(goods);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 5.跳转mian.jsp</span></span><br><span class="line">			request.getRequestDispatcher(<span class="string">"GoodsListServlet"</span>).forward(request, response);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GoodsService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateGoods</span><span class="params">(Goods goods)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	goodsDao.updateGoods(goods);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GoodsDao</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.修改指定商品</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateGoods</span><span class="params">(Goods goods)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">	String sql = <span class="string">"update goods set name=?,price=?,image=? ,gdesc=?,is_hot=?,cid=? where id = ?"</span>;</span><br><span class="line">	qr.update(sql,goods.getName(),goods.getPrice(),goods.getImage(),goods.getGdesc(),goods.getIs_hot(),goods.getCid(),goods.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改更新商品页面（读取当前商品的信息）<br>edit.jsp</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">       </span><br><span class="line">	 $(<span class="string">"#edit"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	        <span class="comment">//让表单提交 GoodsEditServlet</span></span><br><span class="line">	        <span class="comment">//获取表单  让其提交</span></span><br><span class="line">	        $(<span class="string">"#edit_form"</span>).submit();</span><br><span class="line">	  &#125;);</span><br><span class="line">	 </span><br><span class="line">	 <span class="comment">//让value的值等于商品is_hot的option成为选中状态</span></span><br><span class="line">	 $(<span class="string">"#isHotSel option[value=$&#123;goods.is_hot&#125;]"</span>).prop(<span class="string">"selected"</span>,<span class="literal">true</span>);</span><br><span class="line">	 $(<span class="string">"#categorySel option[value=$&#123;goods.cid&#125;]"</span>).prop(<span class="string">"selected"</span>,<span class="literal">true</span>);</span><br><span class="line">	 </span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure>
<p>外层套一层$(function() 的原因是：等所有标签加载完毕，再去做执行里面的JQuery</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://study.163.com/course/introduction/1005981003.htm" target="_blank" rel="noopener">Java零基础到高级JavaWeb与项目</a></p>
</section>
    

    <footer id="post-meta" class="clearfix">
        <a href="/about/">
        <img class="avatar" src="/images/avatar.jpg">
        <div>
            <span class="dark">Aaron Lin</span>
            <span></span>
        </div>
        </a>
        <section id="sharing">
            <a title="Share to Twitter" class="twitter" href="https://twitter.com/intent/tweet?text=https://aaronlinv.github.io/2020/02/16/web-server-note-13/ - Web服务器笔记-三层架构实践 @" target="_blank" rel="noopener"><span class="icon-twitter">tweet</span></a>
            <a title="Share to Facebook" class="facebook" href="#" onclick="
                window.open(
                  'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
                  'facebook-share-dialog',
                  'width=626,height=436');
                return false;"><span class="icon-facebook-sign">Share</span>
            </a>
        </section>
    </footer>


  <section id="comment">
    <button class="btn" id="loadcmts" onclick="cmts.load();">加载评论</button>
    <div id="gitment"></div>
    <script src='/js/gitment.browser.js'></script>
    <link rel="stylesheet" href=''>
    <script>
      var cmts={
        load:function cmts(){
          var gitment = new Gitment({
          
            id: "Web服务器笔记-三层架构实践",
          
            owner: "",
            repo: "",
            oauth: {
              client_id: "",
              client_secret: "",
            },
          })
          gitment.render('gitment');
          var loadcmt = document.getElementById("loadcmts");
          var imyourfather = loadcmt.parentNode;
          imyourfather.removeChild(loadcmts)
        }
      }
    </script>
  </section>


	<footer id="footer">
    <div id="social">
        <p class="small">©
            Aaron Lin | Powered by Hexo &
                <a href="https://github.com/F0r3at/Lights" target="_blank" rel="noopener"> Lights</a>
        </p>
    </div>
</footer>
</section>

	<script src="//cdnjs.loli.net/ajax/libs/instantclick/3.0.1/instantclick.min.js" data-no-instant></script>
	<script data-no-instant>
		
		InstantClick.init('mousedown');
	</script>



