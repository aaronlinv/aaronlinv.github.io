<!DOCTYPE html>

<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">

  <meta name="description" content="ServletContextServletContext代表是一个web应用的上下文对象（web应用对象）里面封装的都是web应用信息一个ServletContext对应一个应用
ServletContext的生命周期在服务器一启动的时候就会创建在服务器关闭的时候销毁
如何获得上下文1.通过init">


<link rel="alternate" href="/atom.xml" title="Aaron Lin" type="application/atom+xml">
<meta name="theme-color" content="#a1d0f6">
<title>Web服务器笔记-Response - Aaron Lin</title>
<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->


<!-- <link rel="shortcut icon" href="/favicon.png"> -->

<link rel="shortcut icon" href="/favicon.ico">
<link rel="stylesheet" href="/css/style.css">
<!-- 谷歌 Analytics -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-153099566-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-153099566-1');
</script>


<nav class="main-nav">
	
	    <a href="/">← 主页</a>
	
	
	    <a href="/about/">关于</a>
	
	    <a href="/archives/">归档</a>
	
	<a class="cta" href="/rss2.xml" data-no-instant>订阅</a>
</nav>

<section id="wrapper">
    <article class="post">
    <header>
        
            <h1>Web服务器笔记-Response</h1>
        
        <h2 class="headline">Feb 09 2020
        
            
            <a href="/categories/Web服务器笔记/#Web服务器笔记">Web服务器笔记</a>
        
        </h2>
    </header>
</article>
<section id="post-body"><h2 id="ServletContext"><a href="#ServletContext" class="headerlink" title="ServletContext"></a>ServletContext</h2><p>ServletContext代表是一个web应用的上下文对象（web应用对象）<br>里面封装的都是web应用信息<br>一个ServletContext对应一个应用</p>
<p>ServletContext的生命周期<br>在服务器一启动的时候就会创建<br>在服务器关闭的时候销毁</p>
<p>如何获得上下文<br>1.通过init方法当中一个参数ServletConfig来获取<br>2.直接在HttpServlet当中获取，this.getServletContext，这种方法本质还是通过config来去获取的</p>
<p>子类在覆盖父类init方法的时候最好调用父类的初始化参数super.init(config);<br>不传入config，父类就没有config参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/OneServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OneServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.init(config);</span><br><span class="line">		ServletContext sc1 = config.getServletContext();</span><br><span class="line">		System.out.println(sc1);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"OneServlet"</span>);</span><br><span class="line">		ServletContext context = <span class="keyword">this</span>.getServletContext();</span><br><span class="line">		<span class="comment">// 这种方法本质还是通过config获取</span></span><br><span class="line">		<span class="comment">// 重写了init方法，用这种方法调用空指针异常</span></span><br><span class="line">		<span class="comment">// 原因是子类覆盖了父类init方法</span></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		@Override</span></span><br><span class="line"><span class="comment">    	public void init(ServletConfig config) throws ServletException &#123;</span></span><br><span class="line"><span class="comment">        this.config = config;</span></span><br><span class="line"><span class="comment">        this.init();</span></span><br><span class="line"><span class="comment">    	&#125;</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="comment">// 解决：在init方法添加super.init(config);</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取全局的初始化参数<br>初始化参数不能再某一个Servlet当中来去配置。在最外层来去配置<br>获取全局初始化参数</p>
<p>获得Web应用中某一个资源的资源的绝对路径<br>context.getRealPath(“文件”)<br>相对的是web应有根目录<br>context.getRealPath(“index.html”)<br>D:\Java\Tomcat\apache-tomcat-7.0.85\webapps\bei\index.html<br>在文件名称前面自动拼接上当前工程的绝对地址</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">String  realPath = context.getRealPath(<span class="string">"WEB-INF/a.txt"</span>); <span class="comment">// a.txt 在WEB-INF里</span></span><br><span class="line">System.out.println(realPath);<span class="comment">// D:\Tomcat\apache-tomcat-7.0.85\webapps\26-Servlet\WEB-INF\a.txt</span></span><br><span class="line">System.out.println();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过类加载器，获取字节码路径</span></span><br><span class="line">String path = OneServlet.class.getClassLoader().getResource(<span class="string">"c.txt"</span>).getPath(); <span class="comment">// c.txt 在src下</span></span><br><span class="line">System.out.println(path);	<span class="comment">// /D:/Tomcat/apache-tomcat-7.0.85/webapps/26-Servlet/WEB-INF/classes/c.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果在包内，路径就要加上包路径</span></span><br></pre></td></tr></table></figure>

<p>ServletContext是一个域对象<br>域：能够存储数据<br>域对象：能够存取数据数据就的对象</p>
<p>ServletContext域对象的作用范围<br>整个web应用<br>所有的web资源都可以进行存取数据<br>数据是可以共享的<br>只要是一个域对象上，基本上里面都有这几个方法:<br>获取完ServletContext之后向里面写数据：context.setAttribute(String name,Object value);<br>获取完ServletContext之后，通过name取出存放的数据：context.getAttribute(String name);<br>获取完ServletContext之后，删除指定名称的值：context.removeAttribute(String name);</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ServletContext context = config.getServletContext();</span><br><span class="line">sc1.setAttribute(<span class="string">"lk"</span>, <span class="string">"lks"</span>);</span><br><span class="line">String value =(String) context.getAttribute(<span class="string">"lk"</span>);<span class="comment">// 其他Servlet也可以get到</span></span><br><span class="line">System.out.println(value);</span><br></pre></td></tr></table></figure>


<h2 id="Response响应过程"><a href="#Response响应过程" class="headerlink" title="Response响应过程"></a>Response响应过程</h2><p><img src="/2020/02/09/web-server-note-5/1.png" alt="Response响应过程"></p>
<p>在去发送一个请求时， 会找到tomcat引擎<br>引擎会找到对应的web应用，并且会创建request对象和response对象<br>找到应用后， 会执行应用的web.xml再去根据url-patten的内容创建Servlet对象<br>并且会调用Servlet对象的service方法，并且把创建的request对象和response对象传入到方法当中<br>拿到response对象后，  自己可以往响应当中写入一些自己给客户端的内容，通过response.getwrite().wirte(“写的内容”)方法进行写入<br>写的内容，是存到一个response缓冲区当中<br>当方法执行结束之后， tomcat就会从response缓冲区当中取出数据，取出你的数据同时，它自己还会自动的往里面添加一些服务器相关的信息进去，所以响应给浏览器时， 可以看到除了自己写的内容， 还会有一些服务器相关的信息</p>
<h2 id="response"><a href="#response" class="headerlink" title="response"></a>response</h2><p>通过response设置响应行，响应头 ，响应体</p>
<h4 id="设置响应行"><a href="#设置响应行" class="headerlink" title="设置响应行"></a>设置响应行</h4><p>response.setState(Int code)</p>
<h4 id="设置响应头"><a href="#设置响应头" class="headerlink" title="设置响应头"></a>设置响应头</h4><p>add：代表添加新的内容<br>addHeader(String name,String value)<br>addIntHeader(String name,int value)<br>addDateHeader(String name,date)</p>
<p>set：代表设置，已经存在的内容（可以修改自己add，也可以修改默认的）<br>setHeader(String name,String value)<br>setIntHeader(String name,int value)<br>setDateHeader(String name,Date value)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">response.setStatus(<span class="number">302</span>);</span><br><span class="line"><span class="comment">// add</span></span><br><span class="line">response.addHeader(<span class="string">"name"</span>, <span class="string">"it666"</span>);</span><br><span class="line">response.addIntHeader(<span class="string">"age"</span>, <span class="number">10</span>);</span><br><span class="line">response.addDateHeader(<span class="string">"my-Date"</span>, <span class="keyword">new</span> Date().getTime());<span class="comment">// 获取当前毫秒值</span></span><br><span class="line"><span class="comment">// set</span></span><br></pre></td></tr></table></figure>

<h4 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h4><p>到服务器当中去找servlet1，servlet1当中没有这个资源，告诉你去找servlet2，再去发送一个请求到servlet2</p>
<p>状态码：302</p>
<p>特点：要访问两次服务器<br>第一次访问是人为的去访问<br>第二次是自动的访问<br>浏览器地址栏已经发生变化</p>
<p>设置重定向</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.设置响应码302</span></span><br><span class="line">response.setStatus(<span class="number">302</span>);</span><br><span class="line"><span class="comment">// 2.设置重定向 /项目名/Servlet名</span></span><br><span class="line">response.setHeader(<span class="string">"location"</span>, <span class="string">"/26-Servlet/LocationServlet"</span>);</span><br></pre></td></tr></table></figure>

<p>封装的重写向<br>每次都要写状态码，和location比较麻烦<br>就给封装了一个方法<br>response.sendRedirect(“/26-Servlet/LocationServlet”);</p>
<p>定时刷新重定向<br>response.setHeader(“refresh”,”5;url=<a href="http://www.baidu.com&quot;" target="_blank" rel="noopener">http://www.baidu.com&quot;</a>)<br>5代表5秒<br>url的值为5秒后要去跳转的地址</p>
<h5 id="设置响应体"><a href="#设置响应体" class="headerlink" title="设置响应体"></a>设置响应体</h5><ol>
<li>通过write方法来写<br>response.getwrite().wirte(“要写的内容或HTML代码”);</li>
</ol>
<p>默认情况下写的中文内容会乱码<br>写的内容存到缓存区中使用的是ISO8859，ISO8859不支持中文，所以会乱码</p>
<p>解决中文乱码：<br>在存之前设置可以设置存放的编码<br>response.setCharacterEncoding(“UTF-8”)<br>告知浏览器使用的是utf-8编码<br>response.setHeader(“Content-Type”, “text/html;charset=UTF-8”);</p>
<p>只需要设置Content-Type就可以了，Tomcat看到设置了为utf-8的编码，它在存的时候也会使用utf-8的编码<br>使用封装写法：response.setContentType(“text/html;charset=UTF-8”);</p>
<ol start="2">
<li>通过OutPutStream来写</li>
</ol>
<p>FileInputSteam<br>read方法读取一个字节</p>
<p>read(byte[] b)<br>    一次读取多个字节,并存放到数组b中<br>    上面是一次一滴一滴给你，这种是一次装一水桶再给你</p>
<p>读取全部的数据</p>
<p>FileOutputSteam<br>write()<br>    一次性写一个字符<br>write(buffer)<br>    一个性写多个字符<br>write(buffer,0,len)<br>    一次性写指定个数的字符</p>
<p>response注意点<br>    getWrite()和getOutputSteam不能同时调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// read 读一个字符 完毕返回-1</span></span><br><span class="line"><span class="comment">// System.out.println(in.read());</span></span><br><span class="line"><span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">5</span>];</span><br><span class="line">System.out.println(Arrays.toString(buffer));<span class="comment">// [0,0,0,0,0]</span></span><br><span class="line"><span class="comment">// 当前读取了几个字符 ，读到最后返回-1</span></span><br><span class="line"><span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> ((len = in.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">    System.out.println(<span class="keyword">new</span> String (buffer,<span class="number">0</span>,len));</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 关闭文件</span></span><br><span class="line">in.close();</span><br></pre></td></tr></table></figure>

<p>写入图片案例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.it666.response;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletOutputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/ResImgServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResImgServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		<span class="comment">// 向浏览器写一张图片</span></span><br><span class="line">		String path = <span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">"8.png"</span>);</span><br><span class="line">		<span class="comment">// 加载图片</span></span><br><span class="line">		FileInputStream in = <span class="keyword">new</span> FileInputStream(path);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 获取输出流</span></span><br><span class="line">		ServletOutputStream out = response.getOutputStream();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">		<span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span> ((len = in.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">			out.write(buffer,<span class="number">0</span>,len);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="下载功能"><a href="#下载功能" class="headerlink" title="下载功能"></a>下载功能</h4><p>把服务器当中的文件直接下载到电脑当中</p>
<p>1.直接使用a标签来去下载<br>有些内容会浏览器自动解析<br>浏览器不能解析的文件才会被下载</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 8.png路径：WebContent/download --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/26-Servlet/download/8.png"</span>&gt;</span>8.png<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.通过发送Servlet请求来去下载</p>
<p>通过发送一个Servlet请求，把文件名发送给服务器<br>发送给服务器后，接收到文件名参数，获取文件的绝对地址<br>通过流的形式来去写到浏览器<br>还得要告诉文件是什么类型</p>
<p>浏览器是以MIME的类型来识别类型<br>this.getServletContext().getMimeType(“文件名称”)</p>
<p>设置响应的类型<br>res.setContentType(“MIME类型”)</p>
<p>设置响应头，告诉浏览器不要去解析，是以附件的形式打开，<br>res.setHeader(“Content-Disposition”,”attachment;filename=”+文件名)</p>
<p>步骤<br>1.接收文件名参数<br>2.获取mime类型<br>3.设置浏览器响应类型<br>4.告诉浏览器以附件形式下载<br>5.获取文件的绝对路径<br>6.读取文件流<br>7.获取输出流<br>8.把内容写出到输出流</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- ?后面跟参数，多个参数用&amp;隔开 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/26-Servlet/DownloadServlet?filename=8.png"</span>&gt;</span>8.png<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 写在service里</span></span><br><span class="line">String name = request.getParameter(<span class="string">"filename"</span>);</span><br><span class="line">		System.out.println(name);<span class="comment">// 8.png</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//根据文件名获取mime类型</span></span><br><span class="line">		String mimeType = <span class="keyword">this</span>.getServletContext().getMimeType(name);</span><br><span class="line">		System.out.println(<span class="string">"mimeType:"</span>+mimeType);<span class="comment">// mimeType:image/png</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//设置mimeType</span></span><br><span class="line">		response.setContentType(mimeType);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 告诉浏览器以附件形式打开 </span></span><br><span class="line">		response.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment;filename="</span>+name);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 拼接文件路径</span></span><br><span class="line">		String path = <span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">"download/"</span>+name);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//加载文件</span></span><br><span class="line">		FileInputStream in =  <span class="keyword">new</span> FileInputStream(path);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取响应的输出</span></span><br><span class="line">		ServletOutputStream out = response.getOutputStream();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">byte</span> [] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">		<span class="keyword">int</span> len =<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span> ((len = in.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">			out.write(buffer,<span class="number">0</span>,len);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		in.close();</span><br></pre></td></tr></table></figure>


<p>获取中文参数报错问题<br>高版本tomcat中的新特性：就是严格按照 RFC 3986规范进行访问解析，而 RFC 3986规范定义了Url中只允许包含英文字母（a-zA-Z）、数字（0-9）、-_.~4个特殊字符以及所有保留字符(RFC3986中指定了以下字符为保留字符：! * ’ ( ) ; : @ &amp; = + $ , / ? # [ ])</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.../conf/catalina.properties中，找到最后注释掉的一行 </span><br><span class="line">#tomcat.util.http.parser.HttpParser.requestTargetAllow=| 去掉#，在最后加上 &#123;&#125; 表示把&#123;&#125;放行</span><br><span class="line">tomcat.util.http.parser.HttpParser.requestTargetAllow=|&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>1.把获取的字符串参数的字节码获取，再重新使用utf-8编码<br>2.在设置以附件形式打开时， 不同的浏览器会对默认的名字进行解码<br>所以根据不同的浏览器，要对名称进行编码之后，再放入文件名<br>对文件名进行编码<br>不同的浏览器编码不一样，要先获取agent，取出浏览器的类型，根据不同的浏览器类型进行编码</p>
<p>步骤<br>    1.接收文件名称<br>    2.获取mimeType<br>    3.设置浏览器响应类型<br>    4.先对传入的参数转成二进制流，再使用UTF-8进行编码<br>    5.获取浏览器的信息<br>    6.判断是哪一种浏览器，根据不同的浏览器获取一个编码的文件名<br>    7.设置以附件形式下载，传的名称是编码过的名称<br>    8.获取文件的绝对路径<br>    9.读取文件流<br>    10.获取输出流<br>    11.把文件写到响应当中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取客户端信息</span></span><br><span class="line">String agent = request.getHeader(<span class="string">"User-Agent"</span>);</span><br><span class="line"><span class="comment">// 定义一个变量记录编码之后的名字</span></span><br><span class="line">String filenameEncoder = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">if</span> (agent.contains(<span class="string">"MSIE"</span>)) &#123;</span><br><span class="line">	<span class="comment">// IE编码</span></span><br><span class="line">	filenameEncoder = URLEncoder.encode(filename, <span class="string">"utf-8"</span>);</span><br><span class="line">	filenameEncoder = filenameEncoder.replace(<span class="string">"+"</span>, <span class="string">" "</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (agent.contains(<span class="string">"Firefox"</span>)) &#123;</span><br><span class="line">	<span class="comment">// 火狐编码</span></span><br><span class="line">	BASE64Encoder base64Encoder = <span class="keyword">new</span> BASE64Encoder();</span><br><span class="line">	filenameEncoder = <span class="string">"=?utf-8?B?"</span> + base64Encoder.encode(filename.getBytes(<span class="string">"utf-8"</span>)) + <span class="string">"?="</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="comment">// 浏览器编码</span></span><br><span class="line">	filenameEncoder = URLEncoder.encode(filename, <span class="string">"utf-8"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DK中的/lib/tool.jar和/lib/rt.jar已经从Java SE 9中删除</span></span><br><span class="line"><span class="comment">// JDK9 及以后要用下面的方式导包和创建对象</span></span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64.Encoder;</span><br><span class="line"><span class="comment">// 修改代码</span></span><br><span class="line">Encoder base64Encoder = Base64.getEncoder();</span><br></pre></td></tr></table></figure>


<h4 id="注册验证码功能"><a href="#注册验证码功能" class="headerlink" title="注册验证码功能"></a>注册验证码功能</h4><p>验证码可以防止：恶意批量注册、恶意破解密码、刷票、论坛灌水<br>有效防止某个黑客对某一个特定注册用户用特定程序暴力破解方式进行不断的登陆尝试<br>确保当前访问是来自一个人而非机器</p>
<ol>
<li>把别人写好的验证码Servlet拿到程序当中</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.it666.code;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.Color;</span><br><span class="line"><span class="keyword">import</span> java.awt.Font;</span><br><span class="line"><span class="keyword">import</span> java.awt.Graphics;</span><br><span class="line"><span class="keyword">import</span> java.awt.Graphics2D;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/CheckCodeServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckCodeServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 集合中保存所有成语</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;String&gt; words = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		<span class="comment">// 初始化阶段，读取new_words.txt</span></span><br><span class="line">		<span class="comment">// web工程中读取 文件,必须使用绝对磁盘路径</span></span><br><span class="line">		String path = getServletContext().getRealPath(<span class="string">"/WEB-INF/words.txt"</span>);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(path));</span><br><span class="line">			String line;</span><br><span class="line">			<span class="comment">//把读的成语全部添加到一个集合当中</span></span><br><span class="line">			<span class="keyword">while</span> ((line = reader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">				words.add(line);</span><br><span class="line">			&#125;</span><br><span class="line">			reader.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		<span class="comment">// 禁止缓存</span></span><br><span class="line">		<span class="keyword">int</span> width = <span class="number">120</span>;</span><br><span class="line">		<span class="keyword">int</span> height = <span class="number">30</span>;</span><br><span class="line">		<span class="comment">// 步骤一 绘制一张内存中图片</span></span><br><span class="line">		BufferedImage bufferedImage = <span class="keyword">new</span> BufferedImage(width, height,</span><br><span class="line">				BufferedImage.TYPE_INT_RGB);</span><br><span class="line">		<span class="comment">// 步骤二 图片绘制背景颜色 ---通过绘图对象</span></span><br><span class="line">		Graphics graphics = bufferedImage.getGraphics();<span class="comment">// 得到画图对象 --- 画笔</span></span><br><span class="line">		<span class="comment">// 绘制任何图形之前 都必须指定一个颜色</span></span><br><span class="line">		graphics.setColor(getRandColor(<span class="number">200</span>, <span class="number">250</span>));</span><br><span class="line">		graphics.fillRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">		<span class="comment">// 步骤三 绘制边框</span></span><br><span class="line">		graphics.setColor(Color.WHITE);</span><br><span class="line">		graphics.drawRect(<span class="number">0</span>, <span class="number">0</span>, width - <span class="number">1</span>, height - <span class="number">1</span>);</span><br><span class="line">		<span class="comment">// 步骤四 四个随机数字</span></span><br><span class="line">		Graphics2D graphics2d = (Graphics2D) graphics;</span><br><span class="line">		<span class="comment">// 设置输出字体</span></span><br><span class="line">		graphics2d.setFont(<span class="keyword">new</span> Font(<span class="string">"宋体"</span>, Font.BOLD, <span class="number">18</span>));</span><br><span class="line">		Random random = <span class="keyword">new</span> Random();<span class="comment">// 生成随机数</span></span><br><span class="line">		<span class="keyword">int</span> index = random.nextInt(words.size());</span><br><span class="line">		String word = words.get(index);<span class="comment">// 获得成语</span></span><br><span class="line">		<span class="comment">// 定义x坐标</span></span><br><span class="line">		<span class="keyword">int</span> x = <span class="number">10</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; word.length(); i++) &#123;</span><br><span class="line">			<span class="comment">// 随机颜色</span></span><br><span class="line">			graphics2d.setColor(<span class="keyword">new</span> Color(<span class="number">20</span> + random.nextInt(<span class="number">110</span>), <span class="number">20</span> + random</span><br><span class="line">					.nextInt(<span class="number">110</span>), <span class="number">20</span> + random.nextInt(<span class="number">110</span>)));</span><br><span class="line">			<span class="comment">// 旋转 -30 --- 30度</span></span><br><span class="line">			<span class="keyword">int</span> jiaodu = random.nextInt(<span class="number">60</span>) - <span class="number">30</span>;</span><br><span class="line">			<span class="comment">// 换算弧度</span></span><br><span class="line">			<span class="keyword">double</span> theta = jiaodu * Math.PI / <span class="number">180</span>;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 获得字母数字</span></span><br><span class="line">			<span class="keyword">char</span> c = word.charAt(i);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 将c 输出到图片</span></span><br><span class="line">			graphics2d.rotate(theta, x, <span class="number">20</span>);</span><br><span class="line">			graphics2d.drawString(String.valueOf(c), x, <span class="number">20</span>);</span><br><span class="line">			graphics2d.rotate(-theta, x, <span class="number">20</span>);</span><br><span class="line">			x += <span class="number">30</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 将验证码内容保存session</span></span><br><span class="line">		request.getSession().setAttribute(<span class="string">"checkcode_session"</span>, word);</span><br><span class="line">		<span class="comment">//把生成的验证码存放到全局域对象当中</span></span><br><span class="line">		<span class="keyword">this</span>.getServletContext().setAttribute(<span class="string">"checkCode"</span>, word);</span><br><span class="line">		<span class="comment">// 步骤五 绘制干扰线</span></span><br><span class="line">		graphics.setColor(getRandColor(<span class="number">160</span>, <span class="number">200</span>));</span><br><span class="line">		<span class="keyword">int</span> x1;</span><br><span class="line">		<span class="keyword">int</span> x2;</span><br><span class="line">		<span class="keyword">int</span> y1;</span><br><span class="line">		<span class="keyword">int</span> y2;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">			x1 = random.nextInt(width);</span><br><span class="line">			x2 = random.nextInt(<span class="number">12</span>);</span><br><span class="line">			y1 = random.nextInt(height);</span><br><span class="line">			y2 = random.nextInt(<span class="number">12</span>);</span><br><span class="line">			graphics.drawLine(x1, y1, x1 + x2, x2 + y2);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 将上面图片输出到浏览器 ImageIO</span></span><br><span class="line">		graphics.dispose();<span class="comment">// 释放资源</span></span><br><span class="line">		<span class="comment">//将图片写到response.getOutputStream()中</span></span><br><span class="line">		ImageIO.write(bufferedImage, <span class="string">"jpg"</span>, response.getOutputStream());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 取其某一范围的color</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> fc</span></span><br><span class="line"><span class="comment">	 *            int 范围参数1</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> bc</span></span><br><span class="line"><span class="comment">	 *            int 范围参数2</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> Color</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Color <span class="title">getRandColor</span><span class="params">(<span class="keyword">int</span> fc, <span class="keyword">int</span> bc)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 取其随机颜色</span></span><br><span class="line">		Random random = <span class="keyword">new</span> Random();</span><br><span class="line">		<span class="keyword">if</span> (fc &gt; <span class="number">255</span>) &#123;</span><br><span class="line">			fc = <span class="number">255</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (bc &gt; <span class="number">255</span>) &#123;</span><br><span class="line">			bc = <span class="number">255</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> r = fc + random.nextInt(bc - fc);</span><br><span class="line">		<span class="keyword">int</span> g = fc + random.nextInt(bc - fc);</span><br><span class="line">		<span class="keyword">int</span> b = fc + random.nextInt(bc - fc);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Color(r, g, b);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>编写静态页面</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">	<span class="function"><span class="keyword">function</span> <span class="title">change</span><span class="params">(obj)</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">		<span class="comment">// alert(obj);</span></span></span><br><span class="line"><span class="actionscript">		<span class="comment">// 浏览器加载同样地址使用的是缓存</span></span></span><br><span class="line"><span class="javascript">		obj.src = <span class="string">"/26-Servlet/CheckCodeServlet?time"</span>+<span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span></span><br><span class="line">	&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/26-Servlet/RegisterServlet"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">""</span> <span class="attr">src</span>=<span class="string">"/26-Servlet/CheckCodeServlet"</span> <span class="attr">onclick</span>=<span class="string">"change(this)"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- this 指的就是这个img --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"请输入验证码..."</span> <span class="attr">name</span>=<span class="string">"code"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"注册"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>编写判断验证码是否正确Servlet</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.it666.code;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/RegisterServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegisterServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		String code = request.getParameter(<span class="string">"code"</span>);</span><br><span class="line">		System.out.println(code); <span class="comment">// 中文乱码</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">byte</span>[] bytes = code.getBytes(<span class="string">"ISO8859-1"</span>);</span><br><span class="line">		code = <span class="keyword">new</span> String (bytes,<span class="string">"UTF-8"</span>);</span><br><span class="line">		System.out.println(code);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 取出生成的字符串</span></span><br><span class="line">		String  word = (String) <span class="keyword">this</span>.getServletContext().getAttribute(<span class="string">"checkCode"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 设置字符集，不然 下面的字会乱码</span></span><br><span class="line">		response.setContentType(<span class="string">"text/html;charset=UTF-8"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (code.equals(word)) &#123;</span><br><span class="line">			response.getWriter().write(<span class="string">"注册成功"</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			response.getWriter().write(<span class="string">"验证码错误"</span>);</span><br><span class="line">			<span class="comment">// 重新跳转到原界面</span></span><br><span class="line">			response.setHeader(<span class="string">"refresh"</span>, <span class="string">"1;url=/26-Servlet/code.html"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1.设置响应编码<br>2.从ServletContext当中获取验证码<br>3.获取传入的请求参数<br>4.从servletContext当中取出存放的验证码<br>5.把接收的验证码与取出的验证码时行比较<br>6.相同时，显示成功<br>7.不同时， 显示失败，隔3秒钟跳转到输入验证码界面</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://study.163.com/course/introduction/1005981003.htm" target="_blank" rel="noopener">Java零基础到高级JavaWeb与项目</a><br><a href="https://blog.csdn.net/xie_sining/article/details/80777164" target="_blank" rel="noopener">Java 9版本之后Base64Encoder和Base64Decoder无法继续使用解决办法</a></p>
</section>
    

    <footer id="post-meta" class="clearfix">
        <a href="/about/">
        <img class="avatar" src="/images/avatar.jpg">
        <div>
            <span class="dark">Aaron Lin</span>
            <span></span>
        </div>
        </a>
        <section id="sharing">
            <a title="Share to Twitter" class="twitter" href="https://twitter.com/intent/tweet?text=https://aaronlinv.github.io/2020/02/09/web-server-note-5/ - Web服务器笔记-Response @" target="_blank" rel="noopener"><span class="icon-twitter">tweet</span></a>
            <a title="Share to Facebook" class="facebook" href="#" onclick="
                window.open(
                  'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
                  'facebook-share-dialog',
                  'width=626,height=436');
                return false;"><span class="icon-facebook-sign">Share</span>
            </a>
        </section>
    </footer>


  <section id="comment">
    <button class="btn" id="loadcmts" onclick="cmts.load();">加载评论</button>
    <div id="gitment"></div>
    <script src='/js/gitment.browser.js'></script>
    <link rel="stylesheet" href=''>
    <script>
      var cmts={
        load:function cmts(){
          var gitment = new Gitment({
          
            id: "Web服务器笔记-Response",
          
            owner: "",
            repo: "",
            oauth: {
              client_id: "",
              client_secret: "",
            },
          })
          gitment.render('gitment');
          var loadcmt = document.getElementById("loadcmts");
          var imyourfather = loadcmt.parentNode;
          imyourfather.removeChild(loadcmts)
        }
      }
    </script>
  </section>


	<footer id="footer">
    <div id="social">
        <p class="small">©
            Aaron Lin | Powered by Hexo &
                <a href="https://github.com/F0r3at/Lights" target="_blank" rel="noopener"> Lights</a>
        </p>
    </div>
</footer>
</section>

	<script src="//cdnjs.loli.net/ajax/libs/instantclick/3.0.1/instantclick.min.js" data-no-instant></script>
	<script data-no-instant>
		
		InstantClick.init('mousedown');
	</script>



