<!DOCTYPE html>

<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">

  <meta name="description" content="昨天在配置Hadoop的时候，使用SSH因为权限配置出现了一点问题搜索发现，大家的权限配置都不太一致，所以自己开了两个虚拟机测试一下如果对 SSH原理 不了解可以先看下这个 图解SSH原理
两台虚拟机A和BB的ip：192.168.108.140用户都为Hadoop
A 通过SSH 免密登录B

在">


<link rel="alternate" href="/atom.xml" title="Aaron Lin" type="application/atom+xml">
<meta name="theme-color" content="#a1d0f6">
<title>Linux-SSH - Aaron Lin</title>
<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->


<!-- <link rel="shortcut icon" href="/favicon.png"> -->

<link rel="shortcut icon" href="/favicon.ico">
<link rel="stylesheet" href="/css/style.css">
<!-- 谷歌 Analytics -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-153099566-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-153099566-1');
</script>


<nav class="main-nav">
	
	    <a href="/">← 主页</a>
	
	
	    <a href="/about/">关于</a>
	
	    <a href="/archives/">归档</a>
	
	<a class="cta" href="/rss2.xml" data-no-instant>订阅</a>
</nav>

<section id="wrapper">
    <article class="post">
    <header>
        
            <h1>Linux-SSH</h1>
        
        <h2 class="headline">Feb 25 2020
        
            
            <a href="/categories/Linux笔记/#Linux笔记">Linux笔记</a>
        
        </h2>
    </header>
</article>
<section id="post-body"><p>昨天在配置Hadoop的时候，使用SSH因为权限配置出现了一点问题<br>搜索发现，大家的权限配置都不太一致，所以自己开了两个虚拟机测试一下<br>如果对 SSH原理 不了解可以先看下这个 <a href="https://www.cnblogs.com/diffx/p/9553587.html" target="_blank" rel="noopener">图解SSH原理</a></p>
<p>两台虚拟机A和B<br>B的ip：192.168.108.140<br>用户都为Hadoop</p>
<p>A 通过SSH 免密登录B</p>
<ol>
<li>在 虚拟机A Hadoop家目录下新建.ssh</li>
<li>cd .shh 使用 ssh-keygen -t rsa 生成公私钥 (运行 ssh-keygen -t rsa 后直接敲回车)</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@localhost ~]$ mkdir .ssh</span><br><span class="line">[hadoop@localhost ~]$ <span class="built_in">cd</span> .ssh/</span><br><span class="line">[hadoop@localhost .ssh]$ ssh-keygen -t rsa</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/home/hadoop/.ssh/id_rsa): </span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /home/hadoop/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /home/hadoop/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:SKDjW+zcm6hoGpDC4muNMZB5W8INPpv7KRZMN3SVR4w hadoop@localhost.localdomain</span><br><span class="line">The key<span class="string">'s randomart image is:</span></span><br><span class="line"><span class="string">+---[RSA 2048]----+</span></span><br><span class="line"><span class="string">|    .  ..=.      |</span></span><br><span class="line"><span class="string">|  ..... E o      |</span></span><br><span class="line"><span class="string">| =o+ ..  .       |</span></span><br><span class="line"><span class="string">|=oBo=. .         |</span></span><br><span class="line"><span class="string">|*=.Oo.. S        |</span></span><br><span class="line"><span class="string">|=o*= .           |</span></span><br><span class="line"><span class="string">|..*oo .          |</span></span><br><span class="line"><span class="string">| *=. o o         |</span></span><br><span class="line"><span class="string">|*o.++ o          |</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>把公钥 id_rsa.pub 通过 scp 拷贝到 B虚拟机 的 /home/hadoop/  如果已存在会覆盖</li>
<li>第一次连接会提示，输入 yes ，然后输入 B虚拟机 的Hadoop账户的密码，默认是用本机的用户名登录，需要登录其他用户的格式是：用户名@ip地址 如：<a href="mailto:root@192.168.108.140" target="_blank" rel="noopener">root@192.168.108.140</a></li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@localhost .ssh]$ ll</span><br><span class="line">总用量 8</span><br><span class="line">-rw-------. 1 hadoop hadoop 1675 2月  25 08:38 id_rsa</span><br><span class="line">-rw-r--r--. 1 hadoop hadoop  410 2月  25 08:38 id_rsa.pub</span><br><span class="line">[hadoop@localhost .ssh]$ scp id_rsa.pub 192.168.108.140:/home/hadoop/</span><br><span class="line">The authenticity of host <span class="string">'192.168.108.140 (192.168.108.140)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:tFi+lLLHECXTtozqdB9y5ivkor28HNW6H9j5ooFiaAo.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is MD5:3a:c4:5a:fc:fb:e6:e3:b9:f9:63:f3:0c:2e:f1:d9:51.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added '</span>192.168.108.140<span class="string">' (ECDSA) to the list of known hosts.</span></span><br><span class="line"><span class="string">hadoop@192.168.108.140'</span>s password:</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>切换到 B虚拟机 的Hadoop家目录 新建.ssh</li>
<li>把 A虚拟机 的公钥 追加 .ssh/authorized_keys （不存在这个文件，会自动创建）</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@localhost ~]$ ls</span><br><span class="line">id_rsa.pub</span><br><span class="line">[hadoop@localhost ~]$ mkdir .ssh</span><br><span class="line">[hadoop@localhost ~]$ cat id_rsa.pub &gt;&gt; .ssh/authorized_keys</span><br></pre></td></tr></table></figure>
<p>这个时候切换到 A虚拟机 SSH登录B虚拟机</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@localhost .ssh]$ ssh 192.168.108.140</span><br><span class="line">hadoop@192.168.108.140<span class="string">'s password:</span></span><br></pre></td></tr></table></figure>
<p>发现还是需要密码，原因就是需要修改 虚拟机B 的权限<br>7. 修改 虚拟机B authorized_keys 的权限为644</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@localhost ~]$ <span class="built_in">cd</span> .ssh/</span><br><span class="line">[hadoop@localhost .ssh]$ ll</span><br><span class="line">总用量 4</span><br><span class="line">-rw-rw-r--. 1 hadoop hadoop 410 2月  25 08:42 authorized_keys</span><br><span class="line">[hadoop@localhost .ssh]$ chmod 644 authorized_keys </span><br><span class="line">[hadoop@localhost .ssh]$ </span><br><span class="line">[hadoop@localhost .ssh]$ ll -al</span><br><span class="line">总用量 4</span><br><span class="line">drwxrwxr-x. 2 hadoop hadoop  29 2月  25 08:42 .</span><br><span class="line">drwx------. 3 hadoop hadoop 113 2月  25 08:42 ..</span><br><span class="line">-rw-r--r--. 1 hadoop hadoop 410 2月  25 08:42 authorized_keys</span><br></pre></td></tr></table></figure>
<p>切换回 虚拟机A 使用SSH登录 B虚拟机 发现还是需要输入密码，因为 .ssh 权限也需要更改<br>8. 修改 虚拟机B .ssh 的权限为700</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@localhost ~]$ chmod 700 .ssh/</span><br><span class="line">[hadoop@localhost ~]$ </span><br><span class="line">[hadoop@localhost ~]$ ll -al</span><br><span class="line">总用量 20</span><br><span class="line">drwx------. 3 hadoop hadoop  113 2月  25 08:42 .</span><br><span class="line">drwxr-xr-x. 3 root   root     20 2月  25 00:12 ..</span><br><span class="line">drwx------. 2 hadoop hadoop   29 2月  25 08:42 .ssh</span><br></pre></td></tr></table></figure>

<p>切换回 虚拟机A 使用SSH登录 B虚拟机，成功</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@localhost .ssh]$ ssh 192.168.108.140</span><br><span class="line">hadoop@192.168.108.140<span class="string">'s password: </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[hadoop@localhost .ssh]$ ssh 192.168.108.140</span></span><br><span class="line"><span class="string">Last login: Tue Feb 25 08:30:57 2020 from 192.168.108.1</span></span><br><span class="line"><span class="string">[hadoop@localhost ~]$ exit</span></span><br><span class="line"><span class="string">登出</span></span><br><span class="line"><span class="string">Connection to 192.168.108.140 closed.</span></span><br></pre></td></tr></table></figure>

<p>权限为什么要这么配</p>
<blockquote>
<p>因为sshd为了安全，对属主的目录和文件权限有所要求。如果权限不对，则ssh的免密码登陆不生效。<br>用户目录权限为 755 或者 700，就是不能是77x、777，需要保障other用户不能有w权限<br>.ssh目录权限一般为755或者700。<br>rsa_id.pub 及authorized_keys权限一般为644<br>rsa_id权限必须为600<br>–<a href="https://blog.csdn.net/levy_cui/article/details/59524158" target="_blank" rel="noopener">ssh目录权限说明</a></p>
</blockquote>
<p>因为一般情况 用户目录,rsa_id.pub,rsa_id 都符合权限要求，所以只要更改 .ssh 和authorized_keys即可</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>想免密登录谁，就把公钥给谁</li>
<li>一般情况下，修改 authorized_keys 为 644，.ssh 为 700即可</li>
<li>可以通过配置单机回环来验证SSH免密码登录是否成功<br>A 需要免密登录 B<br>可以先在B上生成公私钥，最佳生成的公钥到 authorized_keys ，配置权限<br>ssh localhost （自己登自己）不需要输入密码说明配置成功，记得通过 exit 退出当前的远程<br>然后就可以通过把 A 的公钥加入到 authorized_keys 中，使得 A 可以免密登录 B</li>
</ol>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://blog.csdn.net/levy_cui/article/details/59524158" target="_blank" rel="noopener">ssh目录权限说明</a><br><a href="https://blog.51cto.com/merrycheng/1340280" target="_blank" rel="noopener">ssh密钥文件的权限</a><br><a href="https://www.cnblogs.com/diffx/p/9553587.html" target="_blank" rel="noopener">图解SSH原理</a></p>
</section>
    

    <footer id="post-meta" class="clearfix">
        <a href="/about/">
        <img class="avatar" src="/images/avatar.jpg">
        <div>
            <span class="dark">Aaron Lin</span>
            <span></span>
        </div>
        </a>
        <section id="sharing">
            <a title="Share to Twitter" class="twitter" href="https://twitter.com/intent/tweet?text=https://aaronlinv.github.io/2020/02/25/linux-ssh/ - Linux-SSH @" target="_blank" rel="noopener"><span class="icon-twitter">tweet</span></a>
            <a title="Share to Facebook" class="facebook" href="#" onclick="
                window.open(
                  'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
                  'facebook-share-dialog',
                  'width=626,height=436');
                return false;"><span class="icon-facebook-sign">Share</span>
            </a>
        </section>
    </footer>


  <section id="comment">
    <button class="btn" id="loadcmts" onclick="cmts.load();">加载评论</button>
    <div id="gitment"></div>
    <script src='/js/gitment.browser.js'></script>
    <link rel="stylesheet" href=''>
    <script>
      var cmts={
        load:function cmts(){
          var gitment = new Gitment({
          
            id: "Linux-SSH",
          
            owner: "",
            repo: "",
            oauth: {
              client_id: "",
              client_secret: "",
            },
          })
          gitment.render('gitment');
          var loadcmt = document.getElementById("loadcmts");
          var imyourfather = loadcmt.parentNode;
          imyourfather.removeChild(loadcmts)
        }
      }
    </script>
  </section>


	<footer id="footer">
    <div id="social">
        <p class="small">©
            Aaron Lin | Powered by Hexo &
                <a href="https://github.com/F0r3at/Lights" target="_blank" rel="noopener"> Lights</a>
        </p>
    </div>
</footer>
</section>

	<script src="//cdnjs.loli.net/ajax/libs/instantclick/3.0.1/instantclick.min.js" data-no-instant></script>
	<script data-no-instant>
		
		InstantClick.init('mousedown');
	</script>



