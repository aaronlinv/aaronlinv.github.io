<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>使用 Postman 的 Environments 和 Tests 简化在不同环境中的切换步骤 | Aaron Lin</title>
<meta name=keywords content><meta name=description content='调试 API 的时候，我们需要经常需要在本地、开发、生产来回切换，还需要面临 Token 失效等的问题，让人头大，看到一些教程有介绍用 Postman 来简化流程，但是实践起来还是遇到一些问题，所以就有了这篇细致地介绍使用 Postman 的 Environments 和 Tests 来简化在不同环境中切换的步骤，无感知地调试 API 的博客
手动更新 Token

在 Environments 面板中 new 一个新的 Environment (环境)，用于存储当前环境的：Token、地址、用户名、密码，需要先填上地址、用户名、密码的 CURRENT VALUE



在 Collections 中添加一个新的 Collection（集合），名字为 Demo，点击右键选择 Add Request 添加一个获取 Token 的 Request。注意右上角的 Environment 需要选择刚才定义的，这样才可以通过 {{}} 获取到 Environment 中变量的值。这里的 base URL、账号、密码都可以根据实际请求的情况进行设置



编写这个 Request 的 Test（Test会在请求执行后自动运行），编写 Test 目的是为了在请求后自动更新当前 Environment 的 Token，写完就点击 Send 发送请求。点击右上角的眼睛，可以快速查看当前 Environment 变量


// 判断相应的状态码是否为 200
pm.test("Status code is 200", function () {
    console.log((pm.response))
    pm.response.to.have.status(200);
});

// 更新当前 Environment 的 Token
console.log(pm.response.json())
var token = pm.response.json().token
pm.environment.set("token", token);
使用 Request


调用获取 Token 的 Request，更新全局 Token'><meta name=author content><link rel=canonical href=https://aaronlinv.github.io/posts/%E4%BD%BF%E7%94%A8-postman-%E7%9A%84-environments-%E5%92%8C-tests-%E7%AE%80%E5%8C%96%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E5%88%87%E6%8D%A2%E6%AD%A5%E9%AA%A4/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=https://aaronlinv.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://aaronlinv.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://aaronlinv.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://aaronlinv.github.io/apple-touch-icon.png><link rel=mask-icon href=https://aaronlinv.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://aaronlinv.github.io/posts/%E4%BD%BF%E7%94%A8-postman-%E7%9A%84-environments-%E5%92%8C-tests-%E7%AE%80%E5%8C%96%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E5%88%87%E6%8D%A2%E6%AD%A5%E9%AA%A4/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://aaronlinv.github.io/posts/%E4%BD%BF%E7%94%A8-postman-%E7%9A%84-environments-%E5%92%8C-tests-%E7%AE%80%E5%8C%96%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E5%88%87%E6%8D%A2%E6%AD%A5%E9%AA%A4/"><meta property="og:site_name" content="Aaron Lin"><meta property="og:title" content="使用 Postman 的 Environments 和 Tests 简化在不同环境中的切换步骤"><meta property="og:description" content='调试 API 的时候，我们需要经常需要在本地、开发、生产来回切换，还需要面临 Token 失效等的问题，让人头大，看到一些教程有介绍用 Postman 来简化流程，但是实践起来还是遇到一些问题，所以就有了这篇细致地介绍使用 Postman 的 Environments 和 Tests 来简化在不同环境中切换的步骤，无感知地调试 API 的博客
手动更新 Token 在 Environments 面板中 new 一个新的 Environment (环境)，用于存储当前环境的：Token、地址、用户名、密码，需要先填上地址、用户名、密码的 CURRENT VALUE 在 Collections 中添加一个新的 Collection（集合），名字为 Demo，点击右键选择 Add Request 添加一个获取 Token 的 Request。注意右上角的 Environment 需要选择刚才定义的，这样才可以通过 {{}} 获取到 Environment 中变量的值。这里的 base URL、账号、密码都可以根据实际请求的情况进行设置 编写这个 Request 的 Test（Test会在请求执行后自动运行），编写 Test 目的是为了在请求后自动更新当前 Environment 的 Token，写完就点击 Send 发送请求。点击右上角的眼睛，可以快速查看当前 Environment 变量 // 判断相应的状态码是否为 200 pm.test("Status code is 200", function () { console.log((pm.response)) pm.response.to.have.status(200); }); // 更新当前 Environment 的 Token console.log(pm.response.json()) var token = pm.response.json().token pm.environment.set("token", token); 使用 Request 调用获取 Token 的 Request，更新全局 Token'><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-04T08:53:33+08:00"><meta property="article:modified_time" content="2022-03-04T08:53:33+08:00"><meta property="og:image" content="https://aaronlinv.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://aaronlinv.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="使用 Postman 的 Environments 和 Tests 简化在不同环境中的切换步骤"><meta name=twitter:description content='调试 API 的时候，我们需要经常需要在本地、开发、生产来回切换，还需要面临 Token 失效等的问题，让人头大，看到一些教程有介绍用 Postman 来简化流程，但是实践起来还是遇到一些问题，所以就有了这篇细致地介绍使用 Postman 的 Environments 和 Tests 来简化在不同环境中切换的步骤，无感知地调试 API 的博客
手动更新 Token

在 Environments 面板中 new 一个新的 Environment (环境)，用于存储当前环境的：Token、地址、用户名、密码，需要先填上地址、用户名、密码的 CURRENT VALUE



在 Collections 中添加一个新的 Collection（集合），名字为 Demo，点击右键选择 Add Request 添加一个获取 Token 的 Request。注意右上角的 Environment 需要选择刚才定义的，这样才可以通过 {{}} 获取到 Environment 中变量的值。这里的 base URL、账号、密码都可以根据实际请求的情况进行设置



编写这个 Request 的 Test（Test会在请求执行后自动运行），编写 Test 目的是为了在请求后自动更新当前 Environment 的 Token，写完就点击 Send 发送请求。点击右上角的眼睛，可以快速查看当前 Environment 变量


// 判断相应的状态码是否为 200
pm.test("Status code is 200", function () {
    console.log((pm.response))
    pm.response.to.have.status(200);
});

// 更新当前 Environment 的 Token
console.log(pm.response.json())
var token = pm.response.json().token
pm.environment.set("token", token);
使用 Request


调用获取 Token 的 Request，更新全局 Token'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://aaronlinv.github.io/posts/"},{"@type":"ListItem","position":2,"name":"使用 Postman 的 Environments 和 Tests 简化在不同环境中的切换步骤","item":"https://aaronlinv.github.io/posts/%E4%BD%BF%E7%94%A8-postman-%E7%9A%84-environments-%E5%92%8C-tests-%E7%AE%80%E5%8C%96%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E5%88%87%E6%8D%A2%E6%AD%A5%E9%AA%A4/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"使用 Postman 的 Environments 和 Tests 简化在不同环境中的切换步骤","name":"使用 Postman 的 Environments 和 Tests 简化在不同环境中的切换步骤","description":"调试 API 的时候，我们需要经常需要在本地、开发、生产来回切换，还需要面临 Token 失效等的问题，让人头大，看到一些教程有介绍用 Postman 来简化流程，但是实践起来还是遇到一些问题，所以就有了这篇细致地介绍使用 Postman 的 Environments 和 Tests 来简化在不同环境中切换的步骤，无感知地调试 API 的博客\n手动更新 Token 在 Environments 面板中 new 一个新的 Environment (环境)，用于存储当前环境的：Token、地址、用户名、密码，需要先填上地址、用户名、密码的 CURRENT VALUE 在 Collections 中添加一个新的 Collection（集合），名字为 Demo，点击右键选择 Add Request 添加一个获取 Token 的 Request。注意右上角的 Environment 需要选择刚才定义的，这样才可以通过 {{}} 获取到 Environment 中变量的值。这里的 base URL、账号、密码都可以根据实际请求的情况进行设置 编写这个 Request 的 Test（Test会在请求执行后自动运行），编写 Test 目的是为了在请求后自动更新当前 Environment 的 Token，写完就点击 Send 发送请求。点击右上角的眼睛，可以快速查看当前 Environment 变量 // 判断相应的状态码是否为 200 pm.test(\u0026#34;Status code is 200\u0026#34;, function () { console.log((pm.response)) pm.response.to.have.status(200); }); // 更新当前 Environment 的 Token console.log(pm.response.json()) var token = pm.response.json().token pm.environment.set(\u0026#34;token\u0026#34;, token); 使用 Request 调用获取 Token 的 Request，更新全局 Token\n","keywords":[],"articleBody":"调试 API 的时候，我们需要经常需要在本地、开发、生产来回切换，还需要面临 Token 失效等的问题，让人头大，看到一些教程有介绍用 Postman 来简化流程，但是实践起来还是遇到一些问题，所以就有了这篇细致地介绍使用 Postman 的 Environments 和 Tests 来简化在不同环境中切换的步骤，无感知地调试 API 的博客\n手动更新 Token 在 Environments 面板中 new 一个新的 Environment (环境)，用于存储当前环境的：Token、地址、用户名、密码，需要先填上地址、用户名、密码的 CURRENT VALUE 在 Collections 中添加一个新的 Collection（集合），名字为 Demo，点击右键选择 Add Request 添加一个获取 Token 的 Request。注意右上角的 Environment 需要选择刚才定义的，这样才可以通过 {{}} 获取到 Environment 中变量的值。这里的 base URL、账号、密码都可以根据实际请求的情况进行设置 编写这个 Request 的 Test（Test会在请求执行后自动运行），编写 Test 目的是为了在请求后自动更新当前 Environment 的 Token，写完就点击 Send 发送请求。点击右上角的眼睛，可以快速查看当前 Environment 变量 // 判断相应的状态码是否为 200 pm.test(\"Status code is 200\", function () { console.log((pm.response)) pm.response.to.have.status(200); }); // 更新当前 Environment 的 Token console.log(pm.response.json()) var token = pm.response.json().token pm.environment.set(\"token\", token); 使用 Request 调用获取 Token 的 Request，更新全局 Token\n选择 Collection，然后选择 Edit\n给整个 Collection 都设置上统一的 Authorization，Type 设置为 Bearer Token，Token 值则设置为 {{token}}，就是上面设置进 Environment 的变量 新建一个 Request，Authorization 选择 Inherit auth from parent (继承父级的 auth)，这样就可以避免手动填写 Token 了 之后再使用就可以直接点击 Duplicate，复制一个新的 Request 来使用 自动更新 Token 在切换 Environment 或者 Token 失效的时候，我们都要手动调用获取 Token 的 Request，还是比较麻烦，我们可以进一步自动化，给整个 Collection 都设置上统一的 Test，Collection 的任一 Request 的响应体的状态码为 401 (Unauthorized)，就重新去获取并更新 Token\n选择 Collection，然后选择 Edit，编辑 Tests // 定义发送登录请求的方法 function sendLoginRequest() { // 定义请求体 var data = { \"password\": pm.environment.get(\"password\"), \"telephone\": pm.environment.get(\"username\") } console.log(data) // 构造一个 POST 请求 var baseUrl = pm.environment.get(\"base_url\") const loginRequest = { url: baseUrl + '/admin_access_tokens', method: 'POST', header: 'Content-Type:application/json', body: { mode: 'raw', raw: JSON.stringify(data) } }; // 发送请求 pm.sendRequest(loginRequest, function (err, res) { if (err) { console.log(\"err：\" + err); } else { const jsonData = res.json(); // 自动更新 Collection 的 Token console.log(\"获取到的 token：\" + jsonData.token) var token = jsonData.token pm.environment.set(\"token\", token); console.log(\"更新全局变量 token 成功\") } }); } if (pm.response.code === 401) { // 如果当前返回的状态码是 401，就更新 token sendLoginRequest() } 这样一来，如果 Token 错误，它会自动重新获取并更新 Token，只需要再点一次 Send 就可以正常请求了 原理就是这个样子，如果想在不同环境中自由切换，只需要定义多个 Environment 即可，使用时只需要在右上角就可以轻松切换。如果想每次请求都直接去获取新 Token 也可以用 Pre-request Script；登录是带验证码的也可以参考：关于若依需要验证码，PostMan是如何登陆流程，总而言之，用上了这个 Tips 之后幸福感 up up up\n参考资料 Learning Center - Postman Postman 使用小技巧/指南 postman 一个也许可以节省你大量时间的小技巧 Postman设置全局变量token，自动更新token，统一设置headers(Authorization) Postman在pre-request Script中执行登录获取token\n推荐阅读： 开源≠免费 常见开源协议介绍 简单的 Shell 脚本入门教程 Docker 实践及命令梳理\n","wordCount":"277","inLanguage":"en","image":"https://aaronlinv.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2022-03-04T08:53:33+08:00","dateModified":"2022-03-04T08:53:33+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://aaronlinv.github.io/posts/%E4%BD%BF%E7%94%A8-postman-%E7%9A%84-environments-%E5%92%8C-tests-%E7%AE%80%E5%8C%96%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E5%88%87%E6%8D%A2%E6%AD%A5%E9%AA%A4/"},"publisher":{"@type":"Organization","name":"Aaron Lin","logo":{"@type":"ImageObject","url":"https://aaronlinv.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://aaronlinv.github.io/ accesskey=h title="Aaron's Blog (Alt + H)">Aaron's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://aaronlinv.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://aaronlinv.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://aaronlinv.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://aaronlinv.github.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">使用 Postman 的 Environments 和 Tests 简化在不同环境中的切换步骤</h1><div class=post-meta><span title='2022-03-04 08:53:33 +0800 +0800'>March 4, 2022</span></div></header><div class=post-content><p>调试 API 的时候，我们需要经常需要在本地、开发、生产来回切换，还需要面临 Token 失效等的问题，让人头大，看到一些教程有介绍用 Postman 来简化流程，但是实践起来还是遇到一些问题，所以就有了这篇细致地介绍使用 Postman 的 <code>Environments</code> 和 <code>Tests</code> 来简化在不同环境中切换的步骤，无感知地调试 API 的博客</p><h1 id=手动更新-token>手动更新 Token<a hidden class=anchor aria-hidden=true href=#手动更新-token>#</a></h1><ol><li>在 <code>Environments</code> 面板中 <code>new</code> 一个新的 <code>Environment</code> (环境)，用于存储当前环境的：Token、地址、用户名、密码，需要先填上地址、用户名、密码的 <code>CURRENT VALUE</code></li></ol><p><img loading=lazy src=../%E4%BD%BF%E7%94%A8Postman%E7%9A%84Environments%E5%92%8CTests%E7%AE%80%E5%8C%96%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E5%88%87%E6%8D%A2%E6%AD%A5%E9%AA%A4/1929786-20220303220102144-1179572122.png></p><ol start=2><li>在 <code>Collections</code> 中添加一个新的 <code>Collection</code>（集合），名字为 Demo，点击右键选择 <code>Add Request</code> 添加一个获取 Token 的 Request。注意右上角的 Environment 需要选择刚才定义的，这样才可以通过 <code>{{}}</code> 获取到 Environment 中变量的值。这里的 base URL、账号、密码都可以根据实际请求的情况进行设置</li></ol><p><img loading=lazy src=../%E4%BD%BF%E7%94%A8Postman%E7%9A%84Environments%E5%92%8CTests%E7%AE%80%E5%8C%96%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E5%88%87%E6%8D%A2%E6%AD%A5%E9%AA%A4/1929786-20220303220109252-1239737981.png></p><ol start=3><li>编写这个 <code>Request</code> 的 <code>Test</code>（Test会在请求执行后自动运行），编写 <code>Test</code> 目的是为了在请求后自动更新当前 Environment 的 Token，写完就点击 <code>Send</code> 发送请求。点击右上角的眼睛，可以快速查看当前 Environment 变量</li></ol><p><img loading=lazy src=../%E4%BD%BF%E7%94%A8Postman%E7%9A%84Environments%E5%92%8CTests%E7%AE%80%E5%8C%96%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E5%88%87%E6%8D%A2%E6%AD%A5%E9%AA%A4/1929786-20220303220124010-2012060462.png></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// 判断相应的状态码是否为 200
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>pm</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=s2>&#34;Status code is 200&#34;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>((</span><span class=nx>pm</span><span class=p>.</span><span class=nx>response</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=nx>pm</span><span class=p>.</span><span class=nx>response</span><span class=p>.</span><span class=nx>to</span><span class=p>.</span><span class=nx>have</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>200</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 更新当前 Environment 的 Token
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>pm</span><span class=p>.</span><span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>token</span> <span class=o>=</span> <span class=nx>pm</span><span class=p>.</span><span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>().</span><span class=nx>token</span>
</span></span><span class=line><span class=cl><span class=nx>pm</span><span class=p>.</span><span class=nx>environment</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;token&#34;</span><span class=p>,</span> <span class=nx>token</span><span class=p>);</span>
</span></span></code></pre></div><h1 id=使用-request>使用 Request<a hidden class=anchor aria-hidden=true href=#使用-request>#</a></h1><ol><li><p>调用获取 Token 的 <code>Request</code>，更新全局 Token</p></li><li><p>选择 <code>Collection</code>，然后选择 <code>Edit</code></p></li></ol><p><img loading=lazy src=../%E4%BD%BF%E7%94%A8Postman%E7%9A%84Environments%E5%92%8CTests%E7%AE%80%E5%8C%96%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E5%88%87%E6%8D%A2%E6%AD%A5%E9%AA%A4/1929786-20220303220130741-83553475.png></p><ol start=3><li>给整个 <code>Collection</code> 都设置上统一的 <code>Authorization</code>，Type 设置为 <code>Bearer Token</code>，Token 值则设置为 <code>{{token}}</code>，就是上面设置进 <code>Environment</code> 的变量</li></ol><p><img loading=lazy src=../%E4%BD%BF%E7%94%A8Postman%E7%9A%84Environments%E5%92%8CTests%E7%AE%80%E5%8C%96%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E5%88%87%E6%8D%A2%E6%AD%A5%E9%AA%A4/1929786-20220303220136799-729019785.png></p><ol start=4><li>新建一个 <code>Request</code>，<code>Authorization</code> 选择 <code>Inherit auth from parent</code> (继承父级的 auth)，这样就可以避免手动填写 Token 了</li></ol><p><img loading=lazy src=../%E4%BD%BF%E7%94%A8Postman%E7%9A%84Environments%E5%92%8CTests%E7%AE%80%E5%8C%96%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E5%88%87%E6%8D%A2%E6%AD%A5%E9%AA%A4/1929786-20220303220142521-507740706.png></p><ol start=5><li>之后再使用就可以直接点击 <code>Duplicate</code>，复制一个新的 <code>Request</code> 来使用</li></ol><p><img loading=lazy src=../%E4%BD%BF%E7%94%A8Postman%E7%9A%84Environments%E5%92%8CTests%E7%AE%80%E5%8C%96%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E5%88%87%E6%8D%A2%E6%AD%A5%E9%AA%A4/1929786-20220303220147814-1784072148.png></p><h1 id=自动更新-token>自动更新 Token<a hidden class=anchor aria-hidden=true href=#自动更新-token>#</a></h1><p>在切换 <code>Environment</code> 或者 Token 失效的时候，我们都要手动调用获取 Token 的 <code>Request</code>，还是比较麻烦，我们可以进一步自动化，给整个 <code>Collection</code> 都设置上统一的 <code>Test</code>，<code>Collection</code> 的任一 <code>Request</code> 的响应体的状态码为 401 (Unauthorized)，就重新去获取并更新 Token</p><ol><li>选择 <code>Collection</code>，然后选择 <code>Edit</code>，编辑 <code>Tests</code></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// 定义发送登录请求的方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>sendLoginRequest</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 定义请求体
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;password&#34;</span><span class=o>:</span> <span class=nx>pm</span><span class=p>.</span><span class=nx>environment</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;password&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;telephone&#34;</span><span class=o>:</span> <span class=nx>pm</span><span class=p>.</span><span class=nx>environment</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;username&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 构造一个 POST 请求
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>baseUrl</span> <span class=o>=</span> <span class=nx>pm</span><span class=p>.</span><span class=nx>environment</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;base_url&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>loginRequest</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>url</span><span class=o>:</span> <span class=nx>baseUrl</span> <span class=o>+</span> <span class=s1>&#39;/admin_access_tokens&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>method</span><span class=o>:</span> <span class=s1>&#39;POST&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>header</span><span class=o>:</span> <span class=s1>&#39;Content-Type:application/json&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>body</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>mode</span><span class=o>:</span> <span class=s1>&#39;raw&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>raw</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 发送请求
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>pm</span><span class=p>.</span><span class=nx>sendRequest</span><span class=p>(</span><span class=nx>loginRequest</span><span class=p>,</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;err：&#34;</span> <span class=o>+</span> <span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>jsonData</span> <span class=o>=</span> <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 自动更新 Collection 的 Token
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;获取到的 token：&#34;</span> <span class=o>+</span> <span class=nx>jsonData</span><span class=p>.</span><span class=nx>token</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=kd>var</span> <span class=nx>token</span> <span class=o>=</span> <span class=nx>jsonData</span><span class=p>.</span><span class=nx>token</span>
</span></span><span class=line><span class=cl>            <span class=nx>pm</span><span class=p>.</span><span class=nx>environment</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;token&#34;</span><span class=p>,</span> <span class=nx>token</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;更新全局变量 token 成功&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>pm</span><span class=p>.</span><span class=nx>response</span><span class=p>.</span><span class=nx>code</span> <span class=o>===</span> <span class=mi>401</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 如果当前返回的状态码是 401，就更新 token
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>sendLoginRequest</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><img loading=lazy src=../%E4%BD%BF%E7%94%A8Postman%E7%9A%84Environments%E5%92%8CTests%E7%AE%80%E5%8C%96%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E5%88%87%E6%8D%A2%E6%AD%A5%E9%AA%A4/1929786-20220303220155122-1950292517.png></p><ol start=2><li>这样一来，如果 Token 错误，它会自动重新获取并更新 Token，只需要再点一次 <code>Send</code> 就可以正常请求了</li></ol><p>原理就是这个样子，如果想在不同环境中自由切换，只需要定义多个 <code>Environment</code> 即可，使用时只需要在右上角就可以轻松切换。如果想每次请求都直接去获取新 Token 也可以用 <code>Pre-request Script</code>；登录是带验证码的也可以参考：<a href=http://www.jianboge.com/d73200>关于若依需要验证码，PostMan是如何登陆流程</a>，总而言之，用上了这个 Tips 之后幸福感 up up up</p><h1 id=参考资料>参考资料<a hidden class=anchor aria-hidden=true href=#参考资料>#</a></h1><p><a href=https://learning.postman.com/docs/getting-started/introduction/>Learning Center - Postman</a>
<a href=https://segmentfault.com/a/1190000039825314>Postman 使用小技巧/指南</a>
<a href=https://learnku.com/articles/33410>postman 一个也许可以节省你大量时间的小技巧</a>
<a href=https://blog.csdn.net/weixin_42771651/article/details/116533921>Postman设置全局变量token，自动更新token，统一设置headers(Authorization)</a>
<a href=https://blog.csdn.net/wqchibingshaonian/article/details/109221060>Postman在pre-request Script中执行登录获取token</a></p><hr><p>推荐阅读：
<a href=https://www.cnblogs.com/aaronlinv/p/15708052.html>开源≠免费 常见开源协议介绍</a>
<a href=https://www.cnblogs.com/aaronlinv/p/15764053.html>简单的 Shell 脚本入门教程</a>
<a href=https://www.cnblogs.com/aaronlinv/p/15130730.html>Docker 实践及命令梳理</a></p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://aaronlinv.github.io/posts/%E5%AE%89%E5%8D%93%E5%AF%BC%E8%88%AA%E6%8A%BD%E5%B1%89-navigation-drawer-%E5%AE%9E%E7%8E%B0%E6%B2%89%E6%B5%B8%E9%80%9A%E7%9F%A5%E6%A0%8F/><span class=title>« Prev</span><br><span>安卓导航抽屉 Navigation Drawer 实现沉浸通知栏</span>
</a><a class=next href=https://aaronlinv.github.io/posts/%E6%88%91%E7%9A%84%E4%BA%8C%E6%9C%AC%E5%AD%A6%E7%94%9F-%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/><span class=title>Next »</span><br><span>我的二本学生 阅读笔记</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://aaronlinv.github.io/>Aaron Lin</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>