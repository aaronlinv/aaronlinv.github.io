<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Docker Compose 实践及梳理 | Aaron Lin</title>
<meta name=keywords content><meta name=description content='上一节：IDEA 配合 Dockerfile 部署 SpringBoot 工程

Docker Compose 可以实现 Docker 容器集群的编排，可以通过 docker-compose.yml 文件，定义我们的服务及其需要的依赖，轻松地运行在测试、生产等环境
文档
Product manuals
Compose file version 3 reference
Docker 从入门到实践 【中文】
安装 Compose
Compose 依赖 Docker Engine，所有要保证环境安装了 Docker，可参考官方教程，主要分为两步：
# 1. 下载 Compose 只执行文件到 usr/local/bin/ 目录
# 下载失败可以参考下一小结提供地址安装
sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

# 2. 对 Compose 可执行文件添加运行权限
sudo chmod +x /usr/local/bin/docker-compose

# 输入下面命令查看帮助，测试安装是否成功
docker-compose -h
Compose 开源在 Docker 官方的 GitHub 仓库：docker/compose，所有的 Compose 都会发布在仓库的 Releases 里，步骤1就是使用 curl 命令从 Releases 里下载可执行文件，uname -s和uname -m 可以读取系统的内核名称和硬件架构，用来匹配需要的 Compose 版本， curl 的 -L 参数会让 HTTP 请求跟随重定向（默认不跟随），-o (小写o) 会将服务器响应保存成文件，直接下载到：usr/local/bin/ 下，文件名为：docker-compose，因为这个路径已经在环境变量中了，所以完成步骤2，添加可执行权限后，就可以在任意位置使用了'><meta name=author content><link rel=canonical href=https://aaronlinv.github.io/posts/docker-compose-%E5%AE%9E%E8%B7%B5%E5%8F%8A%E6%A2%B3%E7%90%86/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=https://aaronlinv.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://aaronlinv.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://aaronlinv.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://aaronlinv.github.io/apple-touch-icon.png><link rel=mask-icon href=https://aaronlinv.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://aaronlinv.github.io/posts/docker-compose-%E5%AE%9E%E8%B7%B5%E5%8F%8A%E6%A2%B3%E7%90%86/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://aaronlinv.github.io/posts/docker-compose-%E5%AE%9E%E8%B7%B5%E5%8F%8A%E6%A2%B3%E7%90%86/"><meta property="og:site_name" content="Aaron Lin"><meta property="og:title" content="Docker Compose 实践及梳理"><meta property="og:description" content='上一节：IDEA 配合 Dockerfile 部署 SpringBoot 工程
Docker Compose 可以实现 Docker 容器集群的编排，可以通过 docker-compose.yml 文件，定义我们的服务及其需要的依赖，轻松地运行在测试、生产等环境
文档 Product manuals
Compose file version 3 reference
Docker 从入门到实践 【中文】
安装 Compose Compose 依赖 Docker Engine，所有要保证环境安装了 Docker，可参考官方教程，主要分为两步：
# 1. 下载 Compose 只执行文件到 usr/local/bin/ 目录 # 下载失败可以参考下一小结提供地址安装 sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose # 2. 对 Compose 可执行文件添加运行权限 sudo chmod +x /usr/local/bin/docker-compose # 输入下面命令查看帮助，测试安装是否成功 docker-compose -h Compose 开源在 Docker 官方的 GitHub 仓库：docker/compose，所有的 Compose 都会发布在仓库的 Releases 里，步骤1就是使用 curl 命令从 Releases 里下载可执行文件，uname -s和uname -m 可以读取系统的内核名称和硬件架构，用来匹配需要的 Compose 版本， curl 的 -L 参数会让 HTTP 请求跟随重定向（默认不跟随），-o (小写o) 会将服务器响应保存成文件，直接下载到：usr/local/bin/ 下，文件名为：docker-compose，因为这个路径已经在环境变量中了，所以完成步骤2，添加可执行权限后，就可以在任意位置使用了'><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-09-15T09:01:33+08:00"><meta property="article:modified_time" content="2021-09-15T09:01:33+08:00"><meta property="og:image" content="https://aaronlinv.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://aaronlinv.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Docker Compose 实践及梳理"><meta name=twitter:description content='上一节：IDEA 配合 Dockerfile 部署 SpringBoot 工程

Docker Compose 可以实现 Docker 容器集群的编排，可以通过 docker-compose.yml 文件，定义我们的服务及其需要的依赖，轻松地运行在测试、生产等环境
文档
Product manuals
Compose file version 3 reference
Docker 从入门到实践 【中文】
安装 Compose
Compose 依赖 Docker Engine，所有要保证环境安装了 Docker，可参考官方教程，主要分为两步：
# 1. 下载 Compose 只执行文件到 usr/local/bin/ 目录
# 下载失败可以参考下一小结提供地址安装
sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

# 2. 对 Compose 可执行文件添加运行权限
sudo chmod +x /usr/local/bin/docker-compose

# 输入下面命令查看帮助，测试安装是否成功
docker-compose -h
Compose 开源在 Docker 官方的 GitHub 仓库：docker/compose，所有的 Compose 都会发布在仓库的 Releases 里，步骤1就是使用 curl 命令从 Releases 里下载可执行文件，uname -s和uname -m 可以读取系统的内核名称和硬件架构，用来匹配需要的 Compose 版本， curl 的 -L 参数会让 HTTP 请求跟随重定向（默认不跟随），-o (小写o) 会将服务器响应保存成文件，直接下载到：usr/local/bin/ 下，文件名为：docker-compose，因为这个路径已经在环境变量中了，所以完成步骤2，添加可执行权限后，就可以在任意位置使用了'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://aaronlinv.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Docker Compose 实践及梳理","item":"https://aaronlinv.github.io/posts/docker-compose-%E5%AE%9E%E8%B7%B5%E5%8F%8A%E6%A2%B3%E7%90%86/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Docker Compose 实践及梳理","name":"Docker Compose 实践及梳理","description":"上一节：IDEA 配合 Dockerfile 部署 SpringBoot 工程\nDocker Compose 可以实现 Docker 容器集群的编排，可以通过 docker-compose.yml 文件，定义我们的服务及其需要的依赖，轻松地运行在测试、生产等环境\n文档 Product manuals\nCompose file version 3 reference\nDocker 从入门到实践 【中文】\n安装 Compose Compose 依赖 Docker Engine，所有要保证环境安装了 Docker，可参考官方教程，主要分为两步：\n# 1. 下载 Compose 只执行文件到 usr/local/bin/ 目录 # 下载失败可以参考下一小结提供地址安装 sudo curl -L \u0026#34;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)\u0026#34; -o /usr/local/bin/docker-compose # 2. 对 Compose 可执行文件添加运行权限 sudo chmod +x /usr/local/bin/docker-compose # 输入下面命令查看帮助，测试安装是否成功 docker-compose -h Compose 开源在 Docker 官方的 GitHub 仓库：docker/compose，所有的 Compose 都会发布在仓库的 Releases 里，步骤1就是使用 curl 命令从 Releases 里下载可执行文件，uname -s和uname -m 可以读取系统的内核名称和硬件架构，用来匹配需要的 Compose 版本， curl 的 -L 参数会让 HTTP 请求跟随重定向（默认不跟随），-o (小写o) 会将服务器响应保存成文件，直接下载到：usr/local/bin/ 下，文件名为：docker-compose，因为这个路径已经在环境变量中了，所以完成步骤2，添加可执行权限后，就可以在任意位置使用了\n","keywords":[],"articleBody":"上一节：IDEA 配合 Dockerfile 部署 SpringBoot 工程\nDocker Compose 可以实现 Docker 容器集群的编排，可以通过 docker-compose.yml 文件，定义我们的服务及其需要的依赖，轻松地运行在测试、生产等环境\n文档 Product manuals\nCompose file version 3 reference\nDocker 从入门到实践 【中文】\n安装 Compose Compose 依赖 Docker Engine，所有要保证环境安装了 Docker，可参考官方教程，主要分为两步：\n# 1. 下载 Compose 只执行文件到 usr/local/bin/ 目录 # 下载失败可以参考下一小结提供地址安装 sudo curl -L \"https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose # 2. 对 Compose 可执行文件添加运行权限 sudo chmod +x /usr/local/bin/docker-compose # 输入下面命令查看帮助，测试安装是否成功 docker-compose -h Compose 开源在 Docker 官方的 GitHub 仓库：docker/compose，所有的 Compose 都会发布在仓库的 Releases 里，步骤1就是使用 curl 命令从 Releases 里下载可执行文件，uname -s和uname -m 可以读取系统的内核名称和硬件架构，用来匹配需要的 Compose 版本， curl 的 -L 参数会让 HTTP 请求跟随重定向（默认不跟随），-o (小写o) 会将服务器响应保存成文件，直接下载到：usr/local/bin/ 下，文件名为：docker-compose，因为这个路径已经在环境变量中了，所以完成步骤2，添加可执行权限后，就可以在任意位置使用了\n直接从 GitHub 下载比较慢可以通过以下地址下载：\n# https://vuepress.mirror.docker-practice.com/compose/install/ sudo curl -L https://download.fastgit.org/docker/compose/releases/download/1.27.4/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose sudo chmod +x /usr/local/bin/docker-compose 入门 Compose 的模版指令与 Docker 的 run 命令相关参数很相似，忘记了 docker 命令可以参考之前的一篇博客：Docker 实践及命令梳理\nCompose 中有两个重要的概念：\n服务 (service)：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例\n项目 (project)：由一组关联的应用容器组成的一个完整业务单元，在 docker-compose.yml 文件中定义\ndocker-compose.yml 格式如下，注意：YAML 文件必须要键值之间的 : 后面必须有一个空格，缩进表示层级，要注意缩进 有使用到的 volumes 和 networks 必须声明\n# 指定版本 version: \"3\" # 服务的集合 services: # 其中一个服务，服务名为：webapp webapp: # 指定该服务使用的镜像 image: examples/web # 端口映射 ports: - \"80:80\" # 数据卷 volumes: - \"/data\" 简单上手 在一个 Compose 中启动 Tomcat, MySQL, redis，创建 docker-compose.yml\nversion: \"3.0\" services: tomcat: container_name: mytomcat # --name image: tomcat:8.0-jre8 ports: - \"8080:8080\" volumes: - \"tomcatwebapps:/usr/local/tomcat/webapps\" networks: - some_network # tomcat 服务依赖于 mysql 和 redis depends_on: - mysql - redis mysql: container_name: mysql image: mysql:5.7.32 ports: - \"3306:3306\" volumes: - \"mysqldata:/var/lib/mysql\" - \"mysqlconf:/etc/mysql\" environment: - MYSQL_ROOT_PASSWORD=1234 networks: some_network: redis: container_name: redis image: redis:5.0.10 ports: - \"6379:6379\" volumes: - \"redisdata:/data\" command: \"redis-server --appendonly yes\" networks: some_network: # 使用到的 volumes 和 networks 必须声明 volumes: tomcatwebapps: mysqldata: mysqlconf: redisdata: networks: # 声明名称为 “some_network” 的网络 some_network: 在 docker-compose.yml 所在路径执行 docker-compose up 启动 Compose 项目，它会下载使用到的镜像并在前台运行打印日志，可以使用 Ctrl + C 终止\n如果需要后台运行执行 docker-compose up -d，这时候使用 docker ps 可以看到 Compose 已经根据 yaml 创建了相关的容器，使用 docker-compose down 停止 Compse 并移除自动创建的网桥\n使用 docker network ls 查看网络或者 docker volume ls 查看数据卷，Compose 定义的网络或数据卷名称格式为：docker-compose.yml所在文件夹的名称加上下划线再加上 yaml 中定义名称，如果在 “dockerfile” 文件夹下创建 yaml 文件并启动，那么网络名称为：dockerfile_some_network\ntomcat 服务使用了 depends_on，表示它依赖于 redis 和 mysql 服务，Compose 将优先启动它的依赖再启动它\n命令梳理 Docker Compose 的命令与 Dokcer 类似，可以使用 –help 参数，就可以查询到到对应命令的使用方法\ndocker-compose --help 默认启动的模版文件名为 docker-compose.yml，可以使用 -f 指定自定义的模版文件 可以通过 config 命令，检查模版文件语法是否正确\ndocker-compse 也包含很多子命令： 启动停止相关：up, down, restart, stop, pasue, unpause\n资源相关：ps, top, kill, run\n进入容器：exec\n查看日志：logs\n很多子命令都可以在后面跟上某个具体的 service 名称，定向地操作，下面不一一举例， 可以使用docker-compose help 再跟上子命令名称，查询其用法\n# 后台启动 yaml 定义的所有容器 docker-compose up -d # 仅启动 mysql 这个service，会启动其依赖的 service docker-compose up mysql 指定启动的server名称， # 停止容器并移除自动创建的网桥 docker-compose down # 重启所有 service 后面可以指定上某个具体的 service docker-compose restart # 暂停 和 恢复 docker-compose pause docker-compose unpause # 进入 redis 这个 service 使用 exit 退出 docker-compose exec redis bash # 列出当前 yaml 中定义的容器的信息 docker-compose ps # 删除当前 yaml 中定义的容器，需要先 stop，后面可以指定上某个具体的 service docker-compose rm # 查看各个 service 容器内运行的进程情况 docker-compose top # 查看日志默认查看 yaml 所有的，可以跟上具体 service # -f 可以保持跟踪，新的日志会马上显示在屏幕上 docker-compose logs 参考资料 curl 的用法指南 【编程不良人】Docker容器技术\u0026Docker-Compose实战\n上一节：IDEA 配合 Dockerfile 部署 SpringBoot 工程\n","wordCount":"424","inLanguage":"en","image":"https://aaronlinv.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2021-09-15T09:01:33+08:00","dateModified":"2021-09-15T09:01:33+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://aaronlinv.github.io/posts/docker-compose-%E5%AE%9E%E8%B7%B5%E5%8F%8A%E6%A2%B3%E7%90%86/"},"publisher":{"@type":"Organization","name":"Aaron Lin","logo":{"@type":"ImageObject","url":"https://aaronlinv.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://aaronlinv.github.io/ accesskey=h title="Aaron's Blog (Alt + H)">Aaron's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://aaronlinv.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://aaronlinv.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://aaronlinv.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://aaronlinv.github.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Docker Compose 实践及梳理</h1><div class=post-meta><span title='2021-09-15 09:01:33 +0800 +0800'>September 15, 2021</span></div></header><div class=post-content><p>上一节：<a href=https://www.cnblogs.com/aaronlinv/p/15228488.html>IDEA 配合 Dockerfile 部署 SpringBoot 工程</a></p><hr><p>Docker Compose 可以实现 Docker 容器集群的编排，可以通过 <code>docker-compose.yml</code> 文件，定义我们的服务及其需要的依赖，轻松地运行在测试、生产等环境</p><h2 id=文档>文档<a hidden class=anchor aria-hidden=true href=#文档>#</a></h2><p><a href=https://docs.docker.com/compose/>Product manuals</a></p><p><a href=https://docs.docker.com/compose/compose-file/compose-file-v3/>Compose file version 3 reference</a></p><p><a href=https://vuepress.mirror.docker-practice.com/compose/introduction/>Docker 从入门到实践 【中文】</a></p><h2 id=安装-compose>安装 Compose<a hidden class=anchor aria-hidden=true href=#安装-compose>#</a></h2><p>Compose 依赖 Docker Engine，所有要保证环境安装了 Docker，可参考<a href=https://docs.docker.com/compose/install/>官方教程</a>，主要分为两步：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 下载 Compose 只执行文件到 usr/local/bin/ 目录</span>
</span></span><span class=line><span class=cl><span class=c1># 下载失败可以参考下一小结提供地址安装</span>
</span></span><span class=line><span class=cl>sudo curl -L <span class=s2>&#34;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-</span><span class=k>$(</span>uname -s<span class=k>)</span><span class=s2>-</span><span class=k>$(</span>uname -m<span class=k>)</span><span class=s2>&#34;</span> -o /usr/local/bin/docker-compose
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 对 Compose 可执行文件添加运行权限</span>
</span></span><span class=line><span class=cl>sudo chmod +x /usr/local/bin/docker-compose
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 输入下面命令查看帮助，测试安装是否成功</span>
</span></span><span class=line><span class=cl>docker-compose -h
</span></span></code></pre></div><p>Compose 开源在 Docker 官方的 GitHub 仓库：<a href=https://github.com/docker/compose>docker/compose</a>，所有的 Compose 都会发布在仓库的 <a href=https://github.com/docker/compose/releases>Releases</a> 里，步骤1就是使用 curl 命令从 Releases 里下载可执行文件，<code>uname -s</code>和<code>uname -m</code> 可以读取系统的内核名称和硬件架构，用来匹配需要的 Compose 版本， <code>curl</code> 的 -L 参数会让 HTTP 请求跟随重定向（默认不跟随），-o (小写o) 会将服务器响应保存成文件，直接下载到：usr/local/bin/ 下，文件名为：docker-compose，因为这个路径已经在环境变量中了，所以完成步骤2，添加可执行权限后，就可以在任意位置使用了</p><p>直接从 GitHub 下载比较慢可以通过以下地址下载：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># https://vuepress.mirror.docker-practice.com/compose/install/</span>
</span></span><span class=line><span class=cl>sudo curl -L https://download.fastgit.org/docker/compose/releases/download/1.27.4/docker-compose-<span class=sb>`</span>uname -s<span class=sb>`</span>-<span class=sb>`</span>uname -m<span class=sb>`</span> -o /usr/local/bin/docker-compose
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo chmod +x /usr/local/bin/docker-compose
</span></span></code></pre></div><h2 id=入门>入门<a hidden class=anchor aria-hidden=true href=#入门>#</a></h2><p>Compose 的模版指令与 Docker 的 run 命令相关参数很相似，忘记了 docker 命令可以参考之前的一篇博客：<a href=https://www.cnblogs.com/aaronlinv/p/15130730.html>Docker 实践及命令梳理</a></p><p>Compose 中有两个重要的概念：</p><ul><li><p>服务 (service)：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例</p></li><li><p>项目 (project)：由一组关联的应用容器组成的一个完整业务单元，在 <code>docker-compose.yml</code> 文件中定义</p></li></ul><p><code>docker-compose.yml</code> 格式如下，注意：YAML 文件必须要键值之间的 <code>:</code> 后面必须有一个空格，缩进表示层级，要注意缩进
有使用到的 volumes 和 networks 必须声明</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># 指定版本</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 服务的集合</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 其中一个服务，服务名为：webapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>webapp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># 指定该服务使用的镜像</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>examples/web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># 端口映射</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;80:80&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># 数据卷</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;/data&#34;</span><span class=w>
</span></span></span></code></pre></div><h2 id=简单上手>简单上手<a hidden class=anchor aria-hidden=true href=#简单上手>#</a></h2><p>在一个 Compose 中启动 Tomcat, MySQL, redis，创建 <code>docker-compose.yml</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3.0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tomcat</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>mytomcat</span><span class=w> </span><span class=c># --name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>tomcat:8.0-jre8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;8080:8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;tomcatwebapps:/usr/local/tomcat/webapps&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>some_network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># tomcat 服务依赖于 mysql 和 redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mysql</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>mysql:5.7.32</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;3306:3306&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;mysqldata:/var/lib/mysql&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;mysqlconf:/etc/mysql&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>MYSQL_ROOT_PASSWORD=1234</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>some_network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>redis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>redis:5.0.10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;6379:6379&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;redisdata:/data&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;redis-server --appendonly yes&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>some_network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 使用到的 volumes 和 networks 必须声明</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tomcatwebapps</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mysqldata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mysqlconf</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>redisdata</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 声明名称为 “some_network” 的网络</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>some_network</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></div><p>在 <code>docker-compose.yml</code> 所在路径执行 <code>docker-compose up</code> 启动 Compose 项目，它会下载使用到的镜像并在前台运行打印日志，可以使用 Ctrl + C 终止</p><p>如果需要后台运行执行 <code>docker-compose up -d</code>，这时候使用 <code>docker ps</code> 可以看到 Compose 已经根据 yaml 创建了相关的容器，使用 <code>docker-compose down</code> 停止 Compse 并移除自动创建的网桥</p><p>使用 <code>docker network ls</code> 查看网络或者 <code>docker volume ls</code> 查看数据卷，Compose 定义的网络或数据卷名称格式为：docker-compose.yml所在文件夹的名称加上下划线再加上 yaml 中定义名称，如果在 &ldquo;dockerfile&rdquo; 文件夹下创建 yaml 文件并启动，那么网络名称为：<code>dockerfile_some_network</code></p><p>tomcat 服务使用了 <code>depends_on</code>，表示它依赖于 redis 和 mysql 服务，Compose 将优先启动它的依赖再启动它</p><h2 id=命令梳理>命令梳理<a hidden class=anchor aria-hidden=true href=#命令梳理>#</a></h2><p>Docker Compose 的命令与 Dokcer 类似，可以使用 &ndash;help 参数，就可以查询到到对应命令的使用方法</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose --help
</span></span></code></pre></div><p>默认启动的模版文件名为 docker-compose.yml，可以使用 -f 指定自定义的模版文件
可以通过 config 命令，检查模版文件语法是否正确</p><p>docker-compse 也包含很多子命令：
启动停止相关：up, down, restart, stop, pasue, unpause</p><p>资源相关：ps, top, kill, run</p><p>进入容器：exec</p><p>查看日志：logs</p><p>很多子命令都可以在后面跟上某个具体的 service 名称，定向地操作，下面不一一举例，
可以使用<code>docker-compose help</code> 再跟上子命令名称，查询其用法</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 后台启动 yaml 定义的所有容器</span>
</span></span><span class=line><span class=cl>docker-compose up -d
</span></span><span class=line><span class=cl><span class=c1># 仅启动 mysql 这个service，会启动其依赖的 service</span>
</span></span><span class=line><span class=cl>docker-compose up mysql 指定启动的server名称，
</span></span><span class=line><span class=cl><span class=c1># 停止容器并移除自动创建的网桥</span>
</span></span><span class=line><span class=cl>docker-compose down 
</span></span><span class=line><span class=cl><span class=c1># 重启所有 service 后面可以指定上某个具体的 service</span>
</span></span><span class=line><span class=cl>docker-compose restart
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 暂停 和 恢复</span>
</span></span><span class=line><span class=cl>docker-compose pause
</span></span><span class=line><span class=cl>docker-compose unpause
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 进入 redis 这个 service 使用 exit 退出</span>
</span></span><span class=line><span class=cl>docker-compose <span class=nb>exec</span> redis bash
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 列出当前 yaml 中定义的容器的信息</span>
</span></span><span class=line><span class=cl>docker-compose ps
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 删除当前 yaml 中定义的容器，需要先 stop，后面可以指定上某个具体的 service</span>
</span></span><span class=line><span class=cl>docker-compose rm
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看各个 service 容器内运行的进程情况</span>
</span></span><span class=line><span class=cl>docker-compose top
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看日志默认查看 yaml 所有的，可以跟上具体 service</span>
</span></span><span class=line><span class=cl><span class=c1># -f 可以保持跟踪，新的日志会马上显示在屏幕上</span>
</span></span><span class=line><span class=cl>docker-compose logs
</span></span></code></pre></div><h2 id=参考资料>参考资料<a hidden class=anchor aria-hidden=true href=#参考资料>#</a></h2><p><a href=https://www.ruanyifeng.com/blog/2019/09/curl-reference.html>curl 的用法指南</a>
<a href=https://www.bilibili.com/video/BV1ZT4y1K75K>【编程不良人】Docker容器技术&amp;Docker-Compose实战</a></p><hr><p>上一节：<a href=https://www.cnblogs.com/aaronlinv/p/15228488.html>IDEA 配合 Dockerfile 部署 SpringBoot 工程</a></p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://aaronlinv.github.io/posts/%E7%AE%80%E5%8D%95%E7%9A%84-go-%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/><span class=title>« Prev</span><br><span>简单的 Go 入门教程</span>
</a><a class=next href=https://aaronlinv.github.io/posts/idea-%E9%85%8D%E5%90%88-dockerfile-%E9%83%A8%E7%BD%B2-springboot-%E5%B7%A5%E7%A8%8B/><span class=title>Next »</span><br><span>IDEA 配合 Dockerfile 部署 SpringBoot 工程</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://aaronlinv.github.io/>Aaron Lin</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>