<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SpringBoot 测试实践 - 2：单元测试与集成测试 | Aaron Lin</title>
<meta name=keywords content><meta name=description content='上一节：SpringBoot 测试实践 - 1：常用的工具
下一节：SpringBoot 测试实践 - 3：@MockBean、@SpyBean 、提升测试运行速度、Testcontainer


单元测试 vs. 集成测试
只编写单测，无法测试方法之间的集成情况，而且某些需求可能会修改多个方法，这可能会影响方法对应的单测，涉及到大量的相关单测的修改，这样的维护成本很高
可以把重心放在完善集成测试上，专注从外部判断程序是否符合预期。对于一些非常重要的方法，增加单元测试可以减轻集成测试排查错误的难度
先导知识可以参考上一节：SpringBoot 测试实践 - 1：常用的工具
SpringBootTest 和 MockMvc 进行集成测试
从 Spring Boot 2.1 开始 @ExtendWith({SpringExtension.class}) 作为元注解包含在 Spring Boot 测试注解中，例如 @DataJpaTest、@WebMvcTest 和 @SpringBootTest，所以我们不用重复添加 @ExtendWith({SpringExtension.class}) 注解
HelloWorld 测试
使用 SpringBoot 一个简单的 HelloWorld 案例，通过 @SpringBootTest 可以在测试环境中加载整个 Spring 应用程序上下文，@SpringBootTest 注解会扫描应用程序的主配置类，并加载所有的 Bean（包括依赖的 Bean）到测试上下文中。这样，测试中就可以使用完整的 Spring 功能，包括依赖注入、AOP、事务管理等
使用 @AutoConfigureMockMvc 自动配置 MockMvc，通过 MockMvc 可以模拟 HTTP 请求，并对响应的结果进行断言和验证
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.http.MediaType;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;
import org.springframework.test.web.servlet.result.MockMvcResultMatchers;

@AutoConfigureMockMvc
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
public class MySpringBootTest {

    @Autowired
    private MockMvc mockMvc; // 注入 MockMvc

    @Test
    public void testHelloWorld() throws Exception {
        // 发送 GET 请求
        mockMvc.perform(MockMvcRequestBuilders.get("/hello")
                // 设置请求头
                .accept(MediaType.APPLICATION_JSON))
                // 验证响应状态码
                .andExpect(MockMvcResultMatchers.status().isOk())
                // 验证响应内容
                .andExpect(MockMvcResultMatchers.content().string("Hello, World!"));
    }
}
涉及数据层的测试：H2
部分操作涉及到数据库，一般都会引入数据层的依赖，在对应的 HTTP 请求后，对响应体和数据库数据进行断言和验证，就像下面这样：'><meta name=author content><link rel=canonical href=https://aaronlinv.github.io/posts/springboot-%E6%B5%8B%E8%AF%95%E5%AE%9E%E8%B7%B5---2%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B8%8E%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=https://aaronlinv.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://aaronlinv.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://aaronlinv.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://aaronlinv.github.io/apple-touch-icon.png><link rel=mask-icon href=https://aaronlinv.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://aaronlinv.github.io/posts/springboot-%E6%B5%8B%E8%AF%95%E5%AE%9E%E8%B7%B5---2%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B8%8E%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://aaronlinv.github.io/posts/springboot-%E6%B5%8B%E8%AF%95%E5%AE%9E%E8%B7%B5---2%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B8%8E%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95/"><meta property="og:site_name" content="Aaron Lin"><meta property="og:title" content="SpringBoot 测试实践 - 2：单元测试与集成测试"><meta property="og:description" content='上一节：SpringBoot 测试实践 - 1：常用的工具 下一节：SpringBoot 测试实践 - 3：@MockBean、@SpyBean 、提升测试运行速度、Testcontainer
单元测试 vs. 集成测试 只编写单测，无法测试方法之间的集成情况，而且某些需求可能会修改多个方法，这可能会影响方法对应的单测，涉及到大量的相关单测的修改，这样的维护成本很高
可以把重心放在完善集成测试上，专注从外部判断程序是否符合预期。对于一些非常重要的方法，增加单元测试可以减轻集成测试排查错误的难度
先导知识可以参考上一节：SpringBoot 测试实践 - 1：常用的工具
SpringBootTest 和 MockMvc 进行集成测试 从 Spring Boot 2.1 开始 @ExtendWith({SpringExtension.class}) 作为元注解包含在 Spring Boot 测试注解中，例如 @DataJpaTest、@WebMvcTest 和 @SpringBootTest，所以我们不用重复添加 @ExtendWith({SpringExtension.class}) 注解
HelloWorld 测试 使用 SpringBoot 一个简单的 HelloWorld 案例，通过 @SpringBootTest 可以在测试环境中加载整个 Spring 应用程序上下文，@SpringBootTest 注解会扫描应用程序的主配置类，并加载所有的 Bean（包括依赖的 Bean）到测试上下文中。这样，测试中就可以使用完整的 Spring 功能，包括依赖注入、AOP、事务管理等
使用 @AutoConfigureMockMvc 自动配置 MockMvc，通过 MockMvc 可以模拟 HTTP 请求，并对响应的结果进行断言和验证
import org.junit.jupiter.api.Test; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc; import org.springframework.boot.test.context.SpringBootTest; import org.springframework.http.MediaType; import org.springframework.test.web.servlet.MockMvc; import org.springframework.test.web.servlet.request.MockMvcRequestBuilders; import org.springframework.test.web.servlet.result.MockMvcResultMatchers; @AutoConfigureMockMvc @SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT) public class MySpringBootTest { @Autowired private MockMvc mockMvc; // 注入 MockMvc @Test public void testHelloWorld() throws Exception { // 发送 GET 请求 mockMvc.perform(MockMvcRequestBuilders.get("/hello") // 设置请求头 .accept(MediaType.APPLICATION_JSON)) // 验证响应状态码 .andExpect(MockMvcResultMatchers.status().isOk()) // 验证响应内容 .andExpect(MockMvcResultMatchers.content().string("Hello, World!")); } } 涉及数据层的测试：H2 部分操作涉及到数据库，一般都会引入数据层的依赖，在对应的 HTTP 请求后，对响应体和数据库数据进行断言和验证，就像下面这样：'><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-22T08:48:33+08:00"><meta property="article:modified_time" content="2023-08-22T08:48:33+08:00"><meta property="og:image" content="https://aaronlinv.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://aaronlinv.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="SpringBoot 测试实践 - 2：单元测试与集成测试"><meta name=twitter:description content='上一节：SpringBoot 测试实践 - 1：常用的工具
下一节：SpringBoot 测试实践 - 3：@MockBean、@SpyBean 、提升测试运行速度、Testcontainer


单元测试 vs. 集成测试
只编写单测，无法测试方法之间的集成情况，而且某些需求可能会修改多个方法，这可能会影响方法对应的单测，涉及到大量的相关单测的修改，这样的维护成本很高
可以把重心放在完善集成测试上，专注从外部判断程序是否符合预期。对于一些非常重要的方法，增加单元测试可以减轻集成测试排查错误的难度
先导知识可以参考上一节：SpringBoot 测试实践 - 1：常用的工具
SpringBootTest 和 MockMvc 进行集成测试
从 Spring Boot 2.1 开始 @ExtendWith({SpringExtension.class}) 作为元注解包含在 Spring Boot 测试注解中，例如 @DataJpaTest、@WebMvcTest 和 @SpringBootTest，所以我们不用重复添加 @ExtendWith({SpringExtension.class}) 注解
HelloWorld 测试
使用 SpringBoot 一个简单的 HelloWorld 案例，通过 @SpringBootTest 可以在测试环境中加载整个 Spring 应用程序上下文，@SpringBootTest 注解会扫描应用程序的主配置类，并加载所有的 Bean（包括依赖的 Bean）到测试上下文中。这样，测试中就可以使用完整的 Spring 功能，包括依赖注入、AOP、事务管理等
使用 @AutoConfigureMockMvc 自动配置 MockMvc，通过 MockMvc 可以模拟 HTTP 请求，并对响应的结果进行断言和验证
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.http.MediaType;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;
import org.springframework.test.web.servlet.result.MockMvcResultMatchers;

@AutoConfigureMockMvc
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
public class MySpringBootTest {

    @Autowired
    private MockMvc mockMvc; // 注入 MockMvc

    @Test
    public void testHelloWorld() throws Exception {
        // 发送 GET 请求
        mockMvc.perform(MockMvcRequestBuilders.get("/hello")
                // 设置请求头
                .accept(MediaType.APPLICATION_JSON))
                // 验证响应状态码
                .andExpect(MockMvcResultMatchers.status().isOk())
                // 验证响应内容
                .andExpect(MockMvcResultMatchers.content().string("Hello, World!"));
    }
}
涉及数据层的测试：H2
部分操作涉及到数据库，一般都会引入数据层的依赖，在对应的 HTTP 请求后，对响应体和数据库数据进行断言和验证，就像下面这样：'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://aaronlinv.github.io/posts/"},{"@type":"ListItem","position":2,"name":"SpringBoot 测试实践 - 2：单元测试与集成测试","item":"https://aaronlinv.github.io/posts/springboot-%E6%B5%8B%E8%AF%95%E5%AE%9E%E8%B7%B5---2%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B8%8E%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SpringBoot 测试实践 - 2：单元测试与集成测试","name":"SpringBoot 测试实践 - 2：单元测试与集成测试","description":"上一节：SpringBoot 测试实践 - 1：常用的工具 下一节：SpringBoot 测试实践 - 3：@MockBean、@SpyBean 、提升测试运行速度、Testcontainer\n单元测试 vs. 集成测试 只编写单测，无法测试方法之间的集成情况，而且某些需求可能会修改多个方法，这可能会影响方法对应的单测，涉及到大量的相关单测的修改，这样的维护成本很高\n可以把重心放在完善集成测试上，专注从外部判断程序是否符合预期。对于一些非常重要的方法，增加单元测试可以减轻集成测试排查错误的难度\n先导知识可以参考上一节：SpringBoot 测试实践 - 1：常用的工具\nSpringBootTest 和 MockMvc 进行集成测试 从 Spring Boot 2.1 开始 @ExtendWith({SpringExtension.class}) 作为元注解包含在 Spring Boot 测试注解中，例如 @DataJpaTest、@WebMvcTest 和 @SpringBootTest，所以我们不用重复添加 @ExtendWith({SpringExtension.class}) 注解\nHelloWorld 测试 使用 SpringBoot 一个简单的 HelloWorld 案例，通过 @SpringBootTest 可以在测试环境中加载整个 Spring 应用程序上下文，@SpringBootTest 注解会扫描应用程序的主配置类，并加载所有的 Bean（包括依赖的 Bean）到测试上下文中。这样，测试中就可以使用完整的 Spring 功能，包括依赖注入、AOP、事务管理等\n使用 @AutoConfigureMockMvc 自动配置 MockMvc，通过 MockMvc 可以模拟 HTTP 请求，并对响应的结果进行断言和验证\nimport org.junit.jupiter.api.Test; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc; import org.springframework.boot.test.context.SpringBootTest; import org.springframework.http.MediaType; import org.springframework.test.web.servlet.MockMvc; import org.springframework.test.web.servlet.request.MockMvcRequestBuilders; import org.springframework.test.web.servlet.result.MockMvcResultMatchers; @AutoConfigureMockMvc @SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT) public class MySpringBootTest { @Autowired private MockMvc mockMvc; // 注入 MockMvc @Test public void testHelloWorld() throws Exception { // 发送 GET 请求 mockMvc.perform(MockMvcRequestBuilders.get(\u0026#34;/hello\u0026#34;) // 设置请求头 .accept(MediaType.APPLICATION_JSON)) // 验证响应状态码 .andExpect(MockMvcResultMatchers.status().isOk()) // 验证响应内容 .andExpect(MockMvcResultMatchers.content().string(\u0026#34;Hello, World!\u0026#34;)); } } 涉及数据层的测试：H2 部分操作涉及到数据库，一般都会引入数据层的依赖，在对应的 HTTP 请求后，对响应体和数据库数据进行断言和验证，就像下面这样：\n","keywords":[],"articleBody":"上一节：SpringBoot 测试实践 - 1：常用的工具 下一节：SpringBoot 测试实践 - 3：@MockBean、@SpyBean 、提升测试运行速度、Testcontainer\n单元测试 vs. 集成测试 只编写单测，无法测试方法之间的集成情况，而且某些需求可能会修改多个方法，这可能会影响方法对应的单测，涉及到大量的相关单测的修改，这样的维护成本很高\n可以把重心放在完善集成测试上，专注从外部判断程序是否符合预期。对于一些非常重要的方法，增加单元测试可以减轻集成测试排查错误的难度\n先导知识可以参考上一节：SpringBoot 测试实践 - 1：常用的工具\nSpringBootTest 和 MockMvc 进行集成测试 从 Spring Boot 2.1 开始 @ExtendWith({SpringExtension.class}) 作为元注解包含在 Spring Boot 测试注解中，例如 @DataJpaTest、@WebMvcTest 和 @SpringBootTest，所以我们不用重复添加 @ExtendWith({SpringExtension.class}) 注解\nHelloWorld 测试 使用 SpringBoot 一个简单的 HelloWorld 案例，通过 @SpringBootTest 可以在测试环境中加载整个 Spring 应用程序上下文，@SpringBootTest 注解会扫描应用程序的主配置类，并加载所有的 Bean（包括依赖的 Bean）到测试上下文中。这样，测试中就可以使用完整的 Spring 功能，包括依赖注入、AOP、事务管理等\n使用 @AutoConfigureMockMvc 自动配置 MockMvc，通过 MockMvc 可以模拟 HTTP 请求，并对响应的结果进行断言和验证\nimport org.junit.jupiter.api.Test; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc; import org.springframework.boot.test.context.SpringBootTest; import org.springframework.http.MediaType; import org.springframework.test.web.servlet.MockMvc; import org.springframework.test.web.servlet.request.MockMvcRequestBuilders; import org.springframework.test.web.servlet.result.MockMvcResultMatchers; @AutoConfigureMockMvc @SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT) public class MySpringBootTest { @Autowired private MockMvc mockMvc; // 注入 MockMvc @Test public void testHelloWorld() throws Exception { // 发送 GET 请求 mockMvc.perform(MockMvcRequestBuilders.get(\"/hello\") // 设置请求头 .accept(MediaType.APPLICATION_JSON)) // 验证响应状态码 .andExpect(MockMvcResultMatchers.status().isOk()) // 验证响应内容 .andExpect(MockMvcResultMatchers.content().string(\"Hello, World!\")); } } 涉及数据层的测试：H2 部分操作涉及到数据库，一般都会引入数据层的依赖，在对应的 HTTP 请求后，对响应体和数据库数据进行断言和验证，就像下面这样：\n@AutoConfigureMockMvc @Transactional @SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT) class UserControllerIntegrationTest { @Autowired private MockMvc mockMvc; @Autowired private UserRepository userRepository; @Test void createUser() throws Exception { User user = new User(\"张三\", 20); mockMvc.perform(post(\"/users\") .andDo(print()) .contentType(MediaType.APPLICATION_JSON) .content(new ObjectMapper().writeValueAsString(user))) .andExpect(status().isOk()) .andExpect(jsonPath(\"$.id\").isNotEmpty()) .andExpect(jsonPath(\"$.name\").value(user.getName())) .andExpect(jsonPath(\"$.age\").value(user.getAge())); assertThat(userRepository.count()).isEqualTo(1); } @Test void getUser() throws Exception { User user = userRepository.save(new User(\"张三\", 20)); mockMvc.perform(get(\"/users/{id}\", user.getId())) .andDo(print()) .andExpect(status().isOk()) .andExpect(jsonPath(\"$.id\").value(user.getId())) .andExpect(jsonPath(\"$.name\").value(user.getName())) .andExpect(jsonPath(\"$.age\").value(user.getAge())); } @Test void deleteUser() throws Exception { User user = userRepository.save(new User(\"张三\", 20)); mockMvc.perform(delete(\"/users/{id}\", user.getId())) .andExpect(status().isOk()); assertThat(userRepository.findById(user.getId())).isEmpty(); } } 涉及到数据库的集成测试一般都会对数据库进行增删改，可能会影响到测试环境的数据库，所以在测试中有一种方式是用 H2 内存数据库代替测试环境数据库进行测试，但是 H2 数据库和我们实际使用的 MySQL 或 PostgreSQL 不同，所以它有些问题：\nSQL 语法不同，初始化测试环境需要使用 SQL 脚本，要将实际数据库的脚本转化为符合 H2 语法的 SQL 脚本 与实际数据库差异在断言的时候也可能导致一些奇奇怪怪的问题，浮点数精度不一致等等的 需要额外进行一些配置，方言 (Dialect) 等等的 故不推荐这种方式，对这种方式感兴趣可以参考这篇文章： How to Write Integration Tests with H2 In-Memory Database and Springboot\n代码可以可参考这个仓库，提供了集成测试以及不同层的测试：spring-boot-fullstack-professional\n使用实际数据库完成单元测试 直接本地部署与线上相同类型的数据库，并创建好对应的库，指定所有测试都使用这个库，这样就可以解决 H2 兼容性的问题\n这里以 若依 v3.8.6 为例：\n本地部署 MySQL 并且新建一个测试专用的库：ry_vue_test，在代码中增加 application-test.yml： spring: datasource: # UTC+0 url: jdbc:mysql://localhost:3306/ry_vue_test?useUnicode=true\u0026characterEncoding=utf8\u0026zeroDateTimeBehavior=convertToNull\u0026useSSL=true\u0026serverTimezone=GMT%2B8 username: root password: ^PsL)H~ driver-class-name: com.mysql.cj.jdbc.Driver 增加 MyBatis 测试依赖 org.mybatis.spring.boot mybatis-spring-boot-starter-test 2.2.0 test 先写一个针对 com.ruoyi.project.system.mapper.SysUserMapper 的数据层测试： 注意！不熟悉流程的情况下建议先注释测试数据库的地址，避免测试代码影响到测试库数据\npackage com.ruoyi.project.system.mapper; import com.ruoyi.framework.config.ApplicationConfig; import com.ruoyi.project.system.domain.SysUser; import org.junit.jupiter.api.Test; import org.mybatis.spring.boot.test.autoconfigure.MybatisTest; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase; import org.springframework.test.context.ActiveProfiles; import org.springframework.test.context.ContextConfiguration; import org.springframework.test.context.jdbc.Sql; import static org.assertj.core.api.AssertionsForInterfaceTypes.assertThat; import static org.junit.jupiter.api.Assertions.*; import static org.springframework.test.context.jdbc.Sql.ExecutionPhase.BEFORE_TEST_METHOD; // 自动配置 MyBatis 相关的组件，并创建一个测试专用的数据库会话。这样可以在测试中使用 MyBatis 的功能 @MybatisTest // 指定了测试上下文的配置类，这样可以加载应用程序的配置，并将其用于测试中的依赖注入 @ContextConfiguration(classes = {ApplicationConfig.class}) // 指定了要激活的配置文件，对应上面创建的 `application-test.yml` @ActiveProfiles(\"test\") // 禁用了自动配置替换测试数据库的功能，测试将使用真实的数据库进行操作，而不是使用内存数据库或其他替代数据库 @AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE) // 在每个测试方法执行之前都运行该脚本：初始化每个测试用例的数据库初始数据 @Sql(value = \"classpath:sql/sys_user.sql\", executionPhase = BEFORE_TEST_METHOD) class SysUserMapperTest { @Autowired private SysUserMapper userMapper; @Test void selectUserById() { SysUser sysUser = userMapper.selectUserById(1L); assertThat(sysUser).isNotNull(); assertThat(sysUser.getUserName()).isEqualTo(\"admin\"); // 添加更多的断言 } } 这里必须配置 @ContextConfiguration(classes = {ApplicationConfig.class})，因为 ApplicationConfig.class 包含了 Mapper 的扫描配置：@MapperScan(\"com.ruoyi.project.**.mapper\")\n复盘一下整个测试运行的流程：\n自动配置 MyBatis 相关的组件，创建一个测试专用的数据库会话 加载 ApplicationConfig 类作为测试上下文的配置 激活名为 “test” 的配置文件，将其用于测试中的依赖注入，这里包含 MySQL 的相关配置 禁用自动配置替换测试数据库的功能，使用真实的数据库进行操作，即上面 “test” 的 MySQL 在每个测试方法执行之前，运行位于类路径下的 “sql/sys_user.sql” SQL 脚本，完成用户数据的初始化 自动注入 SysUserMapper 对象，该对象是需要进行测试的 MyBatis 映射器 执行 selectUserById(1L)，查询数据并执行断言 这个流程不仅可以测试数据层，还可以直接用于测试服务层。因为 @MybatisTest 不需要启动完整的应用程序上下文，使得整个测试非常快。具体可以参考：MyBatis 测试文档\n使用实际数据库完成集成测试 与上面 @MybatisTest 不同的是：集成测试使用 @SpringBootTest，这个注解会加载整个 Spring Boot 应用程序的上下文，并配置所有的组件，它会启动整个应用程序，并模拟实际的运行环境。所以需要保证 SpringBoot 的初始化配置，否则会应用会启动失败。待测接口为：com.ruoyi.project.system.controller.SysUserController\n增加用于集成测试的 Spring 配置 application-it.yml，需要指定好测试的数据库，最好把可能影响测试环境的配置（Redis 等的）都修为集成测试专用的环境 # 数据源配置 spring: datasource: type: com.alibaba.druid.pool.DruidDataSource driverClassName: com.mysql.cj.jdbc.Driver druid: # 主库数据源 master: # UTC+0 url: jdbc:mysql://localhost:3306/ry_vue_test?useUnicode=true\u0026characterEncoding=utf8\u0026zeroDateTimeBehavior=convertToNull\u0026useSSL=true\u0026serverTimezone=GMT%2B8 username: root password: ^PsL)H~ # 从库数据源 slave: # 从数据源开关/默认关闭 enabled: false url: username: password: # 初始连接数 initialSize: 5 # 最小连接池数量 minIdle: 10 # 最大连接池数量 maxActive: 20 # 配置获取连接等待超时的时间 maxWait: 60000 # 配置连接超时时间 connectTimeout: 30000 # 配置网络超时时间 socketTimeout: 60000 # 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒 timeBetweenEvictionRunsMillis: 60000 # 配置一个连接在池中最小生存的时间，单位是毫秒 minEvictableIdleTimeMillis: 300000 # 配置一个连接在池中最大生存的时间，单位是毫秒 maxEvictableIdleTimeMillis: 900000 # 配置检测连接是否有效 validationQuery: SELECT 1 FROM DUAL testWhileIdle: true testOnBorrow: false testOnReturn: false webStatFilter: enabled: true statViewServlet: enabled: true # 设置白名单，不填则允许所有访问 allow: url-pattern: /druid/* # 控制台管理用户名和密码 login-username: ruoyi login-password: 123456 filter: stat: enabled: true # 慢SQL记录 log-slow-sql: true slow-sql-millis: 1000 merge-sql: true wall: config: multi-statement-allow: true # redis 配置 redis: # 地址 host: localhost # 端口，默认为6379 port: 6379 # 数据库索引 database: 1 # 密码 password: # 连接超时时间 timeout: 10s lettuce: pool: # 连接池中的最小空闲连接 min-idle: 0 # 连接池中的最大空闲连接 max-idle: 8 # 连接池的最大数据库连接数 max-active: 8 # #连接池最大阻塞等待时间（使用负值表示没有限制） max-wait: -1ms 创建应用初始化必须的库，否则启动容器会启动失败，提示表不存在：; bad SQL grammar []; nested exception is java.sql.SQLSyntaxErrorException: Table 'ry_vue_test.sys_config' doesn't exist，手动创建以下必须的表，确保应用正常启动 drop table if exists sys_config; create table sys_config ( config_id int(5) not null auto_increment comment '参数主键', config_name varchar(100) default '' comment '参数名称', config_key varchar(100) default '' comment '参数键名', config_value varchar(500) default '' comment '参数键值', config_type char(1) default 'N' comment '系统内置（Y是 N否）', create_by varchar(64) default '' comment '创建者', create_time datetime comment '创建时间', update_by varchar(64) default '' comment '更新者', update_time datetime comment '更新时间', remark varchar(500) default null comment '备注', primary key (config_id) ) engine=innodb auto_increment=100 comment = '参数配置表'; drop table if exists sys_job; create table sys_job ( job_id bigint(20) not null auto_increment comment '任务ID', job_name varchar(64) default '' comment '任务名称', job_group varchar(64) default 'DEFAULT' comment '任务组名', invoke_target varchar(500) not null comment '调用目标字符串', cron_expression varchar(255) default '' comment 'cron执行表达式', misfire_policy varchar(20) default '3' comment '计划执行错误策略（1立即执行 2执行一次 3放弃执行）', concurrent char(1) default '1' comment '是否并发执行（0允许 1禁止）', status char(1) default '0' comment '状态（0正常 1暂停）', create_by varchar(64) default '' comment '创建者', create_time datetime comment '创建时间', update_by varchar(64) default '' comment '更新者', update_time datetime comment '更新时间', remark varchar(500) default '' comment '备注信息', primary key (job_id, job_name, job_group) ) engine=innodb auto_increment=100 comment = '定时任务调度表'; drop table if exists sys_dict_data; create table sys_dict_data ( dict_code bigint(20) not null auto_increment comment '字典编码', dict_sort int(4) default 0 comment '字典排序', dict_label varchar(100) default '' comment '字典标签', dict_value varchar(100) default '' comment '字典键值', dict_type varchar(100) default '' comment '字典类型', css_class varchar(100) default null comment '样式属性（其他样式扩展）', list_class varchar(100) default null comment '表格回显样式', is_default char(1) default 'N' comment '是否默认（Y是 N否）', status char(1) default '0' comment '状态（0正常 1停用）', create_by varchar(64) default '' comment '创建者', create_time datetime comment '创建时间', update_by varchar(64) default '' comment '更新者', update_time datetime comment '更新时间', remark varchar(500) default null comment '备注', primary key (dict_code) ) engine=innodb auto_increment=100 comment = '字典数据表'; 为了保证集成环境数据的一致性，我们可以把数据的初始化都放在 sys_user_it.sql 中，每次运行测试前都先执行 drop table if exists sys_config; create table sys_config ( config_id int(5) not null auto_increment comment '参数主键', config_name varchar(100) default '' comment '参数名称', config_key varchar(100) default '' comment '参数键名', config_value varchar(500) default '' comment '参数键值', config_type char(1) default 'N' comment '系统内置（Y是 N否）', create_by varchar(64) default '' comment '创建者', create_time datetime comment '创建时间', update_by varchar(64) default '' comment '更新者', update_time datetime comment '更新时间', remark varchar(500) default null comment '备注', primary key (config_id) ) engine=innodb auto_increment=100 comment = '参数配置表'; insert into sys_config values(1, '主框架页-默认皮肤样式名称', 'sys.index.skinName', 'skin-blue', 'Y', 'admin', sysdate(), '', null, '蓝色 skin-blue、绿色 skin-green、紫色 skin-purple、红色 skin-red、黄色 skin-yellow' ); insert into sys_config values(2, '用户管理-账号初始密码', 'sys.user.initPassword', '123456', 'Y', 'admin', sysdate(), '', null, '初始化密码 123456' ); insert into sys_config values(3, '主框架页-侧边栏主题', 'sys.index.sideTheme', 'theme-dark', 'Y', 'admin', sysdate(), '', null, '深色主题theme-dark，浅色主题theme-light' ); insert into sys_config values(4, '账号自助-验证码开关', 'sys.account.captchaEnabled', 'true', 'Y', 'admin', sysdate(), '', null, '是否开启验证码功能（true开启，false关闭）'); insert into sys_config values(5, '账号自助-是否开启用户注册功能', 'sys.account.registerUser', 'false', 'Y', 'admin', sysdate(), '', null, '是否开启注册用户功能（true开启，false关闭）'); insert into sys_config values(6, '用户登录-黑名单列表', 'sys.login.blackIPList', '', 'Y', 'admin', sysdate(), '', null, '设置登录IP黑名单限制，多个匹配项以;分隔，支持匹配（*通配、网段）'); drop table if exists sys_job; create table sys_job ( job_id bigint(20) not null auto_increment comment '任务ID', job_name varchar(64) default '' comment '任务名称', job_group varchar(64) default 'DEFAULT' comment '任务组名', invoke_target varchar(500) not null comment '调用目标字符串', cron_expression varchar(255) default '' comment 'cron执行表达式', misfire_policy varchar(20) default '3' comment '计划执行错误策略（1立即执行 2执行一次 3放弃执行）', concurrent char(1) default '1' comment '是否并发执行（0允许 1禁止）', status char(1) default '0' comment '状态（0正常 1暂停）', create_by varchar(64) default '' comment '创建者', create_time datetime comment '创建时间', update_by varchar(64) default '' comment '更新者', update_time datetime comment '更新时间', remark varchar(500) default '' comment '备注信息', primary key (job_id, job_name, job_group) ) engine=innodb auto_increment=100 comment = '定时任务调度表'; insert into sys_job values(1, '系统默认（无参）', 'DEFAULT', 'ryTask.ryNoParams', '0/10 * * * * ?', '3', '1', '1', 'admin', sysdate(), '', null, ''); insert into sys_job values(2, '系统默认（有参）', 'DEFAULT', 'ryTask.ryParams(\\'ry\\')', '0/15 * * * * ?', '3', '1', '1', 'admin', sysdate(), '', null, ''); insert into sys_job values(3, '系统默认（多参）', 'DEFAULT', 'ryTask.ryMultipleParams(\\'ry\\', true, 2000L, 316.50D, 100)', '0/20 * * * * ?', '3', '1', '1', 'admin', sysdate(), '', null, ''); drop table if exists sys_dict_data; create table sys_dict_data ( dict_code bigint(20) not null auto_increment comment '字典编码', dict_sort int(4) default 0 comment '字典排序', dict_label varchar(100) default '' comment '字典标签', dict_value varchar(100) default '' comment '字典键值', dict_type varchar(100) default '' comment '字典类型', css_class varchar(100) default null comment '样式属性（其他样式扩展）', list_class varchar(100) default null comment '表格回显样式', is_default char(1) default 'N' comment '是否默认（Y是 N否）', status char(1) default '0' comment '状态（0正常 1停用）', create_by varchar(64) default '' comment '创建者', create_time datetime comment '创建时间', update_by varchar(64) default '' comment '更新者', update_time datetime comment '更新时间', remark varchar(500) default null comment '备注', primary key (dict_code) ) engine=innodb auto_increment=100 comment = '字典数据表'; insert into sys_dict_data values(1, 1, '男', '0', 'sys_user_sex', '', '', 'Y', '0', 'admin', sysdate(), '', null, '性别男'); insert into sys_dict_data values(2, 2, '女', '1', 'sys_user_sex', '', '', 'N', '0', 'admin', sysdate(), '', null, '性别女'); insert into sys_dict_data values(3, 3, '未知', '2', 'sys_user_sex', '', '', 'N', '0', 'admin', sysdate(), '', null, '性别未知'); insert into sys_dict_data values(4, 1, '显示', '0', 'sys_show_hide', '', 'primary', 'Y', '0', 'admin', sysdate(), '', null, '显示菜单'); insert into sys_dict_data values(5, 2, '隐藏', '1', 'sys_show_hide', '', 'danger', 'N', '0', 'admin', sysdate(), '', null, '隐藏菜单'); insert into sys_dict_data values(6, 1, '正常', '0', 'sys_normal_disable', '', 'primary', 'Y', '0', 'admin', sysdate(), '', null, '正常状态'); insert into sys_dict_data values(7, 2, '停用', '1', 'sys_normal_disable', '', 'danger', 'N', '0', 'admin', sysdate(), '', null, '停用状态'); insert into sys_dict_data values(8, 1, '正常', '0', 'sys_job_status', '', 'primary', 'Y', '0', 'admin', sysdate(), '', null, '正常状态'); insert into sys_dict_data values(9, 2, '暂停', '1', 'sys_job_status', '', 'danger', 'N', '0', 'admin', sysdate(), '', null, '停用状态'); insert into sys_dict_data values(10, 1, '默认', 'DEFAULT', 'sys_job_group', '', '', 'Y', '0', 'admin', sysdate(), '', null, '默认分组'); insert into sys_dict_data values(11, 2, '系统', 'SYSTEM', 'sys_job_group', '', '', 'N', '0', 'admin', sysdate(), '', null, '系统分组'); insert into sys_dict_data values(12, 1, '是', 'Y', 'sys_yes_no', '', 'primary', 'Y', '0', 'admin', sysdate(), '', null, '系统默认是'); insert into sys_dict_data values(13, 2, '否', 'N', 'sys_yes_no', '', 'danger', 'N', '0', 'admin', sysdate(), '', null, '系统默认否'); insert into sys_dict_data values(14, 1, '通知', '1', 'sys_notice_type', '', 'warning', 'Y', '0', 'admin', sysdate(), '', null, '通知'); insert into sys_dict_data values(15, 2, '公告', '2', 'sys_notice_type', '', 'success', 'N', '0', 'admin', sysdate(), '', null, '公告'); insert into sys_dict_data values(16, 1, '正常', '0', 'sys_notice_status', '', 'primary', 'Y', '0', 'admin', sysdate(), '', null, '正常状态'); insert into sys_dict_data values(17, 2, '关闭', '1', 'sys_notice_status', '', 'danger', 'N', '0', 'admin', sysdate(), '', null, '关闭状态'); insert into sys_dict_data values(18, 99, '其他', '0', 'sys_oper_type', '', 'info', 'N', '0', 'admin', sysdate(), '', null, '其他操作'); insert into sys_dict_data values(19, 1, '新增', '1', 'sys_oper_type', '', 'info', 'N', '0', 'admin', sysdate(), '', null, '新增操作'); insert into sys_dict_data values(20, 2, '修改', '2', 'sys_oper_type', '', 'info', 'N', '0', 'admin', sysdate(), '', null, '修改操作'); insert into sys_dict_data values(21, 3, '删除', '3', 'sys_oper_type', '', 'danger', 'N', '0', 'admin', sysdate(), '', null, '删除操作'); insert into sys_dict_data values(22, 4, '授权', '4', 'sys_oper_type', '', 'primary', 'N', '0', 'admin', sysdate(), '', null, '授权操作'); insert into sys_dict_data values(23, 5, '导出', '5', 'sys_oper_type', '', 'warning', 'N', '0', 'admin', sysdate(), '', null, '导出操作'); insert into sys_dict_data values(24, 6, '导入', '6', 'sys_oper_type', '', 'warning', 'N', '0', 'admin', sysdate(), '', null, '导入操作'); insert into sys_dict_data values(25, 7, '强退', '7', 'sys_oper_type', '', 'danger', 'N', '0', 'admin', sysdate(), '', null, '强退操作'); insert into sys_dict_data values(26, 8, '生成代码', '8', 'sys_oper_type', '', 'warning', 'N', '0', 'admin', sysdate(), '', null, '生成操作'); insert into sys_dict_data values(27, 9, '清空数据', '9', 'sys_oper_type', '', 'danger', 'N', '0', 'admin', sysdate(), '', null, '清空操作'); insert into sys_dict_data values(28, 1, '成功', '0', 'sys_common_status', '', 'primary', 'N', '0', 'admin', sysdate(), '', null, '正常状态'); insert into sys_dict_data values(29, 2, '失败', '1', 'sys_common_status', '', 'danger', 'N', '0', 'admin', sysdate(), '', null, '停用状态'); drop table if exists sys_post; create table sys_post ( post_id bigint(20) not null auto_increment comment '岗位ID', post_code varchar(64) not null comment '岗位编码', post_name varchar(50) not null comment '岗位名称', post_sort int(4) not null comment '显示顺序', status char(1) not null comment '状态（0正常 1停用）', create_by varchar(64) default '' comment '创建者', create_time datetime comment '创建时间', update_by varchar(64) default ''\tcomment '更新者', update_time datetime comment '更新时间', remark varchar(500) default null comment '备注', primary key (post_id) ) engine=innodb comment = '岗位信息表'; drop table if exists sys_user_post; create table sys_user_post ( user_id bigint(20) not null comment '用户ID', post_id bigint(20) not null comment '岗位ID', primary key (user_id, post_id) ) engine=innodb comment = '用户与岗位关联表'; 添加 sys_user.sql：\ndrop table if exists sys_user; create table sys_user ( user_id bigint(20) not null auto_increment comment '用户ID', dept_id bigint(20) default null comment '部门ID', user_name varchar(30) not null comment '用户账号', nick_name varchar(30) not null comment '用户昵称', user_type varchar(2) default '00' comment '用户类型（00系统用户）', email varchar(50) default '' comment '用户邮箱', phonenumber varchar(11) default '' comment '手机号码', sex char(1) default '0' comment '用户性别（0男 1女 2未知）', avatar varchar(100) default '' comment '头像地址', password varchar(100) default '' comment '密码', status char(1) default '0' comment '帐号状态（0正常 1停用）', del_flag char(1) default '0' comment '删除标志（0代表存在 2代表删除）', login_ip varchar(128) default '' comment '最后登录IP', login_date datetime comment '最后登录时间', create_by varchar(64) default '' comment '创建者', create_time datetime comment '创建时间', update_by varchar(64) default '' comment '更新者', update_time datetime comment '更新时间', remark varchar(500) default null comment '备注', primary key (user_id) ) engine=innodb auto_increment=100 comment = '用户信息表'; insert into sys_user values (1, 103, 'admin', '若依', '00', 'ry@163.com', '15888888888', '1', '', '$2a$10$7JB720yubVSZvUI0rEqK/.VqGOZTH.ulu33dHOiBE8ByOhJIrdAu2', '0', '0', '127.0.0.1', sysdate(), 'admin', sysdate(), '', null, '管理员'); insert into sys_user values (2, 105, 'ry', '若依', '00', 'ry@qq.com', '15666666666', '1', '', '$2a$10$7JB720yubVSZvUI0rEqK/.VqGOZTH.ulu33dHOiBE8ByOhJIrdAu2', '0', '0', '127.0.0.1', sysdate(), 'admin', sysdate(), '', null, '测试员'); 增加测试代码： package com.ruoyi.project.system.controller; import org.junit.jupiter.api.Test; import org.junit.jupiter.api.extension.ExtendWith; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc; import org.springframework.boot.test.context.SpringBootTest; import org.springframework.http.MediaType; import org.springframework.test.context.ActiveProfiles; import org.springframework.test.context.jdbc.Sql; import org.springframework.test.context.jdbc.SqlGroup; import org.springframework.test.context.junit.jupiter.SpringExtension; import org.springframework.test.web.servlet.MockMvc; import org.springframework.test.web.servlet.request.MockMvcRequestBuilders; import org.springframework.test.web.servlet.result.MockMvcResultMatchers; import static org.springframework.test.context.jdbc.Sql.ExecutionPhase.BEFORE_TEST_METHOD; @AutoConfigureMockMvc @SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT) // 指定了要激活的配置文件，对应上面创建的 `application-it.yml` @ActiveProfiles(\"it\") @SqlGroup({ @Sql(value = \"classpath:sql/sys_user_it.sql\", executionPhase = BEFORE_TEST_METHOD), @Sql(value = \"classpath:sql/sys_user.sql\", executionPhase = BEFORE_TEST_METHOD) }) class SysUserControllerTest { @Autowired private MockMvc mockMvc; @Test void getInfo() throws Exception { mockMvc.perform(MockMvcRequestBuilders.get(\"/system/user/1\") // 设置请求头 .accept(MediaType.APPLICATION_JSON)) // 验证响应状态码 .andExpect(MockMvcResultMatchers.status().isOk()) // 验证响应内容 .andExpect(MockMvcResultMatchers.content().string(\"\")); } } 运行测试，测试将失败，后端返回：{\"msg\":\"请求访问：/system/user/1，认证失败，无法访问系统资源\",\"code\":401}，权限校验还需要处理\n引入 SpdringSecurityTest 依赖 org.springframework.security spring-security-test 6.1.2 test 在测试代码中 Mock 用户，因为若依使用的自定义的 UserDetails，所以必须手动设置 UserDetails：.with(user(new LoginUser(new SysUser(1L), new HashSet\u003c\u003e(Arrays.asList(\"system:user:query\")))))，不能直接用注解 Mock，更多写法可以参考：Running a Test as a User in Spring MVC Test package com.ruoyi.project.system.controller; import com.ruoyi.framework.security.LoginUser; import com.ruoyi.project.system.domain.SysUser; import org.junit.jupiter.api.Test; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc; import org.springframework.boot.test.context.SpringBootTest; import org.springframework.http.MediaType; import org.springframework.test.context.ActiveProfiles; import org.springframework.test.context.jdbc.Sql; import org.springframework.test.context.jdbc.SqlGroup; import org.springframework.test.web.servlet.MockMvc; import org.springframework.test.web.servlet.request.MockMvcRequestBuilders; import org.springframework.test.web.servlet.result.MockMvcResultMatchers; import org.springframework.web.context.WebApplicationContext; import java.util.Arrays; import java.util.HashSet; import static org.springframework.security.test.web.servlet.request.SecurityMockMvcRequestPostProcessors.user; import static org.springframework.test.context.jdbc.Sql.ExecutionPhase.BEFORE_TEST_METHOD; @AutoConfigureMockMvc @SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT) // 指定了要激活的配置文件，对应上面创建的 `application-it.yml` @ActiveProfiles(\"it\") @SqlGroup({ @Sql(value = \"classpath:sql/sys_user_it.sql\", executionPhase = BEFORE_TEST_METHOD), @Sql(value = \"classpath:sql/sys_user.sql\", executionPhase = BEFORE_TEST_METHOD) }) class SysUserControllerTest { @Autowired private WebApplicationContext context; @Autowired private MockMvc mockMvc; @Test void getInfo() throws Exception { mockMvc.perform(MockMvcRequestBuilders.get(\"/system/user/1\") .with(user(new LoginUser(new SysUser(1L), new HashSet\u003c\u003e(Arrays.asList(\"system:user:query\"))))) // 设置请求头 .accept(MediaType.APPLICATION_JSON)) // 验证响应状态码 .andExpect(MockMvcResultMatchers.status().isOk()) // 验证响应内容 .andExpect(MockMvcResultMatchers.jsonPath(\"$.msg\").value(\"操作成功\")) .andExpect(MockMvcResultMatchers.jsonPath(\"$.code\").value(200)) .andExpect(MockMvcResultMatchers.jsonPath(\"$.data.userName\").value(\"admin\")) .andExpect(MockMvcResultMatchers.jsonPath(\"$.data.roles[0].roleName\").value(\"超级管理员\")); // 添加更多的断言 } } 上一节：SpringBoot 测试实践 - 1：常用的工具 下一节：SpringBoot 测试实践 - 3：@MockBean、@SpyBean 、提升测试运行速度、Testcontainer\n参考资料 MyBatis 测试 Spring boot Mybatis-Plus数据库单测实战（三种方式） 如何高效地协作开发：一些 Google 的实践 Java Web 项目单元测试/集成测试 @SpringBootTest not working (execution throwing NullPointerException) 直播回放 | 7月21日「JetBrains码上道」| 主题：Java中的测试与重构 代码很烂，但它能用，你敢重构吗？ 单元测试为什么在互联网滑铁卢 单元测试有必要吗？ Testing the Web Layer Software Testing Tutorial - Learn Unit Testing and Integration Testing Test-Driven Security\n","wordCount":"2312","inLanguage":"en","image":"https://aaronlinv.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2023-08-22T08:48:33+08:00","dateModified":"2023-08-22T08:48:33+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://aaronlinv.github.io/posts/springboot-%E6%B5%8B%E8%AF%95%E5%AE%9E%E8%B7%B5---2%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B8%8E%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95/"},"publisher":{"@type":"Organization","name":"Aaron Lin","logo":{"@type":"ImageObject","url":"https://aaronlinv.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://aaronlinv.github.io/ accesskey=h title="Aaron's Blog (Alt + H)">Aaron's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://aaronlinv.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://aaronlinv.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://aaronlinv.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://aaronlinv.github.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">SpringBoot 测试实践 - 2：单元测试与集成测试</h1><div class=post-meta><span title='2023-08-22 08:48:33 +0800 +0800'>August 22, 2023</span></div></header><div class=post-content><p>上一节：<a href=https://www.cnblogs.com/aaronlinv/p/17645009.html>SpringBoot 测试实践 - 1：常用的工具</a>
下一节：<a href=https://www.cnblogs.com/aaronlinv/p/17652720.html>SpringBoot 测试实践 - 3：@MockBean、@SpyBean 、提升测试运行速度、Testcontainer</a></p><hr><h2 id=单元测试-vs-集成测试>单元测试 vs. 集成测试<a hidden class=anchor aria-hidden=true href=#单元测试-vs-集成测试>#</a></h2><p>只编写单测，无法测试方法之间的集成情况，而且某些需求可能会修改多个方法，这可能会影响方法对应的单测，涉及到大量的相关单测的修改，这样的维护成本很高</p><p>可以把重心放在完善集成测试上，专注从外部判断程序是否符合预期。对于一些非常重要的方法，增加单元测试可以减轻集成测试排查错误的难度</p><p>先导知识可以参考上一节：<a href=https://www.cnblogs.com/aaronlinv/p/17645009.html>SpringBoot 测试实践 - 1：常用的工具</a></p><h2 id=springboottest-和-mockmvc-进行集成测试>SpringBootTest 和 MockMvc 进行集成测试<a hidden class=anchor aria-hidden=true href=#springboottest-和-mockmvc-进行集成测试>#</a></h2><p>从 <a href=https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.1-Release-Notes#junit-5>Spring Boot 2.1</a> 开始 <code>@ExtendWith({SpringExtension.class})</code> 作为元注解包含在 Spring Boot 测试注解中，例如 @DataJpaTest、@WebMvcTest 和 @SpringBootTest，所以我们不用重复添加 <code>@ExtendWith({SpringExtension.class})</code> 注解</p><h3 id=helloworld-测试>HelloWorld 测试<a hidden class=anchor aria-hidden=true href=#helloworld-测试>#</a></h3><p>使用 SpringBoot 一个简单的 HelloWorld 案例，通过 <code>@SpringBootTest</code> 可以在测试环境中加载整个 Spring 应用程序上下文，<code>@SpringBootTest</code> 注解会扫描应用程序的主配置类，并加载所有的 Bean（包括依赖的 Bean）到测试上下文中。这样，测试中就可以使用完整的 Spring 功能，包括依赖注入、AOP、事务管理等</p><p>使用 <code>@AutoConfigureMockMvc</code> 自动配置 <code>MockMvc</code>，通过 <code>MockMvc</code> 可以模拟 HTTP 请求，并对响应的结果进行断言和验证</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>org.junit.jupiter.api.Test</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.beans.factory.annotation.Autowired</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.boot.test.context.SpringBootTest</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.MediaType</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.web.servlet.MockMvc</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.web.servlet.request.MockMvcRequestBuilders</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.web.servlet.result.MockMvcResultMatchers</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AutoConfigureMockMvc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@SpringBootTest</span><span class=p>(</span><span class=n>webEnvironment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SpringBootTest</span><span class=p>.</span><span class=na>WebEnvironment</span><span class=p>.</span><span class=na>RANDOM_PORT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MySpringBootTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>MockMvc</span><span class=w> </span><span class=n>mockMvc</span><span class=p>;</span><span class=w> </span><span class=c1>// 注入 MockMvc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testHelloWorld</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 发送 GET 请求</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>MockMvcRequestBuilders</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;/hello&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 设置请求头</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>accept</span><span class=p>(</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 验证响应状态码</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>MockMvcResultMatchers</span><span class=p>.</span><span class=na>status</span><span class=p>().</span><span class=na>isOk</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 验证响应内容</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>MockMvcResultMatchers</span><span class=p>.</span><span class=na>content</span><span class=p>().</span><span class=na>string</span><span class=p>(</span><span class=s>&#34;Hello, World!&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=涉及数据层的测试h2>涉及数据层的测试：H2<a hidden class=anchor aria-hidden=true href=#涉及数据层的测试h2>#</a></h3><p>部分操作涉及到数据库，一般都会引入数据层的依赖，在对应的 HTTP 请求后，对响应体和数据库数据进行断言和验证，就像下面这样：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@AutoConfigureMockMvc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@SpringBootTest</span><span class=p>(</span><span class=n>webEnvironment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SpringBootTest</span><span class=p>.</span><span class=na>WebEnvironment</span><span class=p>.</span><span class=na>RANDOM_PORT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>UserControllerIntegrationTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>MockMvc</span><span class=w> </span><span class=n>mockMvc</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>UserRepository</span><span class=w> </span><span class=n>userRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>createUser</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>User</span><span class=p>(</span><span class=s>&#34;张三&#34;</span><span class=p>,</span><span class=w> </span><span class=n>20</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>post</span><span class=p>(</span><span class=s>&#34;/users&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andDo</span><span class=p>(</span><span class=n>print</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>contentType</span><span class=p>(</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>content</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>ObjectMapper</span><span class=p>().</span><span class=na>writeValueAsString</span><span class=p>(</span><span class=n>user</span><span class=p>)))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>isOk</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>jsonPath</span><span class=p>(</span><span class=s>&#34;$.id&#34;</span><span class=p>).</span><span class=na>isNotEmpty</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>jsonPath</span><span class=p>(</span><span class=s>&#34;$.name&#34;</span><span class=p>).</span><span class=na>value</span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getName</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>jsonPath</span><span class=p>(</span><span class=s>&#34;$.age&#34;</span><span class=p>).</span><span class=na>value</span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getAge</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>userRepository</span><span class=p>.</span><span class=na>count</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>getUser</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>User</span><span class=p>(</span><span class=s>&#34;张三&#34;</span><span class=p>,</span><span class=w> </span><span class=n>20</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>get</span><span class=p>(</span><span class=s>&#34;/users/{id}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andDo</span><span class=p>(</span><span class=n>print</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>isOk</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>jsonPath</span><span class=p>(</span><span class=s>&#34;$.id&#34;</span><span class=p>).</span><span class=na>value</span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>jsonPath</span><span class=p>(</span><span class=s>&#34;$.name&#34;</span><span class=p>).</span><span class=na>value</span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getName</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>jsonPath</span><span class=p>(</span><span class=s>&#34;$.age&#34;</span><span class=p>).</span><span class=na>value</span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getAge</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>deleteUser</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>User</span><span class=p>(</span><span class=s>&#34;张三&#34;</span><span class=p>,</span><span class=w> </span><span class=n>20</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>delete</span><span class=p>(</span><span class=s>&#34;/users/{id}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>isOk</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>userRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>())).</span><span class=na>isEmpty</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>涉及到数据库的集成测试一般都会对数据库进行增删改，可能会影响到测试环境的数据库，所以在测试中有一种方式是用 H2 内存数据库代替测试环境数据库进行测试，但是 H2 数据库和我们实际使用的 MySQL 或 PostgreSQL 不同，所以它有些问题：</p><ol><li>SQL 语法不同，初始化测试环境需要使用 SQL 脚本，要将实际数据库的脚本转化为符合 H2 语法的 SQL 脚本</li><li>与实际数据库差异在断言的时候也可能导致一些奇奇怪怪的问题，浮点数精度不一致等等的</li><li>需要额外进行一些配置，方言 (Dialect) 等等的</li></ol><p>故不推荐这种方式，对这种方式感兴趣可以参考这篇文章：
<a href=https://1kevinson.com/how-to-write-integration-tests-with-h2-in-memory-database-and-springboot/>How to Write Integration Tests with H2 In-Memory Database and Springboot</a></p><p>代码可以可参考这个仓库，提供了集成测试以及不同层的测试：<a href=https://github.com/amigoscode/spring-boot-fullstack-professional/blob/13-testing/src/test/java/com/example/demo/integration/StudentIT.java>spring-boot-fullstack-professional</a></p><h3 id=使用实际数据库完成单元测试>使用实际数据库完成单元测试<a hidden class=anchor aria-hidden=true href=#使用实际数据库完成单元测试>#</a></h3><p>直接本地部署与线上相同类型的数据库，并创建好对应的库，指定所有测试都使用这个库，这样就可以解决 H2 兼容性的问题</p><p>这里以 <a href=https://github.com/yangzongzhuan/RuoYi-Vue-fast/tree/v3.8.6>若依 v3.8.6</a> 为例：</p><ol><li>本地部署 MySQL 并且新建一个测试专用的库：<code>ry_vue_test</code>，在代码中增加 <code>application-test.yml</code>：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>spring</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>datasource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># UTC+0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>jdbc:mysql://localhost:3306/ry_vue_test?useUnicode=true&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class=l>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=l>^PsL)H~</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>driver-class-name</span><span class=p>:</span><span class=w> </span><span class=l>com.mysql.cj.jdbc.Driver</span><span class=w>
</span></span></span></code></pre></div><ol start=2><li>增加 <code>MyBatis</code> 测试依赖</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.mybatis.spring.boot<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>mybatis-spring-boot-starter-test<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>2.2.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;scope&gt;</span>test<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=3><li>先写一个针对 <a href=https://github.com/yangzongzhuan/RuoYi-Vue-fast/blob/v3.8.6/src/main/java/com/ruoyi/project/system/mapper/SysUserMapper.java>com.ruoyi.project.system.mapper.SysUserMapper</a> 的数据层测试：</li></ol><p><strong>注意！不熟悉流程的情况下建议先注释测试数据库的地址，避免测试代码影响到测试库数据</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.ruoyi.project.system.mapper</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.ruoyi.framework.config.ApplicationConfig</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.ruoyi.project.system.domain.SysUser</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.junit.jupiter.api.Test</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.mybatis.spring.boot.test.autoconfigure.MybatisTest</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.beans.factory.annotation.Autowired</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.context.ActiveProfiles</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.context.ContextConfiguration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.context.jdbc.Sql</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.assertj.core.api.AssertionsForInterfaceTypes.assertThat</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.junit.jupiter.api.Assertions.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.springframework.test.context.jdbc.Sql.ExecutionPhase.BEFORE_TEST_METHOD</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 自动配置 MyBatis 相关的组件，并创建一个测试专用的数据库会话。这样可以在测试中使用 MyBatis 的功能</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@MybatisTest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 指定了测试上下文的配置类，这样可以加载应用程序的配置，并将其用于测试中的依赖注入</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@ContextConfiguration</span><span class=p>(</span><span class=n>classes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=n>ApplicationConfig</span><span class=p>.</span><span class=na>class</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 指定了要激活的配置文件，对应上面创建的 `application-test.yml`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@ActiveProfiles</span><span class=p>(</span><span class=s>&#34;test&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 禁用了自动配置替换测试数据库的功能，测试将使用真实的数据库进行操作，而不是使用内存数据库或其他替代数据库</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AutoConfigureTestDatabase</span><span class=p>(</span><span class=n>replace</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>AutoConfigureTestDatabase</span><span class=p>.</span><span class=na>Replace</span><span class=p>.</span><span class=na>NONE</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 在每个测试方法执行之前都运行该脚本：初始化每个测试用例的数据库初始数据</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Sql</span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;classpath:sql/sys_user.sql&#34;</span><span class=p>,</span><span class=w> </span><span class=n>executionPhase</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>BEFORE_TEST_METHOD</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>SysUserMapperTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>SysUserMapper</span><span class=w> </span><span class=n>userMapper</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>selectUserById</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>SysUser</span><span class=w> </span><span class=n>sysUser</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userMapper</span><span class=p>.</span><span class=na>selectUserById</span><span class=p>(</span><span class=n>1L</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>sysUser</span><span class=p>).</span><span class=na>isNotNull</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>sysUser</span><span class=p>.</span><span class=na>getUserName</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=s>&#34;admin&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 添加更多的断言</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>这里必须配置 <code>@ContextConfiguration(classes = {ApplicationConfig.class})</code>，因为 <a href=https://github.com/yangzongzhuan/RuoYi-Vue-fast/blob/v3.8.6/src/main/java/com/ruoyi/framework/config/ApplicationConfig.java>ApplicationConfig.class</a> 包含了 Mapper 的扫描配置：<code>@MapperScan("com.ruoyi.project.**.mapper")</code></p><p>复盘一下整个测试运行的流程：</p><ol><li>自动配置 MyBatis 相关的组件，创建一个测试专用的数据库会话</li><li>加载 ApplicationConfig 类作为测试上下文的配置</li><li>激活名为 &ldquo;test&rdquo; 的配置文件，将其用于测试中的依赖注入，这里包含 MySQL 的相关配置</li><li>禁用自动配置替换测试数据库的功能，使用真实的数据库进行操作，即上面 &ldquo;test&rdquo; 的 MySQL</li><li>在每个测试方法执行之前，运行位于类路径下的 &ldquo;sql/sys_user.sql&rdquo; SQL 脚本，完成用户数据的初始化</li><li>自动注入 SysUserMapper 对象，该对象是需要进行测试的 MyBatis 映射器</li><li>执行 <code>selectUserById(1L)</code>，查询数据并执行断言</li></ol><p>这个流程不仅可以测试数据层，还可以直接用于测试服务层。因为 <code>@MybatisTest</code> 不需要启动完整的应用程序上下文，使得整个测试非常快。具体可以参考：<a href=https://mybatis.org/spring-boot-starter/mybatis-spring-boot-test-autoconfigure/zh/index.html>MyBatis 测试文档</a></p><h3 id=使用实际数据库完成集成测试>使用实际数据库完成集成测试<a hidden class=anchor aria-hidden=true href=#使用实际数据库完成集成测试>#</a></h3><p>与上面 <code>@MybatisTest</code> 不同的是：集成测试使用 <code>@SpringBootTest</code>，这个注解会加载整个 Spring Boot 应用程序的上下文，并配置所有的组件，它会启动整个应用程序，并模拟实际的运行环境。所以需要保证 SpringBoot 的初始化配置，否则会应用会启动失败。待测接口为：<a href=https://github.com/yangzongzhuan/RuoYi-Vue-fast/blob/v3.8.6/src/main/java/com/ruoyi/project/system/controller/SysUserController.java>com.ruoyi.project.system.controller.SysUserController</a></p><ol><li>增加用于集成测试的 Spring 配置 <code>application-it.yml</code>，需要指定好测试的数据库，最好把可能影响测试环境的配置（Redis 等的）都修为集成测试专用的环境</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># 数据源配置</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spring</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>datasource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>com.alibaba.druid.pool.DruidDataSource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>driverClassName</span><span class=p>:</span><span class=w> </span><span class=l>com.mysql.cj.jdbc.Driver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>druid</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c># 主库数据源</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>master</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c># UTC+0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>jdbc:mysql://localhost:3306/ry_vue_test?useUnicode=true&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class=l>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=l>^PsL)H~</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c># 从库数据源</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>slave</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c># 从数据源开关/默认关闭</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>url</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>username</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>password</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c># 初始连接数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>initialSize</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c># 最小连接池数量</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>minIdle</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c># 最大连接池数量</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>maxActive</span><span class=p>:</span><span class=w> </span><span class=m>20</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c># 配置获取连接等待超时的时间</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>maxWait</span><span class=p>:</span><span class=w> </span><span class=m>60000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c># 配置连接超时时间</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>connectTimeout</span><span class=p>:</span><span class=w> </span><span class=m>30000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c># 配置网络超时时间</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>socketTimeout</span><span class=p>:</span><span class=w> </span><span class=m>60000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c># 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>timeBetweenEvictionRunsMillis</span><span class=p>:</span><span class=w> </span><span class=m>60000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c># 配置一个连接在池中最小生存的时间，单位是毫秒</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>minEvictableIdleTimeMillis</span><span class=p>:</span><span class=w> </span><span class=m>300000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c># 配置一个连接在池中最大生存的时间，单位是毫秒</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>maxEvictableIdleTimeMillis</span><span class=p>:</span><span class=w> </span><span class=m>900000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c># 配置检测连接是否有效</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>validationQuery</span><span class=p>:</span><span class=w> </span><span class=l>SELECT 1 FROM DUAL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>testWhileIdle</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>testOnBorrow</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>testOnReturn</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>webStatFilter</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>statViewServlet</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c># 设置白名单，不填则允许所有访问</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>allow</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>url-pattern</span><span class=p>:</span><span class=w> </span><span class=l>/druid/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c># 控制台管理用户名和密码</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>login-username</span><span class=p>:</span><span class=w> </span><span class=l>ruoyi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>login-password</span><span class=p>:</span><span class=w> </span><span class=m>123456</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>filter</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>stat</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c># 慢SQL记录</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>log-slow-sql</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>slow-sql-millis</span><span class=p>:</span><span class=w> </span><span class=m>1000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>merge-sql</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>wall</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=nt>multi-statement-allow</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># redis 配置</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>redis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 地址</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>localhost</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 端口，默认为6379</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>6379</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 数据库索引</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>database</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 密码</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>password</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 连接超时时间</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>lettuce</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>pool</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c># 连接池中的最小空闲连接</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>min-idle</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c># 连接池中的最大空闲连接</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>max-idle</span><span class=p>:</span><span class=w> </span><span class=m>8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c># 连接池的最大数据库连接数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>max-active</span><span class=p>:</span><span class=w> </span><span class=m>8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c># #连接池最大阻塞等待时间（使用负值表示没有限制）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>max-wait</span><span class=p>:</span><span class=w> </span>-<span class=l>1ms</span><span class=w>
</span></span></span></code></pre></div><ol start=2><li>创建应用初始化必须的库，否则启动容器会启动失败，提示表不存在：<code>; bad SQL grammar []; nested exception is java.sql.SQLSyntaxErrorException: Table 'ry_vue_test.sys_config' doesn't exist</code>，手动创建以下必须的表，确保应用正常启动</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>drop</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=k>exists</span><span class=w> </span><span class=n>sys_config</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>sys_config</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>config_id</span><span class=w>         </span><span class=nb>int</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span><span class=w>          </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w> </span><span class=n>auto_increment</span><span class=w>    </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;参数主键&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>config_name</span><span class=w>       </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;参数名称&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>config_key</span><span class=w>        </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;参数键名&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>config_value</span><span class=w>      </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;参数键值&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>config_type</span><span class=w>       </span><span class=nb>char</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w>         </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;N&#39;</span><span class=w>                </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;系统内置（Y是 N否）&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>create_by</span><span class=w>         </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>     </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;创建者&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>create_time</span><span class=w>       </span><span class=n>datetime</span><span class=w>                                   </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;创建时间&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>update_by</span><span class=w>         </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>     </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;更新者&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>update_time</span><span class=w>       </span><span class=n>datetime</span><span class=w>                                   </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;更新时间&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>remark</span><span class=w>            </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=k>null</span><span class=w>               </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;备注&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=p>(</span><span class=n>config_id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>engine</span><span class=o>=</span><span class=n>innodb</span><span class=w> </span><span class=n>auto_increment</span><span class=o>=</span><span class=mi>100</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;参数配置表&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>drop</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=k>exists</span><span class=w> </span><span class=n>sys_job</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>sys_job</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>job_id</span><span class=w>              </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>    </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w> </span><span class=n>auto_increment</span><span class=w>    </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;任务ID&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>job_name</span><span class=w>            </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>   </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;任务名称&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>job_group</span><span class=w>           </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>   </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;DEFAULT&#39;</span><span class=w>          </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;任务组名&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>invoke_target</span><span class=w>       </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span><span class=w>  </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w>                   </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;调用目标字符串&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>cron_expression</span><span class=w>     </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w>  </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;cron执行表达式&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>misfire_policy</span><span class=w>      </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>   </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>                </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;计划执行错误策略（1立即执行 2执行一次 3放弃执行）&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>concurrent</span><span class=w>          </span><span class=nb>char</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w>       </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=w>                </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;是否并发执行（0允许 1禁止）&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>status</span><span class=w>              </span><span class=nb>char</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w>       </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=w>                </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;状态（0正常 1暂停）&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>create_by</span><span class=w>           </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>   </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;创建者&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>create_time</span><span class=w>         </span><span class=n>datetime</span><span class=w>                                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;创建时间&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>update_by</span><span class=w>           </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>   </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;更新者&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>update_time</span><span class=w>         </span><span class=n>datetime</span><span class=w>                                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;更新时间&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>remark</span><span class=w>              </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span><span class=w>  </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;备注信息&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=p>(</span><span class=n>job_id</span><span class=p>,</span><span class=w> </span><span class=n>job_name</span><span class=p>,</span><span class=w> </span><span class=n>job_group</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>engine</span><span class=o>=</span><span class=n>innodb</span><span class=w> </span><span class=n>auto_increment</span><span class=o>=</span><span class=mi>100</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;定时任务调度表&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>drop</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=k>exists</span><span class=w> </span><span class=n>sys_dict_data</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>dict_code</span><span class=w>        </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>      </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w> </span><span class=n>auto_increment</span><span class=w>    </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;字典编码&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>dict_sort</span><span class=w>        </span><span class=nb>int</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span><span class=w>          </span><span class=k>default</span><span class=w> </span><span class=mi>0</span><span class=w>                  </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;字典排序&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>dict_label</span><span class=w>       </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;字典标签&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>dict_value</span><span class=w>       </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;字典键值&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>dict_type</span><span class=w>        </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;字典类型&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>css_class</span><span class=w>        </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=k>null</span><span class=w>               </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;样式属性（其他样式扩展）&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>list_class</span><span class=w>       </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=k>null</span><span class=w>               </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;表格回显样式&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>is_default</span><span class=w>       </span><span class=nb>char</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w>         </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;N&#39;</span><span class=w>                </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;是否默认（Y是 N否）&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>status</span><span class=w>           </span><span class=nb>char</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w>         </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=w>                </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;状态（0正常 1停用）&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>create_by</span><span class=w>        </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>     </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;创建者&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>create_time</span><span class=w>      </span><span class=n>datetime</span><span class=w>                                   </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;创建时间&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>update_by</span><span class=w>        </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>     </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;更新者&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>update_time</span><span class=w>      </span><span class=n>datetime</span><span class=w>                                   </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;更新时间&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>remark</span><span class=w>           </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=k>null</span><span class=w>               </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;备注&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=p>(</span><span class=n>dict_code</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>engine</span><span class=o>=</span><span class=n>innodb</span><span class=w> </span><span class=n>auto_increment</span><span class=o>=</span><span class=mi>100</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;字典数据表&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><ol start=3><li>为了保证集成环境数据的一致性，我们可以把数据的初始化都放在 <code>sys_user_it.sql</code> 中，每次运行测试前都先执行</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>drop</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=k>exists</span><span class=w> </span><span class=n>sys_config</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>sys_config</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>config_id</span><span class=w>         </span><span class=nb>int</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span><span class=w>          </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w> </span><span class=n>auto_increment</span><span class=w>    </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;参数主键&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>config_name</span><span class=w>       </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;参数名称&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>config_key</span><span class=w>        </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;参数键名&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>config_value</span><span class=w>      </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;参数键值&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>config_type</span><span class=w>       </span><span class=nb>char</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w>         </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;N&#39;</span><span class=w>                </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;系统内置（Y是 N否）&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>create_by</span><span class=w>         </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>     </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;创建者&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>create_time</span><span class=w>       </span><span class=n>datetime</span><span class=w>                                   </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;创建时间&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>update_by</span><span class=w>         </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>     </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;更新者&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>update_time</span><span class=w>       </span><span class=n>datetime</span><span class=w>                                   </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;更新时间&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>remark</span><span class=w>            </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=k>null</span><span class=w>               </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;备注&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=p>(</span><span class=n>config_id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>engine</span><span class=o>=</span><span class=n>innodb</span><span class=w> </span><span class=n>auto_increment</span><span class=o>=</span><span class=mi>100</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;参数配置表&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_config</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;主框架页-默认皮肤样式名称&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;sys.index.skinName&#39;</span><span class=p>,</span><span class=w>            </span><span class=s1>&#39;skin-blue&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;Y&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;蓝色 skin-blue、绿色 skin-green、紫色 skin-purple、红色 skin-red、黄色 skin-yellow&#39;</span><span class=w> </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_config</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;用户管理-账号初始密码&#39;</span><span class=p>,</span><span class=w>         </span><span class=s1>&#39;sys.user.initPassword&#39;</span><span class=p>,</span><span class=w>         </span><span class=s1>&#39;123456&#39;</span><span class=p>,</span><span class=w>        </span><span class=s1>&#39;Y&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;初始化密码 123456&#39;</span><span class=w> </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_config</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;主框架页-侧边栏主题&#39;</span><span class=p>,</span><span class=w>           </span><span class=s1>&#39;sys.index.sideTheme&#39;</span><span class=p>,</span><span class=w>           </span><span class=s1>&#39;theme-dark&#39;</span><span class=p>,</span><span class=w>    </span><span class=s1>&#39;Y&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;深色主题theme-dark，浅色主题theme-light&#39;</span><span class=w> </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_config</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;账号自助-验证码开关&#39;</span><span class=p>,</span><span class=w>           </span><span class=s1>&#39;sys.account.captchaEnabled&#39;</span><span class=p>,</span><span class=w>    </span><span class=s1>&#39;true&#39;</span><span class=p>,</span><span class=w>          </span><span class=s1>&#39;Y&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;是否开启验证码功能（true开启，false关闭）&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_config</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;账号自助-是否开启用户注册功能&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;sys.account.registerUser&#39;</span><span class=p>,</span><span class=w>      </span><span class=s1>&#39;false&#39;</span><span class=p>,</span><span class=w>         </span><span class=s1>&#39;Y&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;是否开启注册用户功能（true开启，false关闭）&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_config</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;用户登录-黑名单列表&#39;</span><span class=p>,</span><span class=w>           </span><span class=s1>&#39;sys.login.blackIPList&#39;</span><span class=p>,</span><span class=w>         </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>              </span><span class=s1>&#39;Y&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;设置登录IP黑名单限制，多个匹配项以;分隔，支持匹配（*通配、网段）&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>drop</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=k>exists</span><span class=w> </span><span class=n>sys_job</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>sys_job</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>job_id</span><span class=w>              </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>    </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w> </span><span class=n>auto_increment</span><span class=w>    </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;任务ID&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>job_name</span><span class=w>            </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>   </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;任务名称&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>job_group</span><span class=w>           </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>   </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;DEFAULT&#39;</span><span class=w>          </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;任务组名&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>invoke_target</span><span class=w>       </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span><span class=w>  </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w>                   </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;调用目标字符串&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>cron_expression</span><span class=w>     </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w>  </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;cron执行表达式&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>misfire_policy</span><span class=w>      </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>   </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>                </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;计划执行错误策略（1立即执行 2执行一次 3放弃执行）&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>concurrent</span><span class=w>          </span><span class=nb>char</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w>       </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=w>                </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;是否并发执行（0允许 1禁止）&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>status</span><span class=w>              </span><span class=nb>char</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w>       </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=w>                </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;状态（0正常 1暂停）&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>create_by</span><span class=w>           </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>   </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;创建者&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>create_time</span><span class=w>         </span><span class=n>datetime</span><span class=w>                                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;创建时间&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>update_by</span><span class=w>           </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>   </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;更新者&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>update_time</span><span class=w>         </span><span class=n>datetime</span><span class=w>                                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;更新时间&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=n>remark</span><span class=w>              </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span><span class=w>  </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;备注信息&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                         </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=p>(</span><span class=n>job_id</span><span class=p>,</span><span class=w> </span><span class=n>job_name</span><span class=p>,</span><span class=w> </span><span class=n>job_group</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>engine</span><span class=o>=</span><span class=n>innodb</span><span class=w> </span><span class=n>auto_increment</span><span class=o>=</span><span class=mi>100</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;定时任务调度表&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_job</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;系统默认（无参）&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;DEFAULT&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;ryTask.ryNoParams&#39;</span><span class=p>,</span><span class=w>        </span><span class=s1>&#39;0/10 * * * * ?&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_job</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;系统默认（有参）&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;DEFAULT&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;ryTask.ryParams(\&#39;</span><span class=n>ry</span><span class=err>\</span><span class=s1>&#39;)&#39;</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;0/15 * * * * ?&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_job</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;系统默认（多参）&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;DEFAULT&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;ryTask.ryMultipleParams(\&#39;</span><span class=n>ry</span><span class=err>\</span><span class=s1>&#39;, true, 2000L, 316.50D, 100)&#39;</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;0/20 * * * * ?&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>drop</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=k>exists</span><span class=w> </span><span class=n>sys_dict_data</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>dict_code</span><span class=w>        </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>      </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w> </span><span class=n>auto_increment</span><span class=w>    </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;字典编码&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>dict_sort</span><span class=w>        </span><span class=nb>int</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span><span class=w>          </span><span class=k>default</span><span class=w> </span><span class=mi>0</span><span class=w>                  </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;字典排序&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>dict_label</span><span class=w>       </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;字典标签&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>dict_value</span><span class=w>       </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;字典键值&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>dict_type</span><span class=w>        </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;字典类型&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>css_class</span><span class=w>        </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=k>null</span><span class=w>               </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;样式属性（其他样式扩展）&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>list_class</span><span class=w>       </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=k>null</span><span class=w>               </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;表格回显样式&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>is_default</span><span class=w>       </span><span class=nb>char</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w>         </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;N&#39;</span><span class=w>                </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;是否默认（Y是 N否）&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>status</span><span class=w>           </span><span class=nb>char</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w>         </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=w>                </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;状态（0正常 1停用）&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>create_by</span><span class=w>        </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>     </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;创建者&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>create_time</span><span class=w>      </span><span class=n>datetime</span><span class=w>                                   </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;创建时间&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>update_by</span><span class=w>        </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>     </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;更新者&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>update_time</span><span class=w>      </span><span class=n>datetime</span><span class=w>                                   </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;更新时间&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>remark</span><span class=w>           </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=k>null</span><span class=w>               </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;备注&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=p>(</span><span class=n>dict_code</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>engine</span><span class=o>=</span><span class=n>innodb</span><span class=w> </span><span class=n>auto_increment</span><span class=o>=</span><span class=mi>100</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;字典数据表&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w>  </span><span class=mi>1</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;男&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_user_sex&#39;</span><span class=p>,</span><span class=w>        </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>        </span><span class=s1>&#39;Y&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;性别男&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w>  </span><span class=mi>2</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;女&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_user_sex&#39;</span><span class=p>,</span><span class=w>        </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>        </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;性别女&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=w>  </span><span class=mi>3</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;未知&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;2&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_user_sex&#39;</span><span class=p>,</span><span class=w>        </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>        </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;性别未知&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=w>  </span><span class=mi>1</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;显示&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_show_hide&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;primary&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Y&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;显示菜单&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span><span class=w>  </span><span class=mi>2</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;隐藏&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_show_hide&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;danger&#39;</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;隐藏菜单&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span><span class=w>  </span><span class=mi>1</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;正常&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_normal_disable&#39;</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;primary&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Y&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;正常状态&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>7</span><span class=p>,</span><span class=w>  </span><span class=mi>2</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;停用&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_normal_disable&#39;</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;danger&#39;</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;停用状态&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=w>  </span><span class=mi>1</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;正常&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_job_status&#39;</span><span class=p>,</span><span class=w>      </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;primary&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Y&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;正常状态&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>9</span><span class=p>,</span><span class=w>  </span><span class=mi>2</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;暂停&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_job_status&#39;</span><span class=p>,</span><span class=w>      </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;danger&#39;</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;停用状态&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;默认&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;DEFAULT&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;sys_job_group&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>        </span><span class=s1>&#39;Y&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;默认分组&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>11</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;系统&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;SYSTEM&#39;</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;sys_job_group&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>        </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;系统分组&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;是&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;Y&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_yes_no&#39;</span><span class=p>,</span><span class=w>          </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;primary&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Y&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;系统默认是&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>13</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;否&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_yes_no&#39;</span><span class=p>,</span><span class=w>          </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;danger&#39;</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;系统默认否&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>14</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;通知&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_notice_type&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;warning&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Y&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;通知&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>15</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;公告&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;2&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_notice_type&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;success&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;公告&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>16</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;正常&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_notice_status&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;primary&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Y&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;正常状态&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>17</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;关闭&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_notice_status&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;danger&#39;</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;关闭状态&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>18</span><span class=p>,</span><span class=w> </span><span class=mi>99</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;其他&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_oper_type&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;info&#39;</span><span class=p>,</span><span class=w>    </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;其他操作&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>19</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;新增&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_oper_type&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;info&#39;</span><span class=p>,</span><span class=w>    </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;新增操作&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;修改&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;2&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_oper_type&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;info&#39;</span><span class=p>,</span><span class=w>    </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;修改操作&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>21</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;删除&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;3&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_oper_type&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;danger&#39;</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;删除操作&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>22</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;授权&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;4&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_oper_type&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;primary&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;授权操作&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>23</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;导出&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;5&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_oper_type&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;warning&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;导出操作&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>24</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;导入&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;6&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_oper_type&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;warning&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;导入操作&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>25</span><span class=p>,</span><span class=w> </span><span class=mi>7</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;强退&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;7&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_oper_type&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;danger&#39;</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;强退操作&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>26</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;生成代码&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;8&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_oper_type&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;warning&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;生成操作&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>27</span><span class=p>,</span><span class=w> </span><span class=mi>9</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;清空数据&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;9&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_oper_type&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;danger&#39;</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;清空操作&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>28</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;成功&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_common_status&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;primary&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;正常状态&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_dict_data</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>29</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;失败&#39;</span><span class=p>,</span><span class=w>     </span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w>       </span><span class=s1>&#39;sys_common_status&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>   </span><span class=s1>&#39;danger&#39;</span><span class=p>,</span><span class=w>  </span><span class=s1>&#39;N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;停用状态&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>drop</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=k>exists</span><span class=w> </span><span class=n>sys_post</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>sys_post</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>post_id</span><span class=w>       </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>      </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w> </span><span class=n>auto_increment</span><span class=w>    </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;岗位ID&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>post_code</span><span class=w>     </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>     </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w>                   </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;岗位编码&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>post_name</span><span class=w>     </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=w>     </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w>                   </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;岗位名称&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>post_sort</span><span class=w>     </span><span class=nb>int</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span><span class=w>          </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w>                   </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;显示顺序&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>status</span><span class=w>        </span><span class=nb>char</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w>         </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w>                   </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;状态（0正常 1停用）&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>create_by</span><span class=w>     </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>     </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>                 </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;创建者&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>create_time</span><span class=w>   </span><span class=n>datetime</span><span class=w>                                   </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;创建时间&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>update_by</span><span class=w>     </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>     </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>			       </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;更新者&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>update_time</span><span class=w>   </span><span class=n>datetime</span><span class=w>                                   </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;更新时间&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>remark</span><span class=w>        </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span><span class=w>    </span><span class=k>default</span><span class=w> </span><span class=k>null</span><span class=w>               </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;备注&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=p>(</span><span class=n>post_id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>engine</span><span class=o>=</span><span class=n>innodb</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;岗位信息表&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>drop</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=k>exists</span><span class=w> </span><span class=n>sys_user_post</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>sys_user_post</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>user_id</span><span class=w>   </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;用户ID&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>post_id</span><span class=w>   </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;岗位ID&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span><span class=w> </span><span class=n>post_id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>engine</span><span class=o>=</span><span class=n>innodb</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;用户与岗位关联表&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>添加 <code>sys_user.sql</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>drop</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=k>exists</span><span class=w> </span><span class=n>sys_user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>sys_user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>user_id</span><span class=w>     </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w> </span><span class=n>auto_increment</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;用户ID&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>dept_id</span><span class=w>     </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=k>null</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;部门ID&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>user_name</span><span class=w>   </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;用户账号&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>nick_name</span><span class=w>   </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;用户昵称&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>user_type</span><span class=w>   </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span><span class=w>   </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;00&#39;</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;用户类型（00系统用户）&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>email</span><span class=w>       </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=w>  </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;用户邮箱&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>phonenumber</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span><span class=w>  </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;手机号码&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>sex</span><span class=w>         </span><span class=nb>char</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w>      </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;用户性别（0男 1女 2未知）&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>avatar</span><span class=w>      </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;头像地址&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>password</span><span class=w>    </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;密码&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>status</span><span class=w>      </span><span class=nb>char</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w>      </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;帐号状态（0正常 1停用）&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>del_flag</span><span class=w>    </span><span class=nb>char</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w>      </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;删除标志（0代表存在 2代表删除）&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>login_ip</span><span class=w>    </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>128</span><span class=p>)</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;最后登录IP&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>login_date</span><span class=w>  </span><span class=n>datetime</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;最后登录时间&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>create_by</span><span class=w>   </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>  </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;创建者&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>create_time</span><span class=w> </span><span class=n>datetime</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;创建时间&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>update_by</span><span class=w>   </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w>  </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;更新者&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>update_time</span><span class=w> </span><span class=n>datetime</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;更新时间&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>remark</span><span class=w>      </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=k>null</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=s1>&#39;备注&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>engine</span><span class=o>=</span><span class=n>innodb</span><span class=w> </span><span class=n>auto_increment</span><span class=o>=</span><span class=mi>100</span><span class=w> </span><span class=k>comment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;用户信息表&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>values</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>103</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;若依&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;00&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;ry@163.com&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;15888888888&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s1>&#39;$2a$10$7JB720yubVSZvUI0rEqK/.VqGOZTH.ulu33dHOiBE8ByOhJIrdAu2&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;127.0.0.1&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;管理员&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>sys_user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>values</span><span class=w> </span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>105</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;ry&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;若依&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;00&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;ry@qq.com&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;15666666666&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s1>&#39;$2a$10$7JB720yubVSZvUI0rEqK/.VqGOZTH.ulu33dHOiBE8ByOhJIrdAu2&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;127.0.0.1&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>sysdate</span><span class=p>(),</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;测试员&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><ol start=4><li>增加测试代码：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.ruoyi.project.system.controller</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.junit.jupiter.api.Test</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.junit.jupiter.api.extension.ExtendWith</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.beans.factory.annotation.Autowired</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.boot.test.context.SpringBootTest</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.MediaType</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.context.ActiveProfiles</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.context.jdbc.Sql</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.context.jdbc.SqlGroup</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.context.junit.jupiter.SpringExtension</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.web.servlet.MockMvc</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.web.servlet.request.MockMvcRequestBuilders</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.web.servlet.result.MockMvcResultMatchers</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.springframework.test.context.jdbc.Sql.ExecutionPhase.BEFORE_TEST_METHOD</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AutoConfigureMockMvc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@SpringBootTest</span><span class=p>(</span><span class=n>webEnvironment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SpringBootTest</span><span class=p>.</span><span class=na>WebEnvironment</span><span class=p>.</span><span class=na>RANDOM_PORT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 指定了要激活的配置文件，对应上面创建的 `application-it.yml`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@ActiveProfiles</span><span class=p>(</span><span class=s>&#34;it&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@SqlGroup</span><span class=p>({</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Sql</span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;classpath:sql/sys_user_it.sql&#34;</span><span class=p>,</span><span class=w> </span><span class=n>executionPhase</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>BEFORE_TEST_METHOD</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Sql</span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;classpath:sql/sys_user.sql&#34;</span><span class=p>,</span><span class=w> </span><span class=n>executionPhase</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>BEFORE_TEST_METHOD</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>SysUserControllerTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>MockMvc</span><span class=w> </span><span class=n>mockMvc</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>getInfo</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>MockMvcRequestBuilders</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;/system/user/1&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=c1>// 设置请求头</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>accept</span><span class=p>(</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 验证响应状态码</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>MockMvcResultMatchers</span><span class=p>.</span><span class=na>status</span><span class=p>().</span><span class=na>isOk</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 验证响应内容</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>MockMvcResultMatchers</span><span class=p>.</span><span class=na>content</span><span class=p>().</span><span class=na>string</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>运行测试，测试将失败，后端返回：<code>{"msg":"请求访问：/system/user/1，认证失败，无法访问系统资源","code":401}</code>，权限校验还需要处理</p><ol start=5><li>引入 SpdringSecurityTest 依赖</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>org.springframework.security<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>spring-security-test<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>6.1.2<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;scope&gt;</span>test<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=6><li>在测试代码中 Mock 用户，因为若依使用的自定义的 <code>UserDetails</code>，所以必须手动设置 <code>UserDetails</code>：<code>.with(user(new LoginUser(new SysUser(1L), new HashSet&lt;>(Arrays.asList("system:user:query")))))</code>，不能直接用注解 Mock，更多写法可以参考：<a href=https://docs.spring.io/spring-security/reference/servlet/test/mockmvc/authentication.html>Running a Test as a User in Spring MVC Test</a></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.ruoyi.project.system.controller</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.ruoyi.framework.security.LoginUser</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.ruoyi.project.system.domain.SysUser</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.junit.jupiter.api.Test</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.beans.factory.annotation.Autowired</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.boot.test.context.SpringBootTest</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.MediaType</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.context.ActiveProfiles</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.context.jdbc.Sql</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.context.jdbc.SqlGroup</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.web.servlet.MockMvc</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.web.servlet.request.MockMvcRequestBuilders</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.web.servlet.result.MockMvcResultMatchers</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.context.WebApplicationContext</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Arrays</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.HashSet</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.springframework.security.test.web.servlet.request.SecurityMockMvcRequestPostProcessors.user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.springframework.test.context.jdbc.Sql.ExecutionPhase.BEFORE_TEST_METHOD</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AutoConfigureMockMvc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@SpringBootTest</span><span class=p>(</span><span class=n>webEnvironment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SpringBootTest</span><span class=p>.</span><span class=na>WebEnvironment</span><span class=p>.</span><span class=na>RANDOM_PORT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 指定了要激活的配置文件，对应上面创建的 `application-it.yml`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@ActiveProfiles</span><span class=p>(</span><span class=s>&#34;it&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@SqlGroup</span><span class=p>({</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Sql</span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;classpath:sql/sys_user_it.sql&#34;</span><span class=p>,</span><span class=w> </span><span class=n>executionPhase</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>BEFORE_TEST_METHOD</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Sql</span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;classpath:sql/sys_user.sql&#34;</span><span class=p>,</span><span class=w> </span><span class=n>executionPhase</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>BEFORE_TEST_METHOD</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>SysUserControllerTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>WebApplicationContext</span><span class=w> </span><span class=n>context</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>MockMvc</span><span class=w> </span><span class=n>mockMvc</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>getInfo</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>MockMvcRequestBuilders</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;/system/user/1&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>with</span><span class=p>(</span><span class=n>user</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>LoginUser</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>SysUser</span><span class=p>(</span><span class=n>1L</span><span class=p>),</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashSet</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>Arrays</span><span class=p>.</span><span class=na>asList</span><span class=p>(</span><span class=s>&#34;system:user:query&#34;</span><span class=p>)))))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=c1>// 设置请求头</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>accept</span><span class=p>(</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 验证响应状态码</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>MockMvcResultMatchers</span><span class=p>.</span><span class=na>status</span><span class=p>().</span><span class=na>isOk</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 验证响应内容</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>MockMvcResultMatchers</span><span class=p>.</span><span class=na>jsonPath</span><span class=p>(</span><span class=s>&#34;$.msg&#34;</span><span class=p>).</span><span class=na>value</span><span class=p>(</span><span class=s>&#34;操作成功&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>MockMvcResultMatchers</span><span class=p>.</span><span class=na>jsonPath</span><span class=p>(</span><span class=s>&#34;$.code&#34;</span><span class=p>).</span><span class=na>value</span><span class=p>(</span><span class=n>200</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>MockMvcResultMatchers</span><span class=p>.</span><span class=na>jsonPath</span><span class=p>(</span><span class=s>&#34;$.data.userName&#34;</span><span class=p>).</span><span class=na>value</span><span class=p>(</span><span class=s>&#34;admin&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>MockMvcResultMatchers</span><span class=p>.</span><span class=na>jsonPath</span><span class=p>(</span><span class=s>&#34;$.data.roles[0].roleName&#34;</span><span class=p>).</span><span class=na>value</span><span class=p>(</span><span class=s>&#34;超级管理员&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 添加更多的断言</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><hr><p>上一节：<a href=https://www.cnblogs.com/aaronlinv/p/17645009.html>SpringBoot 测试实践 - 1：常用的工具</a>
下一节：<a href=https://www.cnblogs.com/aaronlinv/p/17652720.html>SpringBoot 测试实践 - 3：@MockBean、@SpyBean 、提升测试运行速度、Testcontainer</a></p><hr><h2 id=参考资料>参考资料<a hidden class=anchor aria-hidden=true href=#参考资料>#</a></h2><p><a href=https://mybatis.org/spring-boot-starter/mybatis-spring-boot-test-autoconfigure/zh/index.html>MyBatis 测试</a>
<a href=https://blog.csdn.net/u012397189/article/details/109288747>Spring boot Mybatis-Plus数据库单测实战（三种方式）</a>
<a href=https://1byte.io/google-large-scale-dev/>如何高效地协作开发：一些 Google 的实践</a>
<a href=https://www.bilibili.com/video/BV1YU4y1a73N/>Java Web 项目单元测试/集成测试</a>
<a href=https://stackoverflow.com/questions/68840412/springboottest-not-working-execution-throwing-nullpointerexception/68840522#68840522>@SpringBootTest not working (execution throwing NullPointerException)</a>
<a href=https://www.bilibili.com/video/BV11W4y1y72D>直播回放 | 7月21日「JetBrains码上道」| 主题：Java中的测试与重构</a>
<a href=https://www.bilibili.com/video/BV18g411g72M/>代码很烂，但它能用，你敢重构吗？</a>
<a href=https://www.bilibili.com/video/BV1734y1v7UE/>单元测试为什么在互联网滑铁卢</a>
<a href=https://www.v2ex.com/t/821608>单元测试有必要吗？</a>
<a href=https://spring.io/guides/gs/testing-web/>Testing the Web Layer</a>
<a href="https://www.youtube.com/watch?v=Geq60OVyBPg">Software Testing Tutorial - Learn Unit Testing and Integration Testing</a>
<a href=https://github.com/eleftherias/springone-2021>Test-Driven Security</a></p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://aaronlinv.github.io/posts/springboot-%E6%B5%8B%E8%AF%95%E5%AE%9E%E8%B7%B5---3@mockbean@spybean-%E6%8F%90%E5%8D%87%E6%B5%8B%E8%AF%95%E8%BF%90%E8%A1%8C%E9%80%9F%E5%BA%A6testcontainer/><span class=title>« Prev</span><br><span>SpringBoot 测试实践 - 3：@MockBean、@SpyBean 、提升测试运行速度、Testcontainer</span>
</a><a class=next href=https://aaronlinv.github.io/posts/springboot-%E6%B5%8B%E8%AF%95%E5%AE%9E%E8%B7%B5---1%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7/><span class=title>Next »</span><br><span>SpringBoot 测试实践 - 1：常用的工具</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://aaronlinv.github.io/>Aaron Lin</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>