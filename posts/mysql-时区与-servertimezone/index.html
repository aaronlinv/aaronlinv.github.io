<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>MySQL 时区与 serverTimezone | Aaron Lin</title>
<meta name=keywords content><meta name=description content="TL;DR

手动为 MySQL 指定非偏移量的时区，以避免 TIMESTAMP 类型夏令时问题和时区转化性能瓶颈
TIMESTAMP 范围：&lsquo;1970-01-01 00:00:01&rsquo; UTC to &lsquo;2038-01-19 03:14:07&rsquo;
连接 MySQL 数据库时，serverTimezone 参数用于指定数据库服务器的时区，需要设置为与 MySQL 服务端相同的时区

MySQL 时区设置影响 TIMESTAMP 类型数据和部分时间函数
MySQL 会话时区设置会影响 TIMESTAMP 和 时间函数（NOW()、CURDATE()、CURTIME()、CURRENT_TIMESTAMP()）
存储 TIMESTAMP 类型数据时，MySQL 会根据当前会话的时区将时间转换为 UTC 时间，MySQL 实际存储的是 UTC 时间。检索时 MySQL 根据会话的时区将存储的 UTC 时间转换为会话对应时区的时间。而 DATETIME 类型的字段存储的时间值是原始值，不受时区影响
MySQL 默认使用 SYSTEM 时区（即操作系统的时区），每个需要时区计算的 MySQL 函数调用都会调用系统库来确定当前系统时区。此调用可能受到全局互斥体的保护，从而导致争用，建议显式设置时区
查询当前时区
# time_zone：MySQL 使用 SYSTEM 的时区
# system_time_zone：SYSTEM 为 CST 时区
show variables like &#34;%time_zone%&#34;;
+------------------+--------+
| Variable_name    | Value  |
+------------------+--------+
| system_time_zone | CST    |
| time_zone        | SYSTEM |
+------------------+--------+
不同会话时区对 时间函数 的影响
# 当前时区 
# 查看当前的全球和会话时区值
SELECT @@GLOBAL.time_zone, @@SESSION.time_zone;

SELECT NOW(), CURDATE(), CURTIME(), CURRENT_TIMESTAMP();

set time_zone = 'America/New_York';

SELECT NOW(), CURDATE(), CURTIME(), CURRENT_TIMESTAMP();
不同会话时区对 TIMESTAMP 类型的影响
# UTC +8
set time_zone = 'Asia/Shanghai';

CREATE TABLE events (
    id INT AUTO_INCREMENT PRIMARY KEY,
    event_name VARCHAR(255) NOT NULL,
    event_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    event_datetime DATETIME DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO events (event_name, event_timestamp, event_datetime) VALUES ('10.24 15:45:00', '2022-10-24 15:45:00', '2022-10-24 15:45:00');

INSERT INTO events (event_name, event_timestamp, event_datetime) VALUES ('12.24 15:45:00', '2022-12-24 15:45:00', '2022-12-24 15:45:00');
SELECT * FROM events;

+----+----------------+---------------------+---------------------+
| id | event_name     | event_timestamp     | event_datetime      |
+----+----------------+---------------------+---------------------+
|  1 | 10.24 15:45:00 | 2022-10-24 15:45:00 | 2022-10-24 15:45:00 |
|  2 | 12.24 15:45:00 | 2022-12-24 15:45:00 | 2022-12-24 15:45:00 |
+----+----------------+---------------------+---------------------+
2 rows in set (0.00 sec)
# 仅修改当前会话的时区
set time_zone = 'America/New_York';
SELECT * FROM events;

+----+----------------+---------------------+---------------------+
| id | event_name     | event_timestamp     | event_datetime      |
+----+----------------+---------------------+---------------------+
|  1 | 10.24 15:45:00 | 2022-10-24 03:45:00 | 2022-10-24 15:45:00 |    <- 夏令时，相差 12 小时
|  2 | 12.24 15:45:00 | 2022-12-24 02:45:00 | 2022-12-24 15:45:00 |    <- 平时相差 13 小时
+----+----------------+---------------------+---------------------+
2 rows in set (0.00 sec)
纽约 UTC 时差通常为 UTC-5（EST），夏令时为 UTC-4（EDT），所以将原本的会话从上海(UTC+8) 转到纽约时，TIMESTAMP 相差了 13 或 12(夏令时) 小时，所以为了自动转换夏令时，指定时区最好使用时区名词 Asia/Shanghai，避免使用偏移量：'+08:00'"><meta name=author content><link rel=canonical href=https://aaronlinv.github.io/posts/mysql-%E6%97%B6%E5%8C%BA%E4%B8%8E-servertimezone/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=https://aaronlinv.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://aaronlinv.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://aaronlinv.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://aaronlinv.github.io/apple-touch-icon.png><link rel=mask-icon href=https://aaronlinv.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://aaronlinv.github.io/posts/mysql-%E6%97%B6%E5%8C%BA%E4%B8%8E-servertimezone/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://aaronlinv.github.io/posts/mysql-%E6%97%B6%E5%8C%BA%E4%B8%8E-servertimezone/"><meta property="og:site_name" content="Aaron Lin"><meta property="og:title" content="MySQL 时区与 serverTimezone"><meta property="og:description" content="TL;DR 手动为 MySQL 指定非偏移量的时区，以避免 TIMESTAMP 类型夏令时问题和时区转化性能瓶颈 TIMESTAMP 范围：‘1970-01-01 00:00:01’ UTC to ‘2038-01-19 03:14:07’ 连接 MySQL 数据库时，serverTimezone 参数用于指定数据库服务器的时区，需要设置为与 MySQL 服务端相同的时区 MySQL 时区设置影响 TIMESTAMP 类型数据和部分时间函数 MySQL 会话时区设置会影响 TIMESTAMP 和 时间函数（NOW()、CURDATE()、CURTIME()、CURRENT_TIMESTAMP()）
存储 TIMESTAMP 类型数据时，MySQL 会根据当前会话的时区将时间转换为 UTC 时间，MySQL 实际存储的是 UTC 时间。检索时 MySQL 根据会话的时区将存储的 UTC 时间转换为会话对应时区的时间。而 DATETIME 类型的字段存储的时间值是原始值，不受时区影响
MySQL 默认使用 SYSTEM 时区（即操作系统的时区），每个需要时区计算的 MySQL 函数调用都会调用系统库来确定当前系统时区。此调用可能受到全局互斥体的保护，从而导致争用，建议显式设置时区
查询当前时区 # time_zone：MySQL 使用 SYSTEM 的时区 # system_time_zone：SYSTEM 为 CST 时区 show variables like &#34;%time_zone%&#34;; +------------------+--------+ | Variable_name | Value | +------------------+--------+ | system_time_zone | CST | | time_zone | SYSTEM | +------------------+--------+ 不同会话时区对 时间函数 的影响 # 当前时区 # 查看当前的全球和会话时区值 SELECT @@GLOBAL.time_zone, @@SESSION.time_zone; SELECT NOW(), CURDATE(), CURTIME(), CURRENT_TIMESTAMP(); set time_zone = 'America/New_York'; SELECT NOW(), CURDATE(), CURTIME(), CURRENT_TIMESTAMP(); 不同会话时区对 TIMESTAMP 类型的影响 # UTC +8 set time_zone = 'Asia/Shanghai'; CREATE TABLE events ( id INT AUTO_INCREMENT PRIMARY KEY, event_name VARCHAR(255) NOT NULL, event_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP, event_datetime DATETIME DEFAULT CURRENT_TIMESTAMP ); INSERT INTO events (event_name, event_timestamp, event_datetime) VALUES ('10.24 15:45:00', '2022-10-24 15:45:00', '2022-10-24 15:45:00'); INSERT INTO events (event_name, event_timestamp, event_datetime) VALUES ('12.24 15:45:00', '2022-12-24 15:45:00', '2022-12-24 15:45:00'); SELECT * FROM events; +----+----------------+---------------------+---------------------+ | id | event_name | event_timestamp | event_datetime | +----+----------------+---------------------+---------------------+ | 1 | 10.24 15:45:00 | 2022-10-24 15:45:00 | 2022-10-24 15:45:00 | | 2 | 12.24 15:45:00 | 2022-12-24 15:45:00 | 2022-12-24 15:45:00 | +----+----------------+---------------------+---------------------+ 2 rows in set (0.00 sec) # 仅修改当前会话的时区 set time_zone = 'America/New_York'; SELECT * FROM events; +----+----------------+---------------------+---------------------+ | id | event_name | event_timestamp | event_datetime | +----+----------------+---------------------+---------------------+ | 1 | 10.24 15:45:00 | 2022-10-24 03:45:00 | 2022-10-24 15:45:00 | <- 夏令时，相差 12 小时 | 2 | 12.24 15:45:00 | 2022-12-24 02:45:00 | 2022-12-24 15:45:00 | <- 平时相差 13 小时 +----+----------------+---------------------+---------------------+ 2 rows in set (0.00 sec) 纽约 UTC 时差通常为 UTC-5（EST），夏令时为 UTC-4（EDT），所以将原本的会话从上海(UTC+8) 转到纽约时，TIMESTAMP 相差了 13 或 12(夏令时) 小时，所以为了自动转换夏令时，指定时区最好使用时区名词 Asia/Shanghai，避免使用偏移量：'+08:00'"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-19T08:40:33+08:00"><meta property="article:modified_time" content="2024-12-19T08:40:33+08:00"><meta property="og:image" content="https://aaronlinv.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://aaronlinv.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="MySQL 时区与 serverTimezone"><meta name=twitter:description content="TL;DR

手动为 MySQL 指定非偏移量的时区，以避免 TIMESTAMP 类型夏令时问题和时区转化性能瓶颈
TIMESTAMP 范围：&lsquo;1970-01-01 00:00:01&rsquo; UTC to &lsquo;2038-01-19 03:14:07&rsquo;
连接 MySQL 数据库时，serverTimezone 参数用于指定数据库服务器的时区，需要设置为与 MySQL 服务端相同的时区

MySQL 时区设置影响 TIMESTAMP 类型数据和部分时间函数
MySQL 会话时区设置会影响 TIMESTAMP 和 时间函数（NOW()、CURDATE()、CURTIME()、CURRENT_TIMESTAMP()）
存储 TIMESTAMP 类型数据时，MySQL 会根据当前会话的时区将时间转换为 UTC 时间，MySQL 实际存储的是 UTC 时间。检索时 MySQL 根据会话的时区将存储的 UTC 时间转换为会话对应时区的时间。而 DATETIME 类型的字段存储的时间值是原始值，不受时区影响
MySQL 默认使用 SYSTEM 时区（即操作系统的时区），每个需要时区计算的 MySQL 函数调用都会调用系统库来确定当前系统时区。此调用可能受到全局互斥体的保护，从而导致争用，建议显式设置时区
查询当前时区
# time_zone：MySQL 使用 SYSTEM 的时区
# system_time_zone：SYSTEM 为 CST 时区
show variables like &#34;%time_zone%&#34;;
+------------------+--------+
| Variable_name    | Value  |
+------------------+--------+
| system_time_zone | CST    |
| time_zone        | SYSTEM |
+------------------+--------+
不同会话时区对 时间函数 的影响
# 当前时区 
# 查看当前的全球和会话时区值
SELECT @@GLOBAL.time_zone, @@SESSION.time_zone;

SELECT NOW(), CURDATE(), CURTIME(), CURRENT_TIMESTAMP();

set time_zone = 'America/New_York';

SELECT NOW(), CURDATE(), CURTIME(), CURRENT_TIMESTAMP();
不同会话时区对 TIMESTAMP 类型的影响
# UTC +8
set time_zone = 'Asia/Shanghai';

CREATE TABLE events (
    id INT AUTO_INCREMENT PRIMARY KEY,
    event_name VARCHAR(255) NOT NULL,
    event_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    event_datetime DATETIME DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO events (event_name, event_timestamp, event_datetime) VALUES ('10.24 15:45:00', '2022-10-24 15:45:00', '2022-10-24 15:45:00');

INSERT INTO events (event_name, event_timestamp, event_datetime) VALUES ('12.24 15:45:00', '2022-12-24 15:45:00', '2022-12-24 15:45:00');
SELECT * FROM events;

+----+----------------+---------------------+---------------------+
| id | event_name     | event_timestamp     | event_datetime      |
+----+----------------+---------------------+---------------------+
|  1 | 10.24 15:45:00 | 2022-10-24 15:45:00 | 2022-10-24 15:45:00 |
|  2 | 12.24 15:45:00 | 2022-12-24 15:45:00 | 2022-12-24 15:45:00 |
+----+----------------+---------------------+---------------------+
2 rows in set (0.00 sec)
# 仅修改当前会话的时区
set time_zone = 'America/New_York';
SELECT * FROM events;

+----+----------------+---------------------+---------------------+
| id | event_name     | event_timestamp     | event_datetime      |
+----+----------------+---------------------+---------------------+
|  1 | 10.24 15:45:00 | 2022-10-24 03:45:00 | 2022-10-24 15:45:00 |    <- 夏令时，相差 12 小时
|  2 | 12.24 15:45:00 | 2022-12-24 02:45:00 | 2022-12-24 15:45:00 |    <- 平时相差 13 小时
+----+----------------+---------------------+---------------------+
2 rows in set (0.00 sec)
纽约 UTC 时差通常为 UTC-5（EST），夏令时为 UTC-4（EDT），所以将原本的会话从上海(UTC+8) 转到纽约时，TIMESTAMP 相差了 13 或 12(夏令时) 小时，所以为了自动转换夏令时，指定时区最好使用时区名词 Asia/Shanghai，避免使用偏移量：'+08:00'"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://aaronlinv.github.io/posts/"},{"@type":"ListItem","position":2,"name":"MySQL 时区与 serverTimezone","item":"https://aaronlinv.github.io/posts/mysql-%E6%97%B6%E5%8C%BA%E4%B8%8E-servertimezone/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"MySQL 时区与 serverTimezone","name":"MySQL 时区与 serverTimezone","description":"TL;DR 手动为 MySQL 指定非偏移量的时区，以避免 TIMESTAMP 类型夏令时问题和时区转化性能瓶颈 TIMESTAMP 范围：\u0026lsquo;1970-01-01 00:00:01\u0026rsquo; UTC to \u0026lsquo;2038-01-19 03:14:07\u0026rsquo; 连接 MySQL 数据库时，serverTimezone 参数用于指定数据库服务器的时区，需要设置为与 MySQL 服务端相同的时区 MySQL 时区设置影响 TIMESTAMP 类型数据和部分时间函数 MySQL 会话时区设置会影响 TIMESTAMP 和 时间函数（NOW()、CURDATE()、CURTIME()、CURRENT_TIMESTAMP()）\n存储 TIMESTAMP 类型数据时，MySQL 会根据当前会话的时区将时间转换为 UTC 时间，MySQL 实际存储的是 UTC 时间。检索时 MySQL 根据会话的时区将存储的 UTC 时间转换为会话对应时区的时间。而 DATETIME 类型的字段存储的时间值是原始值，不受时区影响\nMySQL 默认使用 SYSTEM 时区（即操作系统的时区），每个需要时区计算的 MySQL 函数调用都会调用系统库来确定当前系统时区。此调用可能受到全局互斥体的保护，从而导致争用，建议显式设置时区\n查询当前时区 # time_zone：MySQL 使用 SYSTEM 的时区 # system_time_zone：SYSTEM 为 CST 时区 show variables like \u0026#34;%time_zone%\u0026#34;; +------------------+--------+ | Variable_name | Value | +------------------+--------+ | system_time_zone | CST | | time_zone | SYSTEM | +------------------+--------+ 不同会话时区对 时间函数 的影响 # 当前时区 # 查看当前的全球和会话时区值 SELECT @@GLOBAL.time_zone, @@SESSION.time_zone; SELECT NOW(), CURDATE(), CURTIME(), CURRENT_TIMESTAMP(); set time_zone = \u0026#39;America/New_York\u0026#39;; SELECT NOW(), CURDATE(), CURTIME(), CURRENT_TIMESTAMP(); 不同会话时区对 TIMESTAMP 类型的影响 # UTC +8 set time_zone = \u0026#39;Asia/Shanghai\u0026#39;; CREATE TABLE events ( id INT AUTO_INCREMENT PRIMARY KEY, event_name VARCHAR(255) NOT NULL, event_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP, event_datetime DATETIME DEFAULT CURRENT_TIMESTAMP ); INSERT INTO events (event_name, event_timestamp, event_datetime) VALUES (\u0026#39;10.24 15:45:00\u0026#39;, \u0026#39;2022-10-24 15:45:00\u0026#39;, \u0026#39;2022-10-24 15:45:00\u0026#39;); INSERT INTO events (event_name, event_timestamp, event_datetime) VALUES (\u0026#39;12.24 15:45:00\u0026#39;, \u0026#39;2022-12-24 15:45:00\u0026#39;, \u0026#39;2022-12-24 15:45:00\u0026#39;); SELECT * FROM events; +----+----------------+---------------------+---------------------+ | id | event_name | event_timestamp | event_datetime | +----+----------------+---------------------+---------------------+ | 1 | 10.24 15:45:00 | 2022-10-24 15:45:00 | 2022-10-24 15:45:00 | | 2 | 12.24 15:45:00 | 2022-12-24 15:45:00 | 2022-12-24 15:45:00 | +----+----------------+---------------------+---------------------+ 2 rows in set (0.00 sec) # 仅修改当前会话的时区 set time_zone = \u0026#39;America/New_York\u0026#39;; SELECT * FROM events; +----+----------------+---------------------+---------------------+ | id | event_name | event_timestamp | event_datetime | +----+----------------+---------------------+---------------------+ | 1 | 10.24 15:45:00 | 2022-10-24 03:45:00 | 2022-10-24 15:45:00 | \u0026lt;- 夏令时，相差 12 小时 | 2 | 12.24 15:45:00 | 2022-12-24 02:45:00 | 2022-12-24 15:45:00 | \u0026lt;- 平时相差 13 小时 +----+----------------+---------------------+---------------------+ 2 rows in set (0.00 sec) 纽约 UTC 时差通常为 UTC-5（EST），夏令时为 UTC-4（EDT），所以将原本的会话从上海(UTC+8) 转到纽约时，TIMESTAMP 相差了 13 或 12(夏令时) 小时，所以为了自动转换夏令时，指定时区最好使用时区名词 Asia/Shanghai，避免使用偏移量：'+08:00'\n","keywords":[],"articleBody":"TL;DR 手动为 MySQL 指定非偏移量的时区，以避免 TIMESTAMP 类型夏令时问题和时区转化性能瓶颈 TIMESTAMP 范围：‘1970-01-01 00:00:01’ UTC to ‘2038-01-19 03:14:07’ 连接 MySQL 数据库时，serverTimezone 参数用于指定数据库服务器的时区，需要设置为与 MySQL 服务端相同的时区 MySQL 时区设置影响 TIMESTAMP 类型数据和部分时间函数 MySQL 会话时区设置会影响 TIMESTAMP 和 时间函数（NOW()、CURDATE()、CURTIME()、CURRENT_TIMESTAMP()）\n存储 TIMESTAMP 类型数据时，MySQL 会根据当前会话的时区将时间转换为 UTC 时间，MySQL 实际存储的是 UTC 时间。检索时 MySQL 根据会话的时区将存储的 UTC 时间转换为会话对应时区的时间。而 DATETIME 类型的字段存储的时间值是原始值，不受时区影响\nMySQL 默认使用 SYSTEM 时区（即操作系统的时区），每个需要时区计算的 MySQL 函数调用都会调用系统库来确定当前系统时区。此调用可能受到全局互斥体的保护，从而导致争用，建议显式设置时区\n查询当前时区 # time_zone：MySQL 使用 SYSTEM 的时区 # system_time_zone：SYSTEM 为 CST 时区 show variables like \"%time_zone%\"; +------------------+--------+ | Variable_name | Value | +------------------+--------+ | system_time_zone | CST | | time_zone | SYSTEM | +------------------+--------+ 不同会话时区对 时间函数 的影响 # 当前时区 # 查看当前的全球和会话时区值 SELECT @@GLOBAL.time_zone, @@SESSION.time_zone; SELECT NOW(), CURDATE(), CURTIME(), CURRENT_TIMESTAMP(); set time_zone = 'America/New_York'; SELECT NOW(), CURDATE(), CURTIME(), CURRENT_TIMESTAMP(); 不同会话时区对 TIMESTAMP 类型的影响 # UTC +8 set time_zone = 'Asia/Shanghai'; CREATE TABLE events ( id INT AUTO_INCREMENT PRIMARY KEY, event_name VARCHAR(255) NOT NULL, event_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP, event_datetime DATETIME DEFAULT CURRENT_TIMESTAMP ); INSERT INTO events (event_name, event_timestamp, event_datetime) VALUES ('10.24 15:45:00', '2022-10-24 15:45:00', '2022-10-24 15:45:00'); INSERT INTO events (event_name, event_timestamp, event_datetime) VALUES ('12.24 15:45:00', '2022-12-24 15:45:00', '2022-12-24 15:45:00'); SELECT * FROM events; +----+----------------+---------------------+---------------------+ | id | event_name | event_timestamp | event_datetime | +----+----------------+---------------------+---------------------+ | 1 | 10.24 15:45:00 | 2022-10-24 15:45:00 | 2022-10-24 15:45:00 | | 2 | 12.24 15:45:00 | 2022-12-24 15:45:00 | 2022-12-24 15:45:00 | +----+----------------+---------------------+---------------------+ 2 rows in set (0.00 sec) # 仅修改当前会话的时区 set time_zone = 'America/New_York'; SELECT * FROM events; +----+----------------+---------------------+---------------------+ | id | event_name | event_timestamp | event_datetime | +----+----------------+---------------------+---------------------+ | 1 | 10.24 15:45:00 | 2022-10-24 03:45:00 | 2022-10-24 15:45:00 | \u003c- 夏令时，相差 12 小时 | 2 | 12.24 15:45:00 | 2022-12-24 02:45:00 | 2022-12-24 15:45:00 | \u003c- 平时相差 13 小时 +----+----------------+---------------------+---------------------+ 2 rows in set (0.00 sec) 纽约 UTC 时差通常为 UTC-5（EST），夏令时为 UTC-4（EDT），所以将原本的会话从上海(UTC+8) 转到纽约时，TIMESTAMP 相差了 13 或 12(夏令时) 小时，所以为了自动转换夏令时，指定时区最好使用时区名词 Asia/Shanghai，避免使用偏移量：'+08:00'\nJDBC 连接 MySQL 时 serverTimezone 对于 TIMESTAMP 类型的影响 连接 MySQL 时我们使用 URL：jdbc:mysql://192.168.1.2:3306/mydb?useSSL=false\u0026serverTimezone=Asia/Shanghai\n这里的 serverTimezone 参数用于指定连接到 MySQL 数据库时所使用的时区，不显示指定使用 JVM 默认时区\nMySQL 服务端处理 TIMESTAMP ：写入时根据会话时区转为 UTC 时间戳存储，读取时将 UTC 还原为会话时区的时间，保证了写入和读取数据的一致。数据库会话时区与 JVM 时区相同时，JVM 读写的 TIMESTAMP 一致，如果不一致就会出现问题，serverTimezone 就是为了告诉 JDBC 从 MySQL 服务端获取到的 TIMESTAMP 是什么时区，知道了它所使用的时区，JDBC 就可以进行预处理\nMyBatis 在处理 TIMESTAMP 类型的数据时会有一些差异，实体映射为 Timestamp 或 Date 在读写时会进行上面提到的预处理，而 LocalDateTime 则不会\nJDBC 读取 TIMESTAMP 类型数据时 JDBC 执行命令时，调用不同的 ResultSet 方法会有不同结果：\nResultSet 的 getString 方法：直接读取时间，即直接返回 数据库根据会话时区转化后的时间 ResultSet 的 getTimestamp 方法：将 数据库根据会话时区转化后的时间 根据 serverTimezone 设置的时区进行转化，得到 数据库根据会话时区转化后的时间 对应的 UTC 时间毫秒戳，然后将这个 UTC 毫秒时间戳转换为 Timestamp 类型（它本身不包含时区信息），打印时会根据 JVM 的时区转化为对应的时区时间 getTimestamp 转化 Timestamp 的源码在：com.mysql.cj.result.SqlTimestampValueFactory\n这里的 this.connectionTimeZone 就是连接 url 中指定的 serverTimezone\n假设 MySQL 默认设置的会话时区为 Asia/Shanghai，通过默认会话读取该 TIMESTAMP 的值为：2022-10-24 15:45:00。而 MySQL 实际存储的 TIMESTAMP 为 UTC 时间：2022-10-24 07:45:00。MySQL JDBC 驱动通过默认会话获取该值时，MySQL 会自动根据默认时区提供转化好时间：2022-10-24 15:45:00，驱动则会根据 serverTimezone 配置的时区，将 MySQL 的时间转化为 Calendar 对象，通过 c.getTimeInMillis() 获取对应的 UTC 时间戳，用于创建 Timestamp 对象\nJDBC 写入 TIMESTAMP 类型： now()写入，数据库 server 端会获取数据库当前时区 按照字符串写入：MySQL 服务端根据会话时区转成对应的 UTC 毫秒数存储 通过变量绑定写入：传入 Timestamp 对象，JDBC 将其编码为 serverTimezone 所代表的时间字符串，类似：2022-06-22 03:29:29，然后发送给 MySQL 服务端 验证 import org.junit.jupiter.api.Test; import java.sql.*; import java.util.TimeZone; public class JDBCTest { private static String url = \"jdbc:mysql://host:3306/mydb?useSSL=false\u0026serverTimezone=UTC\"; private static String username = \"root\"; private static String password = \"\"; @Test void testInsertTimestamp() { TimeZone.setDefault(TimeZone.getTimeZone(\"Asia/Shanghai\")); try (Connection connection = DriverManager.getConnection(url, username, password); PreparedStatement ps = connection .prepareStatement(\"insert into events(id,event_name,event_timestamp,event_datetime) values (1,'now()',now(),now())\");) { ps.execute(); }catch (Exception e){ e.printStackTrace(); } try (Connection connection = DriverManager.getConnection(url, username, password); PreparedStatement ps = connection .prepareStatement(\"insert into events(id,event_name,event_timestamp,event_datetime) values (2,'2022-06-22 03:29:29','2022-06-22 03:29:29', '2022-06-22 03:29:29')\");) { ps.execute(); }catch (Exception e){ e.printStackTrace(); } try (Connection connection = DriverManager.getConnection(url, username, password); PreparedStatement ps = connection .prepareStatement(\"insert into events(id,event_name,event_timestamp,event_datetime) values (3,'1733539800000L',?,?)\")) { // Sat Dec 07 2024 02:50:00 GMT+0000 // Sat Dec 07 2024 10:50:00 GMT+0800 (中国标准时间) long timestamp = 1733539800000L; Timestamp ts1 = new Timestamp(timestamp); Timestamp ts2 = new Timestamp(timestamp); ps.setTimestamp(1, ts1); ps.setTimestamp(2, ts2); ps.execute(); // 根据 serverTimezone 将 Timestamp 预处理为 UTC 时间：2024-12-07 02:50:00 // 相当于执行下列 SQL // insert into events(id,event_name,event_timestamp,event_datetime) values (3,'1733539800000L','2024-12-07 02:50:00','2024-12-07 02:50:00') }catch (Exception e){ e.printStackTrace(); } } @Test void testGetTimestamp() { TimeZone.setDefault(TimeZone.getTimeZone(\"Asia/Shanghai\")); try (Connection connection = DriverManager.getConnection(url, username, password); PreparedStatement ps = connection .prepareStatement(\"select * from events where id=3\"); ResultSet rs = ps.executeQuery();) { while (rs.next()) { // getTimestamp is 2024-12-07 10:50:00.0 // 根据 serverTimezone，认定数据库时区为 UTC，转化为 本地 Asia/Shanghai 需要 +8，则预处理为：2024-12-07 10:50:00.0 System.out.println(\"getTimestamp is \" + rs.getTimestamp(\"event_timestamp\")); // getString is 2024-12-07 02:50:00 System.out.println(\"getString is \" + rs.getString(\"event_datetime\")); } }catch (Exception e){ e.printStackTrace(); } } } 实验环境： MySQL 8.0.40 mysql-connector-j 9.1.0 mybatis-spring-boot-starter 3.0.4\n参考资料 7.1.15 MySQL Server Time Zone Support 13.2.2 The DATE, DATETIME, and TIMESTAMP Types 一文讲透MySQL driver读取时间时的时区处理 修改mysql时区的三种方法 MySQL 中存储时间的最佳实践\n","wordCount":"677","inLanguage":"en","image":"https://aaronlinv.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-12-19T08:40:33+08:00","dateModified":"2024-12-19T08:40:33+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://aaronlinv.github.io/posts/mysql-%E6%97%B6%E5%8C%BA%E4%B8%8E-servertimezone/"},"publisher":{"@type":"Organization","name":"Aaron Lin","logo":{"@type":"ImageObject","url":"https://aaronlinv.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://aaronlinv.github.io/ accesskey=h title="Aaron's Blog (Alt + H)">Aaron's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://aaronlinv.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://aaronlinv.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://aaronlinv.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://aaronlinv.github.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">MySQL 时区与 serverTimezone</h1><div class=post-meta><span title='2024-12-19 08:40:33 +0800 +0800'>December 19, 2024</span></div></header><div class=post-content><h2 id=tldr>TL;DR<a hidden class=anchor aria-hidden=true href=#tldr>#</a></h2><ol><li>手动为 MySQL 指定非偏移量的时区，以避免 <code>TIMESTAMP</code> 类型夏令时问题和时区转化性能瓶颈</li><li>TIMESTAMP 范围：&lsquo;1970-01-01 00:00:01&rsquo; UTC to &lsquo;2038-01-19 03:14:07&rsquo;</li><li>连接 MySQL 数据库时，serverTimezone 参数用于指定数据库服务器的时区，需要设置为与 MySQL 服务端相同的时区</li></ol><h2 id=mysql-时区设置影响-timestamp-类型数据和部分时间函数>MySQL 时区设置影响 TIMESTAMP 类型数据和部分时间函数<a hidden class=anchor aria-hidden=true href=#mysql-时区设置影响-timestamp-类型数据和部分时间函数>#</a></h2><p>MySQL 会话时区设置会影响 <code>TIMESTAMP</code> 和 时间函数（NOW()、CURDATE()、CURTIME()、CURRENT_TIMESTAMP()）</p><p>存储 <code>TIMESTAMP</code> 类型数据时，MySQL 会根据当前会话的时区将时间转换为 UTC 时间，MySQL 实际存储的是 UTC 时间。检索时 MySQL 根据会话的时区将存储的 UTC 时间转换为会话对应时区的时间。而 DATETIME 类型的字段存储的时间值是原始值，不受时区影响</p><p>MySQL 默认使用 SYSTEM 时区（即操作系统的时区），每个需要时区计算的 MySQL 函数调用都会调用系统库来确定当前系统时区。此调用可能受到全局互斥体的保护，从而导致争用，建议显式设置时区</p><h3 id=查询当前时区>查询当前时区<a hidden class=anchor aria-hidden=true href=#查询当前时区>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=n>time_zone</span><span class=err>：</span><span class=n>MySQL</span><span class=w> </span><span class=err>使用</span><span class=w> </span><span class=k>SYSTEM</span><span class=w> </span><span class=err>的时区</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=n>system_time_zone</span><span class=err>：</span><span class=k>SYSTEM</span><span class=w> </span><span class=err>为</span><span class=w> </span><span class=n>CST</span><span class=w> </span><span class=err>时区</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>show</span><span class=w> </span><span class=n>variables</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s2>&#34;%time_zone%&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>Variable_name</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=n>Value</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>system_time_zone</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>CST</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>time_zone</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=k>SYSTEM</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------------+--------+
</span></span></span></code></pre></div><h3 id=不同会话时区对-时间函数-的影响>不同会话时区对 时间函数 的影响<a hidden class=anchor aria-hidden=true href=#不同会话时区对-时间函数-的影响>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>当前时区</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>查看当前的全球和会话时区值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>@@</span><span class=k>GLOBAL</span><span class=p>.</span><span class=n>time_zone</span><span class=p>,</span><span class=w> </span><span class=o>@@</span><span class=k>SESSION</span><span class=p>.</span><span class=n>time_zone</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>NOW</span><span class=p>(),</span><span class=w> </span><span class=n>CURDATE</span><span class=p>(),</span><span class=w> </span><span class=n>CURTIME</span><span class=p>(),</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>set</span><span class=w> </span><span class=n>time_zone</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;America/New_York&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>NOW</span><span class=p>(),</span><span class=w> </span><span class=n>CURDATE</span><span class=p>(),</span><span class=w> </span><span class=n>CURTIME</span><span class=p>(),</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><h3 id=不同会话时区对-timestamp-类型的影响>不同会话时区对 TIMESTAMP 类型的影响<a hidden class=anchor aria-hidden=true href=#不同会话时区对-timestamp-类型的影响>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=n>UTC</span><span class=w> </span><span class=o>+</span><span class=mi>8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>set</span><span class=w> </span><span class=n>time_zone</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Asia/Shanghai&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>events</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>event_name</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>event_timestamp</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>event_datetime</span><span class=w> </span><span class=n>DATETIME</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>events</span><span class=w> </span><span class=p>(</span><span class=n>event_name</span><span class=p>,</span><span class=w> </span><span class=n>event_timestamp</span><span class=p>,</span><span class=w> </span><span class=n>event_datetime</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;10.24 15:45:00&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2022-10-24 15:45:00&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2022-10-24 15:45:00&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>events</span><span class=w> </span><span class=p>(</span><span class=n>event_name</span><span class=p>,</span><span class=w> </span><span class=n>event_timestamp</span><span class=p>,</span><span class=w> </span><span class=n>event_datetime</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;12.24 15:45:00&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2022-12-24 15:45:00&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2022-12-24 15:45:00&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>events</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------------+---------------------+---------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>event_name</span><span class=w>     </span><span class=o>|</span><span class=w> </span><span class=n>event_timestamp</span><span class=w>     </span><span class=o>|</span><span class=w> </span><span class=n>event_datetime</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------------+---------------------+---------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>10</span><span class=p>.</span><span class=mi>24</span><span class=w> </span><span class=mi>15</span><span class=p>:</span><span class=mi>45</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>2022</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>24</span><span class=w> </span><span class=mi>15</span><span class=p>:</span><span class=mi>45</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>2022</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>24</span><span class=w> </span><span class=mi>15</span><span class=p>:</span><span class=mi>45</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>12</span><span class=p>.</span><span class=mi>24</span><span class=w> </span><span class=mi>15</span><span class=p>:</span><span class=mi>45</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>2022</span><span class=o>-</span><span class=mi>12</span><span class=o>-</span><span class=mi>24</span><span class=w> </span><span class=mi>15</span><span class=p>:</span><span class=mi>45</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>2022</span><span class=o>-</span><span class=mi>12</span><span class=o>-</span><span class=mi>24</span><span class=w> </span><span class=mi>15</span><span class=p>:</span><span class=mi>45</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------------+---------------------+---------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>2</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>仅修改当前会话的时区</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>set</span><span class=w> </span><span class=n>time_zone</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;America/New_York&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>events</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------------+---------------------+---------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>event_name</span><span class=w>     </span><span class=o>|</span><span class=w> </span><span class=n>event_timestamp</span><span class=w>     </span><span class=o>|</span><span class=w> </span><span class=n>event_datetime</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------------+---------------------+---------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>10</span><span class=p>.</span><span class=mi>24</span><span class=w> </span><span class=mi>15</span><span class=p>:</span><span class=mi>45</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>2022</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>24</span><span class=w> </span><span class=mi>03</span><span class=p>:</span><span class=mi>45</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>2022</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>24</span><span class=w> </span><span class=mi>15</span><span class=p>:</span><span class=mi>45</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=o>|</span><span class=w>    </span><span class=o>&lt;-</span><span class=w> </span><span class=err>夏令时，相差</span><span class=w> </span><span class=mi>12</span><span class=w> </span><span class=err>小时</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>12</span><span class=p>.</span><span class=mi>24</span><span class=w> </span><span class=mi>15</span><span class=p>:</span><span class=mi>45</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>2022</span><span class=o>-</span><span class=mi>12</span><span class=o>-</span><span class=mi>24</span><span class=w> </span><span class=mi>02</span><span class=p>:</span><span class=mi>45</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>2022</span><span class=o>-</span><span class=mi>12</span><span class=o>-</span><span class=mi>24</span><span class=w> </span><span class=mi>15</span><span class=p>:</span><span class=mi>45</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=o>|</span><span class=w>    </span><span class=o>&lt;-</span><span class=w> </span><span class=err>平时相差</span><span class=w> </span><span class=mi>13</span><span class=w> </span><span class=err>小时</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+----------------+---------------------+---------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>2</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>纽约 UTC 时差通常为 UTC-5（EST），夏令时为 UTC-4（EDT），所以将原本的会话从上海(UTC+8) 转到纽约时，<code>TIMESTAMP</code> 相差了 13 或 12(夏令时) 小时，所以为了自动转换夏令时，指定时区最好使用时区名词 <code>Asia/Shanghai</code>，避免使用偏移量：<code>'+08:00'</code></p><h2 id=jdbc-连接-mysql-时-servertimezone-对于-timestamp-类型的影响>JDBC 连接 MySQL 时 serverTimezone 对于 TIMESTAMP 类型的影响<a hidden class=anchor aria-hidden=true href=#jdbc-连接-mysql-时-servertimezone-对于-timestamp-类型的影响>#</a></h2><p>连接 MySQL 时我们使用 URL：<code>jdbc:mysql://192.168.1.2:3306/mydb?useSSL=false&amp;serverTimezone=Asia/Shanghai</code></p><p>这里的 <code>serverTimezone</code> 参数用于指定连接到 MySQL 数据库时所使用的时区，不显示指定使用 JVM 默认时区</p><p>MySQL 服务端处理 <code>TIMESTAMP</code> ：写入时根据会话时区转为 UTC 时间戳存储，读取时将 UTC 还原为会话时区的时间，保证了写入和读取数据的一致。数据库会话时区与 JVM 时区相同时，JVM 读写的 <code>TIMESTAMP</code> 一致，如果不一致就会出现问题，<code>serverTimezone</code> 就是为了告诉 JDBC 从 MySQL 服务端获取到的 <code>TIMESTAMP</code> 是什么时区，知道了它所使用的时区，JDBC 就可以进行预处理</p><p>MyBatis 在处理 <code>TIMESTAMP</code> 类型的数据时会有一些差异，实体映射为 <code>Timestamp</code> 或 <code>Date</code> 在读写时会进行上面提到的预处理，而 <code>LocalDateTime</code> 则不会</p><h3 id=jdbc-读取-timestamp-类型数据时>JDBC 读取 TIMESTAMP 类型数据时<a hidden class=anchor aria-hidden=true href=#jdbc-读取-timestamp-类型数据时>#</a></h3><p>JDBC 执行命令时，调用不同的 ResultSet 方法会有不同结果：</p><ul><li>ResultSet 的 getString 方法：直接读取时间，即直接返回 <strong>数据库根据会话时区转化后的时间</strong></li><li>ResultSet 的 getTimestamp 方法：将 <strong>数据库根据会话时区转化后的时间</strong> 根据 serverTimezone 设置的时区进行转化，得到 <strong>数据库根据会话时区转化后的时间</strong> 对应的 UTC 时间毫秒戳，然后将这个 UTC 毫秒时间戳转换为 <code>Timestamp</code> 类型（它本身不包含时区信息），打印时会根据 JVM 的时区转化为对应的时区时间</li></ul><p><code>getTimestamp</code> 转化 <code>Timestamp</code> 的源码在：<code>com.mysql.cj.result.SqlTimestampValueFactory</code></p><p><img loading=lazy src=../MySQL%E6%97%B6%E5%8C%BA%E4%B8%8EserverTimezone/1.png></p><p>这里的 <code>this.connectionTimeZone</code> 就是连接 url 中指定的 <code>serverTimezone</code></p><p>假设 MySQL 默认设置的会话时区为 <code>Asia/Shanghai</code>，通过默认会话读取该 TIMESTAMP 的值为：2022-10-24 15:45:00。而 MySQL 实际存储的 TIMESTAMP 为 UTC 时间：2022-10-24 07:45:00。MySQL JDBC 驱动通过默认会话获取该值时，MySQL 会自动根据默认时区提供转化好时间：2022-10-24 15:45:00，驱动则会根据 <code>serverTimezone</code> 配置的时区，将 MySQL 的时间转化为 <code>Calendar</code> 对象，通过 <code>c.getTimeInMillis()</code> 获取对应的 UTC 时间戳，用于创建 <code>Timestamp</code> 对象</p><h3 id=jdbc-写入-timestamp-类型>JDBC 写入 TIMESTAMP 类型：<a hidden class=anchor aria-hidden=true href=#jdbc-写入-timestamp-类型>#</a></h3><ul><li>now()写入，数据库 server 端会获取数据库当前时区</li><li>按照字符串写入：MySQL 服务端根据会话时区转成对应的 UTC 毫秒数存储</li><li>通过变量绑定写入：传入 Timestamp 对象，JDBC 将其编码为 serverTimezone 所代表的时间字符串，类似：<code>2022-06-22 03:29:29</code>，然后发送给 MySQL 服务端</li></ul><h3 id=验证>验证<a hidden class=anchor aria-hidden=true href=#验证>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>org.junit.jupiter.api.Test</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.sql.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.TimeZone</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JDBCTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>url</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;jdbc:mysql://host:3306/mydb?useSSL=false&amp;serverTimezone=UTC&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;root&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>testInsertTimestamp</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>TimeZone</span><span class=p>.</span><span class=na>setDefault</span><span class=p>(</span><span class=n>TimeZone</span><span class=p>.</span><span class=na>getTimeZone</span><span class=p>(</span><span class=s>&#34;Asia/Shanghai&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>Connection</span><span class=w> </span><span class=n>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DriverManager</span><span class=p>.</span><span class=na>getConnection</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=p>);</span><span class=w> </span><span class=n>PreparedStatement</span><span class=w> </span><span class=n>ps</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>connection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>prepareStatement</span><span class=p>(</span><span class=s>&#34;insert into events(id,event_name,event_timestamp,event_datetime) values (1,&#39;now()&#39;,now(),now())&#34;</span><span class=p>);)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ps</span><span class=p>.</span><span class=na>execute</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>Connection</span><span class=w> </span><span class=n>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DriverManager</span><span class=p>.</span><span class=na>getConnection</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=p>);</span><span class=w> </span><span class=n>PreparedStatement</span><span class=w> </span><span class=n>ps</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>connection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>prepareStatement</span><span class=p>(</span><span class=s>&#34;insert into events(id,event_name,event_timestamp,event_datetime) values (2,&#39;2022-06-22 03:29:29&#39;,&#39;2022-06-22 03:29:29&#39;, &#39;2022-06-22 03:29:29&#39;)&#34;</span><span class=p>);)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ps</span><span class=p>.</span><span class=na>execute</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>Connection</span><span class=w> </span><span class=n>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DriverManager</span><span class=p>.</span><span class=na>getConnection</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=p>);</span><span class=w> </span><span class=n>PreparedStatement</span><span class=w> </span><span class=n>ps</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>connection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>prepareStatement</span><span class=p>(</span><span class=s>&#34;insert into events(id,event_name,event_timestamp,event_datetime) values (3,&#39;1733539800000L&#39;,?,?)&#34;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// Sat Dec 07 2024 02:50:00 GMT+0000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// Sat Dec 07 2024 10:50:00 GMT+0800 (中国标准时间)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kt>long</span><span class=w> </span><span class=n>timestamp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>1733539800000L</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Timestamp</span><span class=w> </span><span class=n>ts1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Timestamp</span><span class=p>(</span><span class=n>timestamp</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Timestamp</span><span class=w> </span><span class=n>ts2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Timestamp</span><span class=p>(</span><span class=n>timestamp</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ps</span><span class=p>.</span><span class=na>setTimestamp</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>ts1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ps</span><span class=p>.</span><span class=na>setTimestamp</span><span class=p>(</span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>ts2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ps</span><span class=p>.</span><span class=na>execute</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 根据 serverTimezone 将 Timestamp 预处理为 UTC 时间：2024-12-07 02:50:00</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 相当于执行下列 SQL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// insert into events(id,event_name,event_timestamp,event_datetime) values (3,&#39;1733539800000L&#39;,&#39;2024-12-07 02:50:00&#39;,&#39;2024-12-07 02:50:00&#39;)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>testGetTimestamp</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>TimeZone</span><span class=p>.</span><span class=na>setDefault</span><span class=p>(</span><span class=n>TimeZone</span><span class=p>.</span><span class=na>getTimeZone</span><span class=p>(</span><span class=s>&#34;Asia/Shanghai&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>Connection</span><span class=w> </span><span class=n>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DriverManager</span><span class=p>.</span><span class=na>getConnection</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=p>);</span><span class=w> </span><span class=n>PreparedStatement</span><span class=w> </span><span class=n>ps</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>connection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>prepareStatement</span><span class=p>(</span><span class=s>&#34;select * from events where id=3&#34;</span><span class=p>);</span><span class=w> </span><span class=n>ResultSet</span><span class=w> </span><span class=n>rs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ps</span><span class=p>.</span><span class=na>executeQuery</span><span class=p>();)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>rs</span><span class=p>.</span><span class=na>next</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// getTimestamp is 2024-12-07 10:50:00.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 根据 serverTimezone，认定数据库时区为 UTC，转化为 本地 Asia/Shanghai 需要 +8，则预处理为：2024-12-07 10:50:00.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;getTimestamp is &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>rs</span><span class=p>.</span><span class=na>getTimestamp</span><span class=p>(</span><span class=s>&#34;event_timestamp&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// getString is 2024-12-07 02:50:00</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;getString is &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>rs</span><span class=p>.</span><span class=na>getString</span><span class=p>(</span><span class=s>&#34;event_datetime&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>实验环境：
MySQL 8.0.40
mysql-connector-j 9.1.0
mybatis-spring-boot-starter 3.0.4</p><h2 id=参考资料>参考资料<a hidden class=anchor aria-hidden=true href=#参考资料>#</a></h2><p><a href=https://dev.mysql.com/doc/refman/8.4/en/time-zone-support.html>7.1.15 MySQL Server Time Zone Support</a>
<a href=https://dev.mysql.com/doc/refman/8.4/en/datetime.html>13.2.2 The DATE, DATETIME, and TIMESTAMP Types</a>
<a href=https://kaimingwan.com/2022/06/20/ns4y3a/>一文讲透MySQL driver读取时间时的时区处理</a>
<a href=https://www.cnblogs.com/jie-fang/p/10279439.html>修改mysql时区的三种方法</a>
<a href=https://www.upyun.com/tech/article/652/MySQL%20%E4%B8%AD%E5%AD%98%E5%82%A8%E6%97%B6%E9%97%B4%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html>MySQL 中存储时间的最佳实践</a></p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://aaronlinv.github.io/posts/%E9%87%8D%E6%8B%BE-iptables/><span class=title>« Prev</span><br><span>重拾 iptables</span>
</a><a class=next href=https://aaronlinv.github.io/posts/%E4%B8%BA%E4%BB%80%E4%B9%88-ai-%E6%97%B6%E4%BB%A3%E6%9B%B4%E5%BA%94%E8%AF%A5-learn-in-public/><span class=title>Next »</span><br><span>为什么 AI 时代更应该 Learn in Public</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://aaronlinv.github.io/>Aaron Lin</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>